# Session Handoff - 2025-12-21

## Project State
- **Current branch**: main
- **Last commit**: fd72d49 - Comprehensive Table of Contents sync across all documentation
- **Dev server**: `npm run dev`

## Changes Made This Session
| File | Change |
|------|--------|
| `FamilyTree.tsx` | Refined "SÃ¸skende" label with pill design; centered on lines; removed badge overlap. |
| `FamilyTree.tsx` | Implemented **Stable Slot Heuristic** to prevent lineage breakage upon member renaming. |
| `AmbientTab.tsx` | Fixed medication contrast issues in dark mode with theme-aware tokens (`.theme-card`). |
| `ARCHITECTURE.md` | Overhauled with **Mirror Architecture** visualization (Mermaid + ASCII accessibility). |
| `ROADMAP.md` | Added Multi-Family Relational Schema and "X-in-law" support strategies. |
| `IDEATION.md` | Introduced "Connection Rituals" and "In-Law Visibility" concepts for onboarding. |
| `LEARNINGS.md` | Added 3 new entries on Stable Slots, Theme Tokens, and Doc Accessibility. |

## Key Patterns Discovered
- **Mirror Protocol**: The app is not two apps; it's a shared core projected through role-specific "Lenses". UI components should be shared as much as possible.
- **Stable Slots**: Using immutable `userId` sorting to map heuristic relationship roles (Partner, Sibling) avoids breakage from mutable name changes.

## Decisions Made
| Decision | Rationale |
|----------|-----------|
| ASCII + Mermaid | Ensure high-fidelity architectural clarity that remains accessible in text-only dev environments. |
| Theme-Aware Tokens | Fix dark mode "ghost text" permanently without ad-hoc Tailwind overrides. |
| Positional Slots | Avoided premature relational database refactoring while providing immediate lineage stability for the POC. |

## Active Issues
- [ ] **Data Scalability**: The Family Tree currently only supports 2-3 children via process-of-elimination logic.
- [ ] **Hardcoded Admin**: Admin bypass is still linked to `dinko1991@hotmail.com` in `firestore.rules`.

## Quick Start for Next Session
1. Run `npm run dev`.
2. The current focus is **Stage 2: Relational Migration**.
3. Start by reviewing the **Relational Schema** section in `ROADMAP.md` to move beyond the Stable Slot heuristic.
