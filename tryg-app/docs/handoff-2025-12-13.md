# Session Handoff - 2025-12-13

## Project State
- Current branch: `main`
- Last commit: `0a39fc9` - fix: propagate auth errors to prevent wrong setup flow
- Dev server: `cd tryg-app && npm run dev`

## Changes Made This Session

| File | Change |
|------|--------|
| `useAuth.js` | Propagate profile fetch errors to prevent silent failures |
| `AppWithAuth.jsx` | Check authError in addition to circleError, show connection error screen |
| `useSymptoms.js` | Whitelist sanitization instead of blacklist for Firestore data |
| `useHelpExchange.js` | Same whitelist sanitization fix |
| `PNWS/learnings.md` | Added 4 agent learnings (file search scope, gitignore workarounds, etc.) |
| `~/.gemini/GEMINI.md` | Added global rule for documenting troubleshooting learnings |
| `~/.gemini/antigravity/global_workflows/handoff.md` | Created global handoff workflow |
| `~/.gemini/antigravity/global_workflows/onboarding.md` | Created global onboarding workflow |
| `tryg-app/docs/PROJECT_CONTEXT.md` | Created project context document |

## Key Patterns Discovered
- **Antigravity global workflows**: Must be in `~/.gemini/antigravity/global_workflows/`, NOT `~/.gemini/workflows/`
- **Firestore serialization**: React component objects (Lucide icons) have non-enumerable Symbol properties that break Firestore. Use whitelist sanitization.
- **Error propagation**: useAuth was swallowing profile fetch errors, causing AppWithAuth to fall through to wrong UI state

## Decisions Made

| Decision | Rationale |
|----------|-----------|
| Whitelist over blacklist sanitization | Symbol properties are non-enumerable, can't be filtered with Object.keys() |
| Global rule for troubleshooting docs | Ensures learnings captured across all projects automatically |
| PROJECT_CONTEXT.md pattern | Separates process (global workflow) from content (project-specific) |
| Security/Deployment as optional onboarding | Not all tasks need full security review |

## Active Issues
- [ ] Firebase authorized domain configured (`dinkojuric.github.io`) but production issue may persist - needs testing
- [ ] Offline error handling could show more specific messages

## Quick Start for Next Session
1. Run `cd tryg-app && npm run dev`
2. Check if deployed site now works (authorized domain was added to Firebase)
3. Look at `AppWithAuth.jsx` and `useAuth.js` if debugging auth flow
