[{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\ambient\\ActivityTimeline.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\ambient\\AmbientHero.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\ambient\\AmbientHero.tsx:46:13\n  44 |         if (lastCheckIn && lastCheckIn !== prevCheckInRef.current) {\n  45 |             // Trigger celebratory burst!\n> 46 |             setIsBursting(true);\n     |             ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  47 |\n  48 |             // Reset after 3 seconds\n  49 |             const timer = setTimeout(() => setIsBursting(false), 3000);","line":46,"column":13,"nodeType":null,"endLine":46,"endColumn":26}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { CheckCircle, Heart, Clock, Activity, AlertCircle } from 'lucide-react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useCareCircleContext } from '../../contexts/CareCircleContext';\r\nimport { Button } from '../../components/ui/Button';\r\nimport { Avatar } from '../../components/ui/Avatar';\r\nimport { toJsDate } from '../../utils/dateUtils';\r\n\r\nexport interface AmbientHeroProps {\r\n    role: 'senior' | 'relative';\r\n    onCheckIn?: () => void;\r\n    onOpenSymptomModal?: () => void;\r\n}\r\n\r\n/**\r\n * AmbientHero - The emotional centerpiece of the AmbientTab.\r\n * - Senior Mode: Interactive check-in buttons (\"I'm okay\" / \"I have pain\")\r\n * - Relative Mode: Ambient status visualization (rings, pulse, gradient)\r\n *   ÔåÆ Bursts with celebratory animation when Senior checks in!\r\n */\r\nexport const AmbientHero: React.FC<AmbientHeroProps> = ({\r\n    role,\r\n    onCheckIn,\r\n    onOpenSymptomModal\r\n}) => {\r\n    const { t } = useTranslation();\r\n    const {\r\n        seniorName,\r\n        tasks = [],\r\n        symptoms = [],\r\n        lastCheckIn\r\n    } = useCareCircleContext();\r\n\r\n    // ========== BURST ANIMATION STATE (Relative Mode) ==========\r\n    const [isBursting, setIsBursting] = useState(false);\r\n    const prevCheckInRef = useRef<string | null>(null);\r\n\r\n    // Detect check-in changes and trigger burst animation\r\n    useEffect(() => {\r\n        if (role !== 'relative') return;\r\n\r\n        // If lastCheckIn changed to a new value\r\n        if (lastCheckIn && lastCheckIn !== prevCheckInRef.current) {\r\n            // Trigger celebratory burst!\r\n            setIsBursting(true);\r\n\r\n            // Reset after 3 seconds\r\n            const timer = setTimeout(() => setIsBursting(false), 3000);\r\n\r\n            prevCheckInRef.current = lastCheckIn;\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [lastCheckIn, role]);\r\n\r\n    // Calculate today's symptom count\r\n    const todaySymptomCount = symptoms.filter(s => {\r\n        const date = toJsDate(s.loggedAt);\r\n        return date && date.toDateString() === new Date().toDateString();\r\n    }).length;\r\n\r\n    // Calculate completion rate\r\n    const totalTasks = tasks.length;\r\n    const completedTasks = tasks.filter(t => t.completed).length;\r\n    const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 100;\r\n\r\n    // Derived status for Relative mode\r\n    const status = React.useMemo(() => {\r\n        if (todaySymptomCount > 0) return 'symptom';\r\n        if (completionRate < 50 && totalTasks > 0) return 'warning';\r\n        if (completionRate >= 80) return 'calm';\r\n        return 'neutral';\r\n    }, [todaySymptomCount, completionRate, totalTasks]);\r\n\r\n    // Theme mapping\r\n    const theme = React.useMemo(() => {\r\n        switch (status) {\r\n            case 'symptom':\r\n                return {\r\n                    gradient: 'from-rose-400/85 to-orange-500/85',\r\n                    blob: 'fill-rose-200/40',\r\n                    pulseScale: [1, 1.15, 1],\r\n                    label: t('dashboard_symptoms'),\r\n                    icon: AlertCircle,\r\n                    shadow: 'shadow-rose-200/50'\r\n                };\r\n            case 'warning':\r\n                return {\r\n                    gradient: 'from-amber-400/85 to-orange-400/85',\r\n                    blob: 'fill-amber-200/40',\r\n                    pulseScale: [1, 1.05, 1],\r\n                    label: t('dashboard_tasks_missing'),\r\n                    icon: Clock,\r\n                    shadow: 'shadow-amber-100/50'\r\n                };\r\n            case 'calm':\r\n                return {\r\n                    gradient: 'from-teal-400/85 to-emerald-500/85',\r\n                    blob: 'fill-teal-100/40',\r\n                    pulseScale: [1, 1.02, 1],\r\n                    label: t('peace_all_well'),\r\n                    icon: CheckCircle,\r\n                    shadow: 'shadow-teal-100/50'\r\n                };\r\n            default:\r\n                return {\r\n                    gradient: 'from-stone-400/85 to-stone-500/85',\r\n                    blob: 'fill-stone-200/40',\r\n                    pulseScale: [1, 1, 1],\r\n                    label: t('peace_good_day'),\r\n                    icon: Activity,\r\n                    shadow: 'shadow-stone-100/50'\r\n                };\r\n        }\r\n    }, [status, t]);\r\n\r\n    // ========== SENIOR MODE ==========\r\n    if (role === 'senior') {\r\n        return (\r\n            <div className=\"glass-premium shadow-plush p-6 mb-8 glow-warmth\">\r\n                <h2 className=\"text-xl font-semibold theme-text mb-4\">{t('pain_question')}</h2>\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                    <Button\r\n                        variant=\"primary\"\r\n                        size=\"large\"\r\n                        className=\"w-full min-h-32 py-4 shadow-plush hover:shadow-plush-lg transition-shadow\"\r\n                        onClick={onCheckIn}\r\n                    >\r\n                        <div className=\"flex flex-col items-center gap-2 text-center\">\r\n                            <CheckCircle className=\"w-10 h-10 shrink-0\" />\r\n                            <span className=\"text-sm leading-tight\">{t('i_feel_good')}</span>\r\n                        </div>\r\n                    </Button>\r\n\r\n                    <Button\r\n                        variant=\"secondary\"\r\n                        size=\"large\"\r\n                        className=\"w-full min-h-32 py-4 bg-gradient-to-br from-orange-50 to-amber-50/80 text-orange-800 border border-orange-100/50 hover:from-orange-100 hover:to-amber-100/80 shadow-plush transition-all\"\r\n                        onClick={onOpenSymptomModal}\r\n                    >\r\n                        <div className=\"flex flex-col items-center gap-2 text-center\">\r\n                            <Heart className=\"w-10 h-10 text-orange-500 shrink-0\" />\r\n                            <span className=\"text-sm leading-tight\">{t('i_feel_pain')}</span>\r\n                        </div>\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // ========== RELATIVE MODE ==========\r\n    return (\r\n        <motion.div\r\n            layout\r\n            className={`\r\n                relative overflow-hidden rounded-[2rem] p-8 shadow-plush-lg border border-white/40\r\n                bg-gradient-to-br ${theme.gradient}\r\n                backdrop-blur-xl\r\n                ${theme.shadow}\r\n                ${isBursting ? 'animate-connection-pulse' : ''}\r\n            `}\r\n            initial={{ opacity: 0, scale: 0.95 }}\r\n            animate={{ opacity: 1, scale: 1 }}\r\n            transition={{ duration: 0.8, ease: [0.16, 1, 0.3, 1] }}\r\n        >\r\n            {/* Ambient Background Blobs */}\r\n            <div className=\"absolute inset-0 z-0 overflow-hidden blur-3xl opacity-60\">\r\n                <motion.svg\r\n                    viewBox=\"0 0 100 100\"\r\n                    className=\"absolute -top-1/4 -left-1/4 w-full h-full\"\r\n                    animate={{\r\n                        rotate: [0, 360],\r\n                        scale: [1, 1.2, 1]\r\n                    }}\r\n                    transition={{\r\n                        duration: 20,\r\n                        repeat: Infinity,\r\n                        ease: \"linear\"\r\n                    }}\r\n                >\r\n                    <path\r\n                        className={theme.blob}\r\n                        d=\"M33,-47.1C43.3,-40.3,52.5,-30.9,57.1,-19.5C61.7,-8,61.7,5.5,57.9,18C54,30.5,46.3,42,35.3,49.8C24.3,57.6,10.1,61.7,-3.4,66.4C-16.9,71.1,-29.7,76.4,-40.7,71.7C-51.7,67,-61,52.3,-66.2,37.3C-71.4,22.3,-72.6,7,-67.7,-5.7C-62.8,-18.3,-51.8,-28.3,-40.3,-35.1C-28.8,-41.8,-16.8,-45.3,-4.2,-39.5C8.3,-33.7,19.9,-18.6,33,-47.1Z\"\r\n                        transform=\"translate(50 50)\"\r\n                    />\r\n                </motion.svg>\r\n            </div>\r\n\r\n            {/* Content Layer */}\r\n            <div className=\"relative z-10 flex flex-col items-center text-center\">\r\n\r\n                {/* Senior Presence Heartbeat - Bursts when check-in detected! */}\r\n                <div className=\"relative mb-6\">\r\n                    <motion.div\r\n                        className=\"absolute inset-0 bg-white/40 rounded-full blur-xl\"\r\n                        animate={{\r\n                            scale: isBursting ? [1, 1.5, 1, 1.3, 1] : theme.pulseScale,\r\n                            opacity: isBursting ? [0.5, 1, 0.5, 0.8, 0.3] : [0.3, 0.6, 0.3]\r\n                        }}\r\n                        transition={{\r\n                            duration: isBursting ? 0.6 : (status === 'calm' ? 4 : status === 'warning' ? 2 : 1.5),\r\n                            repeat: isBursting ? 5 : Infinity,\r\n                            ease: isBursting ? \"easeOut\" : \"easeInOut\"\r\n                        }}\r\n                    />\r\n                    <motion.div\r\n                        className=\"p-1.5 bg-white/20 rounded-full backdrop-blur-xl border border-white/40\"\r\n                        whileHover={{ scale: 1.05 }}\r\n                    >\r\n                        <Avatar id=\"senior\" size=\"xl\" className=\"border-4 border-white shadow-xl\" />\r\n                    </motion.div>\r\n                </div>\r\n\r\n                {/* Status Messaging */}\r\n                <AnimatePresence mode=\"wait\">\r\n                    <motion.div\r\n                        key={status}\r\n                        initial={{ opacity: 0, y: 10 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        exit={{ opacity: 0, y: -10 }}\r\n                        transition={{ duration: 0.5 }}\r\n                        className=\"space-y-2\"\r\n                    >\r\n                        <h2 className=\"text-3xl font-black text-white tracking-tight drop-shadow-md\">\r\n                            {theme.label}\r\n                        </h2>\r\n                        <p className=\"text-white/80 font-medium text-lg drop-shadow-sm px-4\">\r\n                            {status === 'calm'\r\n                                ? t('peace_sub_all_well', { name: seniorName })\r\n                                : status === 'symptom'\r\n                                    ? t('dashboard_symptoms_sub', { count: todaySymptomCount })\r\n                                    : t('dashboard_tasks_missing_sub')}\r\n                        </p>\r\n                    </motion.div>\r\n                </AnimatePresence>\r\n\r\n                {/* Secondary Info Pills */}\r\n                <div className=\"mt-8 flex gap-3\">\r\n                    <div className=\"px-4 py-2 bg-white/20 backdrop-blur-md rounded-full border border-white/30 text-white text-xs font-bold uppercase tracking-widest shadow-lg\">\r\n                        <Clock className=\"w-3 h-3 inline-block mr-1.5 -mt-0.5\" />\r\n                        {typeof lastCheckIn === 'string' ? lastCheckIn : '-'}\r\n                    </div>\r\n                    <div className=\"px-4 py-2 bg-white/20 backdrop-blur-md rounded-full border border-white/30 text-white text-xs font-bold uppercase tracking-widest shadow-lg\">\r\n                        <Activity className=\"w-3 h-3 inline-block mr-1.5 -mt-0.5\" />\r\n                        {completionRate}% {t('taken')}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Subtle Texture Overlay */}\r\n            <div className=\"absolute inset-0 pointer-events-none opacity-[0.03] bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]\" />\r\n        </motion.div>\r\n    );\r\n};\r\n\r\nexport default AmbientHero;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\ambient\\BriefingStory.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\ambient\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\coffee\\CoffeeInviteCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\coffee\\CoffeeToggle.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\coffee\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\familyPresence\\AmbientDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[401,404],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[401,404],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useMemo } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { Clock, Activity, AlertCircle, CheckCircle } from 'lucide-react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Avatar } from '../../components/ui/Avatar';\r\nimport { Task } from '../../types';\r\n\r\nexport interface AmbientDashboardProps {\r\n    seniorName: string;\r\n    lastCheckIn?: any;\r\n    tasks: Task[];\r\n    symptomCount: number;\r\n    className?: string;\r\n}\r\n\r\n/**\r\n * AmbientDashboard - A passive, atmospheric view of the senior's status.\r\n * Communicates wellbeing through color, light, and motion instead of just data.\r\n */\r\nexport const AmbientDashboard: React.FC<AmbientDashboardProps> = ({\r\n    seniorName,\r\n    lastCheckIn,\r\n    tasks,\r\n    symptomCount,\r\n    className = \"\"\r\n}) => {\r\n    const { t } = useTranslation();\r\n\r\n    // Calculate completion rate\r\n    const totalTasks = tasks.length;\r\n    const completedTasks = tasks.filter(t => t.completed).length;\r\n    const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 100;\r\n\r\n    // Derived Status state\r\n    const status = useMemo(() => {\r\n        if (symptomCount > 0) return 'symptom';\r\n        if (completionRate < 50 && totalTasks > 0) return 'warning';\r\n        if (completionRate >= 80) return 'calm';\r\n        return 'neutral';\r\n    }, [symptomCount, completionRate, totalTasks]);\r\n\r\n    // Theme mapping for the ambient feel\r\n    const theme = useMemo(() => {\r\n        switch (status) {\r\n            case 'symptom':\r\n                return {\r\n                    gradient: 'from-rose-400 to-orange-500',\r\n                    blob: 'fill-rose-200/40',\r\n                    pulseScale: [1, 1.15, 1],\r\n                    label: t('dashboard_symptoms'),\r\n                    icon: AlertCircle,\r\n                    shadow: 'shadow-rose-200/50'\r\n                };\r\n            case 'warning':\r\n                return {\r\n                    gradient: 'from-amber-400 to-orange-400',\r\n                    blob: 'fill-amber-200/40',\r\n                    pulseScale: [1, 1.05, 1],\r\n                    label: t('dashboard_tasks_missing'),\r\n                    icon: Clock,\r\n                    shadow: 'shadow-amber-100/50'\r\n                };\r\n            case 'calm':\r\n                return {\r\n                    gradient: 'from-teal-400 to-emerald-500',\r\n                    blob: 'fill-teal-100/40',\r\n                    pulseScale: [1, 1.02, 1],\r\n                    label: t('peace_all_well'),\r\n                    icon: CheckCircle,\r\n                    shadow: 'shadow-teal-100/50'\r\n                };\r\n            default:\r\n                return {\r\n                    gradient: 'from-stone-400 to-stone-500',\r\n                    blob: 'fill-stone-200/40',\r\n                    pulseScale: [1, 1, 1],\r\n                    label: t('peace_good_day'),\r\n                    icon: Activity,\r\n                    shadow: 'shadow-stone-100/50'\r\n                };\r\n        }\r\n    }, [status, t]);\r\n\r\n    return (\r\n        <motion.div\r\n            layout\r\n            className={`\r\n                relative overflow-hidden rounded-[2rem] p-8 shadow-2xl border border-white/30\r\n                bg-gradient-to-br ${theme.gradient}\r\n                ${theme.shadow} ${className}\r\n            `}\r\n            initial={{ opacity: 0, scale: 0.95 }}\r\n            animate={{ opacity: 1, scale: 1 }}\r\n            transition={{ duration: 0.8, ease: \"easeOut\" }}\r\n        >\r\n            {/* Ambient Background Blobs */}\r\n            <div className=\"absolute inset-0 z-0 overflow-hidden blur-3xl opacity-60\">\r\n                <motion.svg\r\n                    viewBox=\"0 0 100 100\"\r\n                    className=\"absolute -top-1/4 -left-1/4 w-full h-full\"\r\n                    animate={{\r\n                        rotate: [0, 360],\r\n                        scale: [1, 1.2, 1]\r\n                    }}\r\n                    transition={{\r\n                        duration: 20,\r\n                        repeat: Infinity,\r\n                        ease: \"linear\"\r\n                    }}\r\n                >\r\n                    <path\r\n                        className={theme.blob}\r\n                        d=\"M33,-47.1C43.3,-40.3,52.5,-30.9,57.1,-19.5C61.7,-8,61.7,5.5,57.9,18C54,30.5,46.3,42,35.3,49.8C24.3,57.6,10.1,61.7,-3.4,66.4C-16.9,71.1,-29.7,76.4,-40.7,71.7C-51.7,67,-61,52.3,-66.2,37.3C-71.4,22.3,-72.6,7,-67.7,-5.7C-62.8,-18.3,-51.8,-28.3,-40.3,-35.1C-28.8,-41.8,-16.8,-45.3,-4.2,-39.5C8.3,-33.7,19.9,-18.6,33,-47.1Z\"\r\n                        transform=\"translate(50 50)\"\r\n                    />\r\n                </motion.svg>\r\n            </div>\r\n\r\n            {/* Content Layer */}\r\n            <div className=\"relative z-10 flex flex-col items-center text-center\">\r\n\r\n                {/* Senior Presence Heartbeat */}\r\n                <div className=\"relative mb-6\">\r\n                    <motion.div\r\n                        className=\"absolute inset-0 bg-white/40 rounded-full blur-xl\"\r\n                        animate={{\r\n                            scale: theme.pulseScale,\r\n                            opacity: [0.3, 0.6, 0.3]\r\n                        }}\r\n                        transition={{\r\n                            duration: status === 'calm' ? 4 : status === 'warning' ? 2 : 1.5,\r\n                            repeat: Infinity,\r\n                            ease: \"easeInOut\"\r\n                        }}\r\n                    />\r\n                    <motion.div\r\n                        className=\"p-1.5 bg-white/20 rounded-full backdrop-blur-xl border border-white/40\"\r\n                        whileHover={{ scale: 1.05 }}\r\n                    >\r\n                        <Avatar id=\"senior\" size=\"xl\" className=\"border-4 border-white shadow-xl\" />\r\n                    </motion.div>\r\n                </div>\r\n\r\n                {/* Status Messaging */}\r\n                <AnimatePresence mode=\"wait\">\r\n                    <motion.div\r\n                        key={status}\r\n                        initial={{ opacity: 0, y: 10 }}\r\n                        animate={{ opacity: 1, y: 0 }}\r\n                        exit={{ opacity: 0, y: -10 }}\r\n                        transition={{ duration: 0.5 }}\r\n                        className=\"space-y-2\"\r\n                    >\r\n                        <h2 className=\"text-3xl font-black text-white tracking-tight drop-shadow-md\">\r\n                            {theme.label}\r\n                        </h2>\r\n                        <p className=\"text-white/80 font-medium text-lg drop-shadow-sm px-4\">\r\n                            {status === 'calm'\r\n                                ? t('peace_sub_all_well', { name: seniorName })\r\n                                : status === 'symptom'\r\n                                    ? t('dashboard_symptoms_sub', { count: symptomCount })\r\n                                    : t('dashboard_tasks_missing_sub')}\r\n                        </p>\r\n                    </motion.div>\r\n                </AnimatePresence>\r\n\r\n                {/* Secondary Info Pill */}\r\n                <div className=\"mt-8 flex gap-3\">\r\n                    <div className=\"px-4 py-2 bg-white/20 backdrop-blur-md rounded-full border border-white/30 text-white text-xs font-bold uppercase tracking-widest shadow-lg\">\r\n                        <Clock className=\"w-3 h-3 inline-block mr-1.5 -mt-0.5\" />\r\n                        {typeof lastCheckIn === 'string' ? lastCheckIn : '-'}\r\n                    </div>\r\n                    <div className=\"px-4 py-2 bg-white/20 backdrop-blur-md rounded-full border border-white/30 text-white text-xs font-bold uppercase tracking-widest shadow-lg\">\r\n                        <Activity className=\"w-3 h-3 inline-block mr-1.5 -mt-0.5\" />\r\n                        {completionRate}% {t('taken')}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Subtle Texture Overlay */}\r\n            <div className=\"absolute inset-0 pointer-events-none opacity-[0.03] bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]\" />\r\n        </motion.div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\familyPresence\\FamilyPresence.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[406,409],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[406,409],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'memberStatuses' logical expression could make the dependencies of useMemo Hook (at line 123) change on every render. To fix this, wrap the initialization of 'memberStatuses' in its own useMemo() Hook.","line":112,"column":11,"nodeType":"VariableDeclarator","endLine":112,"endColumn":73},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":119,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5240,5243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5240,5243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":119,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5253,5256],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5253,5256],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":147,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6412,6415],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6412,6415],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Users } from 'lucide-react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { useCareCircleContext } from '../../contexts/CareCircleContext';\r\nimport { Avatar } from '../../components/ui/Avatar';\r\nimport { MemberStatus } from './useMemberStatus';\r\n\r\ninterface MemberStatusRowProps {\r\n    name: string;\r\n    status: string;\r\n    role: string;\r\n    timestamp?: any;\r\n    isCurrentUser?: boolean;\r\n}\r\n\r\n// ­ƒÜÇ TURBO: Memoized MemberStatusRow to prevent re-renders when parent state changes.\r\n// This is a high-frequency component, so memoization provides a significant performance boost.\r\nconst MemberStatusRow: React.FC<MemberStatusRowProps> = React.memo(({ name, status, role, timestamp, isCurrentUser = false }) => {\r\n    const { t } = useTranslation();\r\n    const avatarId = role === 'senior' ? 'senior' :\r\n        name.toLowerCase().includes('louise') ? 'louise' :\r\n            name.toLowerCase().includes('juzu') ? 'juzu' :\r\n                (name.toLowerCase().includes('brad') || name.toLowerCase().includes('senior')) ? 'brad' : 'fatima';\r\n\r\n    const statusIdMapping: Record<string, string> = {\r\n        'home': 'home',\r\n        'work': 'work',\r\n        'traveling': 'car',\r\n        'available': 'coffee',\r\n        'busy': 'moon',\r\n        'good': 'home',\r\n        'default': 'home'\r\n    };\r\n\r\n    const statusIconId = statusIdMapping[status] || 'home';\r\n    const config = role === 'senior'\r\n        ? { label: t('peace_all_well'), color: 'text-green-600' }\r\n        : { label: t(`status_${status}`), color: 'text-stone-500' };\r\n\r\n    let timeString = '';\r\n    if (timestamp) {\r\n        const date = (timestamp && typeof timestamp.toDate === 'function')\r\n            ? timestamp.toDate()\r\n            : new Date(timestamp);\r\n\r\n        const now = new Date();\r\n        const diffMs = now.getTime() - date.getTime();\r\n        const diffMins = Math.max(0, Math.floor(diffMs / 60000)); // Prevent negative values\r\n\r\n        if (diffMins < 60) {\r\n            timeString = `${diffMins}m`;\r\n        } else if (diffMins < 1440) {\r\n            timeString = `${Math.floor(diffMins / 60)}t`;\r\n        } else {\r\n            timeString = date.toLocaleDateString('da-DK', { day: 'numeric', month: 'short' });\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className={`\r\n            flex items-center justify-between p-3 rounded-xl transition-all\r\n            ${isCurrentUser ? 'bg-indigo-50/50 border border-indigo-100/50' : 'hover:bg-stone-50 border border-transparent hover:border-stone-100'}\r\n        `}>\r\n            <div className=\"flex items-center gap-3\">\r\n                {/* Avatar with connection glow when available */}\r\n                <div className={`relative ${status === 'available' ? 'animate-glow' : ''}`}>\r\n                    <Avatar id={avatarId} size=\"md\" className=\"shadow-sm border-2 border-white\" />\r\n                    <div className={`absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 rounded-full border-2 border-white ${status === 'available' ? 'bg-teal-500' :\r\n                        status === 'home' ? 'bg-green-500' :\r\n                            status === 'work' ? 'bg-indigo-500' :\r\n                                status === 'traveling' ? 'bg-amber-500' : 'bg-stone-400'\r\n                        }`} />\r\n                </div>\r\n                <div>\r\n                    <span className={`text-sm font-bold block text-left ${isCurrentUser ? 'text-indigo-900' : 'text-stone-700'}`}>\r\n                        {name} {isCurrentUser && <span className=\"opacity-50 text-xs font-normal\">({t('you')})</span>}\r\n                    </span>\r\n                    <span className={`text-xs font-medium block text-left ${config.color || 'text-stone-500'}`}>\r\n                        {config.label}\r\n                    </span>\r\n                </div>\r\n            </div>\r\n            <div className=\"flex flex-col items-end gap-1\">\r\n                <div className=\"bg-stone-100/80 p-1.5 rounded-lg backdrop-blur-sm\">\r\n                    <Avatar id={statusIconId} size=\"sm\" />\r\n                </div>\r\n                {timeString && (\r\n                    <span className=\"text-[10px] font-medium text-stone-400 tabular-nums\">\r\n                        {timeString}\r\n                    </span>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n});\r\n\r\ninterface FamilyPresenceProps {\r\n    memberStatuses?: MemberStatus[];\r\n    currentUserId?: string;\r\n    seniorName?: string;\r\n    compact?: boolean;\r\n}\r\n\r\nexport const FamilyPresence: React.FC<FamilyPresenceProps> = ({\r\n    memberStatuses: propsMembers,\r\n    currentUserId: propsUserId,\r\n    seniorName: propsSeniorName,\r\n    compact = false\r\n}) => {\r\n    const { t } = useTranslation();\r\n    const context = useCareCircleContext();\r\n    const memberStatuses = propsMembers ?? context?.memberStatuses ?? [];\r\n    const currentUserId = propsUserId ?? context?.currentUserId;\r\n    const seniorName = propsSeniorName ?? context?.seniorName ?? 'Far/Mor';\r\n\r\n    // ­ƒÜÇ TURBO: Create a lookup map for member statuses to optimize the render loop.\r\n    // This reduces the complexity from O(n*m) to O(n+m), preventing a nested loop.\r\n    const statusMap = React.useMemo(() => {\r\n        return memberStatuses.reduce((acc: any, status: any) => {\r\n            acc[status.docId] = status;\r\n            return acc;\r\n        }, {});\r\n    }, [memberStatuses]);\r\n\r\n\r\n    if (memberStatuses.length === 0) {\r\n        return (\r\n            <div className={`bg-stone-50 rounded-xl ${compact ? 'p-3' : 'p-4'} border border-stone-200`}>\r\n                <p className=\"text-stone-400 text-sm text-center\">{t('no_relatives')}</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className={`bg-white rounded-2xl ${compact ? 'p-3' : 'p-4'} border border-stone-100 shadow-sm overflow-hidden`}>\r\n            <div className=\"flex items-center justify-between mb-3\">\r\n                <div className=\"flex items-center gap-2\">\r\n                    <div className=\"p-1.5 bg-indigo-50 rounded-lg\">\r\n                        <Users className=\"w-4 h-4 text-indigo-600\" />\r\n                    </div>\r\n                    <h4 className=\"text-xs font-bold text-stone-500 uppercase tracking-wide\">\r\n                        {t('family_circle')}\r\n                    </h4>\r\n                </div>\r\n            </div>\r\n            <div className=\"space-y-1\">\r\n                {context.members.map((member: any) => {\r\n                    // O(1) lookup instead of O(m) .find()\r\n                    const statusObj = statusMap[member.userId];\r\n                    // Name source of truth: THE MEMBER RECORD\r\n                    const displayName = member.displayName || (member.role === 'senior' ? seniorName : 'P├Ñr├©rende');\r\n\r\n                    return (\r\n                        <MemberStatusRow\r\n                            key={member.userId}\r\n                            name={displayName}\r\n                            status={statusObj?.status || 'home'}\r\n                            role={member.role}\r\n                            timestamp={statusObj?.updatedAt}\r\n                            isCurrentUser={member.userId === currentUserId}\r\n                        />\r\n                    );\r\n                })}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default FamilyPresence;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\familyPresence\\StatusCard.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":22,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":22,"endColumn":44},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4267,4270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4267,4270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":296,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":296,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13326,13329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13326,13329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":297,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":297,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13352,13355],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13352,13355],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { Clock, Pill, Briefcase, Home, Car, Coffee, Moon } from 'lucide-react';\r\nimport { InlineGatesIndicator } from '../tasks/ProgressRing';\r\nimport { Avatar } from '../../components/ui/Avatar';\r\nimport { Task, MemberStatus } from '../../types';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\n// ============================================================================\r\n// CONFIGURATION & CONSTANTS\r\n// ============================================================================\r\n\r\ninterface StatusOption {\r\n    id: string;\r\n    label: string;\r\n    icon: React.ElementType;\r\n    color: string;\r\n}\r\n\r\n/**\r\n * Status options for family members\r\n */\r\nexport const STATUS_OPTIONS: StatusOption[] = [\r\n    { id: 'work', label: 'P├Ñ arbejde', icon: Briefcase, color: 'bg-indigo-100 text-indigo-600' },\r\n    { id: 'home', label: 'Hjemme', icon: Home, color: 'bg-green-100 text-green-600' },\r\n    { id: 'traveling', label: 'Undervejs', icon: Car, color: 'bg-amber-100 text-amber-600' },\r\n    { id: 'available', label: 'Har tid til en snak', icon: Coffee, color: 'bg-teal-100 text-teal-600' },\r\n    { id: 'busy', label: 'Optaget', icon: Moon, color: 'bg-stone-100 text-stone-500' },\r\n];\r\n\r\n// ============================================================================\r\n// SUB-COMPONENTS\r\n// ============================================================================\r\n\r\ninterface StatusSelectorProps {\r\n    currentStatus: string;\r\n    onStatusChange: (status: string) => void;\r\n    compact?: boolean;\r\n}\r\n\r\n/**\r\n * Status selector for RELATIVE to set their status\r\n */\r\nexport const StatusSelector: React.FC<StatusSelectorProps> = ({ currentStatus, onStatusChange }) => {\r\n    const { t } = useTranslation();\r\n    return (\r\n        <div className=\"flex gap-2 justify-between\">\r\n            {STATUS_OPTIONS.map(status => {\r\n                const isActive = currentStatus === status.id;\r\n                const avatarId = ({\r\n                    'work': 'work',\r\n                    'home': 'home',\r\n                    'traveling': 'car',\r\n                    'available': 'coffee',\r\n                    'busy': 'moon'\r\n                } as Record<string, string>)[status.id] || 'home';\r\n\r\n                return (\r\n                    <button\r\n                        key={status.id}\r\n                        onClick={() => onStatusChange(status.id)}\r\n                        className={`\r\n                            group relative flex items-center justify-center p-2 rounded-xl transition-all duration-200\r\n                            ${isActive\r\n                                ? 'bg-white shadow-md ring-2 ring-indigo-500 scale-110 z-10'\r\n                                : 'bg-white/50 hover:bg-white hover:shadow-sm border border-transparent hover:border-stone-200'\r\n                            }\r\n                        `}\r\n                        title={t(`status_${status.id}`)}\r\n                    >\r\n                        <Avatar\r\n                            id={avatarId}\r\n                            size=\"sm\"\r\n                            className={`transition-transform duration-200 ${isActive ? 'scale-110' : 'group-hover:scale-110'}`}\r\n                        />\r\n                        {/* Tooltip */}\r\n                        <div className={`\r\n                            absolute -bottom-8 left-1/2 -translate-x-1/2 whitespace-nowrap px-2 py-1 rounded-md text-[10px] font-bold bg-stone-800 text-white\r\n                            pointer-events-none transition-all duration-200 z-20\r\n                            ${isActive ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-1 group-hover:opacity-100 group-hover:translate-y-0'}\r\n                        `}>\r\n                            {t(`status_${status.id}`)}\r\n                        </div>\r\n                    </button>\r\n                );\r\n            })}\r\n        </div>\r\n    );\r\n};\r\n\r\n// ============================================================================\r\n// MAIN COMPONENT\r\n// ============================================================================\r\n\r\ninterface StatusCardProps {\r\n    mode?: 'senior' | 'relative';\r\n    name?: string;\r\n    relationship?: string; // Added relationship prop\r\n    status?: string;\r\n    timestamp?: any;\r\n    className?: string;\r\n\r\n    // Senior specifics\r\n    completionRate?: number;\r\n    tasks?: Task[];\r\n    symptomCount?: number;\r\n    onViewSymptoms?: (() => void) | null;\r\n\r\n    // Relative specifics\r\n    onStatusChange?: (status: string) => void;\r\n}\r\n\r\n/**\r\n * Unified Status Card Component\r\n */\r\nexport const StatusCard: React.FC<StatusCardProps> = ({\r\n    mode = 'relative',\r\n    name = 'Bruger',\r\n    relationship,\r\n    status: statusId,\r\n    timestamp,\r\n    className = '',\r\n    completionRate = 0,\r\n    tasks = [],\r\n    symptomCount = 0,\r\n    onViewSymptoms = null\r\n}) => {\r\n    const { t } = useTranslation();\r\n\r\n    if (mode === 'senior') {\r\n        const getSeniorStatus = () => {\r\n            if (!timestamp) return {\r\n                label: t('waiting_first_check'),\r\n                theme: 'neutral',\r\n                bgPos: '50% 0%',\r\n                textColor: 'text-white'\r\n            };\r\n            if (completionRate >= 80 && symptomCount === 0) return {\r\n                label: t('peace_all_well'),\r\n                theme: 'calm',\r\n                bgPos: '0% 0%',\r\n                textColor: 'text-white'\r\n            };\r\n            if (completionRate >= 50) return {\r\n                label: t('peace_good_day'),\r\n                theme: 'neutral',\r\n                bgPos: '50% 0%',\r\n                textColor: 'text-white'\r\n            };\r\n            if (symptomCount > 0) return {\r\n                label: 'OBS: Symptomer',\r\n                theme: 'warm',\r\n                bgPos: '100% 0%',\r\n                textColor: 'text-white'\r\n            };\r\n            return {\r\n                label: t('peace_check_in'),\r\n                theme: 'warm',\r\n                bgPos: '100% 0%',\r\n                textColor: 'text-white'\r\n            };\r\n        };\r\n\r\n        const statusInfo = getSeniorStatus();\r\n        const baseUrl = import.meta.env.BASE_URL;\r\n        const bgUrl = `${baseUrl}assets/bg-atmospheric.png`;\r\n\r\n        return (\r\n            <div\r\n                className={`\r\n                    relative overflow-hidden rounded-2xl shadow-plush-lg border border-white/30 p-6 \r\n                    transition-all duration-500 ease-in-out\r\n                    ${statusInfo.theme === 'calm' ? 'animate-status-glow' : ''}\r\n                    ${className}\r\n                `}\r\n                style={{\r\n                    backgroundImage: `url(${bgUrl})`,\r\n                    backgroundPosition: statusInfo.bgPos,\r\n                    backgroundSize: '300% 100%'\r\n                }}\r\n            >\r\n                <div className=\"absolute inset-0 bg-black/10 backdrop-blur-[1px]\" />\r\n                <div className=\"relative z-10 text-white\">\r\n                    <div className=\"flex justify-between items-start mb-4\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                            <div className=\"p-1 bg-white/20 rounded-full backdrop-blur-md\">\r\n                                <Avatar id=\"senior\" size=\"md\" className=\"border-2 border-white/40\" />\r\n                            </div>\r\n                            <div>\r\n                                <h3 className=\"font-bold text-xl leading-tight drop-shadow-sm\">{name}</h3>\r\n                                <div className=\"flex items-center gap-1.5 text-xs font-medium text-white/90 bg-black/10 px-2 py-0.5 rounded-full backdrop-blur-sm mt-1 w-fit\">\r\n                                    <Clock className=\"w-3 h-3\" />\r\n                                    <span>{t('last_checked_in')}: {typeof timestamp === 'string' ? timestamp : '-'}</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"px-3 py-1.5 rounded-full text-xs font-bold bg-white/20 backdrop-blur-md border border-white/30 text-white shadow-sm\">\r\n                            {statusInfo.label}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {tasks.length > 0 && (\r\n                        <div className=\"mb-4 py-2 px-3 bg-black/10 rounded-xl backdrop-blur-sm border border-white/10\">\r\n                            <InlineGatesIndicator tasks={tasks} />\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"grid grid-cols-2 gap-3\">\r\n                        <div className=\"bg-white/15 backdrop-blur-md p-3 rounded-xl border border-white/10 flex items-center gap-3\">\r\n                            <div className=\"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center\">\r\n                                <Clock className=\"w-4 h-4 text-white\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-[10px] text-white/70 uppercase font-bold tracking-wider\">{t('peace_check_in')}</p>\r\n                                <p className=\"text-sm font-bold\">{typeof timestamp === 'string' ? timestamp : t('peace_check_in')}</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-white/15 backdrop-blur-md p-3 rounded-xl border border-white/10 flex items-center gap-3\">\r\n                            <div className=\"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center\">\r\n                                <Pill className=\"w-4 h-4 text-white\" />\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-[10px] text-white/70 uppercase font-bold tracking-wider\">{t('medication_title')}</p>\r\n                                <p className=\"text-sm font-bold\">{completionRate}% {t('taken')}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {symptomCount > 0 && (\r\n                        <button\r\n                            onClick={onViewSymptoms ? onViewSymptoms : undefined}\r\n                            className={`w-full mt-3 p-2 bg-orange-500/20 backdrop-blur-md rounded-lg border border-orange-200/30 text-center animate-pulse ${onViewSymptoms ? 'cursor-pointer hover:bg-orange-500/30 transition-colors' : ''}`}\r\n                        >\r\n                            <span className=\"text-xs font-bold text-white drop-shadow-md flex items-center justify-center gap-2\">\r\n                                ÔÜá´©Å {symptomCount} symptom{symptomCount > 1 ? 'er' : ''} rapporteret i dag\r\n                                {onViewSymptoms && <span className=\"text-[10px] opacity-80 font-normal underline\">Se detaljer</span>}\r\n                            </span>\r\n                        </button>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const statusObj = STATUS_OPTIONS.find(s => s.id === statusId) || STATUS_OPTIONS[0];\r\n    const avatarId = ({\r\n        'work': 'work',\r\n        'home': 'home',\r\n        'traveling': 'car',\r\n        'available': 'coffee',\r\n        'busy': 'moon'\r\n    } as Record<string, string>)[statusId || ''] || 'home';\r\n\r\n    let timeString = '-';\r\n    if (timestamp) {\r\n        if (typeof timestamp === 'string') {\r\n            timeString = timestamp;\r\n        } else {\r\n            const date = (timestamp && typeof timestamp.toDate === 'function')\r\n                ? timestamp.toDate()\r\n                : new Date(timestamp);\r\n            timeString = date.toLocaleTimeString('da-DK', { hour: '2-digit', minute: '2-digit' });\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className={`glass-premium p-4 mb-3 flex items-center justify-between rounded-2xl ${className}`}>\r\n            <div className=\"flex items-center gap-3\">\r\n                <Avatar id={name === 'Brad' ? 'brad' : name.includes('Fatima') ? 'fatima' : 'louise'} size=\"md\" />\r\n                <div>\r\n                    <h4 className=\"font-bold theme-text text-sm tracking-tight\">\r\n                        {name}\r\n                        {relationship && (\r\n                            <span className=\"ml-1.5 font-normal text-stone-400 text-xs capitalize text-[10px] bg-stone-100 px-1.5 py-0.5 rounded-[4px] align-middle\">\r\n                                {relationship}\r\n                            </span>\r\n                        )}\r\n                    </h4>\r\n                    <div className=\"flex items-center gap-1.5 mt-0.5\">\r\n                        <span className=\"text-xs font-bold theme-text-muted bg-stone-100/50 dark:bg-stone-800/50 px-2 py-0.5 rounded-full backdrop-blur-sm\">\r\n                            {t(`status_${statusObj.id}`)}\r\n                        </span>\r\n                        <span className=\"text-[10px] theme-text-muted opacity-60\">ÔÇó {timeString}</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div className=\"bg-gradient-to-br from-stone-50 to-stone-100/80 p-1.5 rounded-xl border border-stone-200/50 shadow-sm\">\r\n                <Avatar id={avatarId} size=\"sm\" />\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\ninterface StatusListProps {\r\n    members?: MemberStatus[];\r\n    relativeStatuses?: any[];\r\n    lastUpdated?: any;\r\n    maxDisplay?: number;\r\n}\r\n\r\nimport { useCareCircleContext } from '../../contexts/CareCircleContext';\r\n\r\n// ... (existing constants)\r\n\r\nexport const StatusList: React.FC<StatusListProps> = ({\r\n    members = [],\r\n    relativeStatuses = [],\r\n    lastUpdated,\r\n    maxDisplay = 3\r\n}) => {\r\n    const { t } = useTranslation();\r\n    const { members: allMembers } = useCareCircleContext(); // Get full member data for relationships\r\n    const relatives = members.filter(m => m.role === 'relative');\r\n\r\n    // Helper to find relationship from members list\r\n    const getRelationship = (uid: string) => {\r\n        const member = allMembers.find(m => (m.userId === uid || m.docId === uid || m.id === uid));\r\n        return member?.relationship;\r\n    };\r\n\r\n    if (relatives.length === 0 && relativeStatuses.length === 0) {\r\n        return (\r\n            <div className=\"bg-white rounded-2xl p-4 shadow-sm border-2 border-stone-100 mb-4\">\r\n                <p className=\"text-stone-400 text-sm text-center\">{t('no_relatives')}</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const statusData = relativeStatuses.length > 0\r\n        ? relativeStatuses\r\n        : relatives.map(m => ({ docId: m.docId, userId: m.userId, displayName: m.displayName, status: 'home', updatedAt: null }));\r\n\r\n    const displayedMembers = statusData.slice(0, maxDisplay);\r\n    const hiddenCount = Math.max(0, statusData.length - maxDisplay);\r\n\r\n    return (\r\n        <div className=\"space-y-2 mb-4\">\r\n            {displayedMembers.map((member, index) => (\r\n                <StatusCard\r\n                    key={member.docId || member.userId || index}\r\n                    name={member.displayName || 'P├Ñr├©rende'}\r\n                    relationship={getRelationship(member.userId || member.docId)}\r\n                    status={member.status}\r\n                    timestamp={member.updatedAt || lastUpdated}\r\n                />\r\n            ))}\r\n            {hiddenCount > 0 && (\r\n                <div className=\"text-center py-2\">\r\n                    <span className=\"text-sm text-stone-400\">\r\n                        +{hiddenCount} {hiddenCount === 1 ? t('more') : t('others')}\r\n                    </span>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default StatusCard;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\familyPresence\\SuperpowerBadge.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":18,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":18,"endColumn":66},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":256,"column":10,"nodeType":"Identifier","messageId":"namedExport","endLine":256,"endColumn":23}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { cva, type VariantProps } from 'class-variance-authority';\r\nimport { Wifi, Ear, Wrench, Car, Star, Phone, MessageCircle, X } from 'lucide-react';\r\nimport { cn } from '../../lib/utils';\r\n\r\nexport type Archetype = 'tech_wizard' | 'listener' | 'fixer' | 'driver' | 'cheerleader';\r\n\r\ninterface ArchetypeConfig {\r\n    id: Archetype;\r\n    icon: React.ElementType;\r\n    label: string;\r\n    description: string;\r\n    action: string;\r\n    color: string;\r\n}\r\n\r\nexport const ARCHETYPE_CONFIG: Record<Archetype, ArchetypeConfig> = {\r\n    tech_wizard: {\r\n        id: 'tech_wizard',\r\n        icon: Wifi,\r\n        label: 'Teknik-Ekspert',\r\n        description: 'Ring n├Ñr iPad driller eller WiFi ikke virker',\r\n        action: 'call',\r\n        color: 'bg-blue-600'\r\n    },\r\n    listener: {\r\n        id: 'listener',\r\n        icon: Ear,\r\n        label: 'Lytteren',\r\n        description: 'Ring for en god snak og lidt tr├©st',\r\n        action: 'call',\r\n        color: 'bg-purple-600'\r\n    },\r\n    fixer: {\r\n        id: 'fixer',\r\n        icon: Wrench,\r\n        label: 'Fikser-Typen',\r\n        description: 'Ring n├Ñr noget skal repareres derhjemme',\r\n        action: 'call',\r\n        color: 'bg-orange-600'\r\n    },\r\n    driver: {\r\n        id: 'driver',\r\n        icon: Car,\r\n        label: 'Chauff├©ren',\r\n        description: 'Ring for en tur til l├ªgen eller butikken',\r\n        action: 'call',\r\n        color: 'bg-green-600'\r\n    },\r\n    cheerleader: {\r\n        id: 'cheerleader',\r\n        icon: Star,\r\n        label: 'Heppen',\r\n        description: 'Del gode nyheder og f├Ñ et stort smil',\r\n        action: 'message',\r\n        color: 'bg-amber-500'\r\n    }\r\n};\r\n\r\n/**\r\n * Badge size variants using CVA\r\n */\r\nconst badgeVariants = cva(\r\n    \"rounded-full flex items-center justify-center border-2 border-white shadow-md transition-transform hover:scale-110 active:scale-95\",\r\n    {\r\n        variants: {\r\n            size: {\r\n                sm: \"w-5 h-5\",\r\n                md: \"w-8 h-8\",\r\n            },\r\n        },\r\n        defaultVariants: {\r\n            size: \"sm\",\r\n        },\r\n    }\r\n);\r\n\r\nconst iconVariants = cva(\r\n    \"text-white\",\r\n    {\r\n        variants: {\r\n            size: {\r\n                sm: \"w-3 h-3\",\r\n                md: \"w-5 h-5\",\r\n            },\r\n        },\r\n        defaultVariants: {\r\n            size: \"sm\",\r\n        },\r\n    }\r\n);\r\n\r\ninterface SuperpowerBadgeProps extends VariantProps<typeof badgeVariants> {\r\n    archetype: Archetype;\r\n    memberName: string;\r\n    onAction?: (action: 'call' | 'message', memberName: string) => void;\r\n    interactive?: boolean;\r\n}\r\n\r\nexport const SuperpowerBadge: React.FC<SuperpowerBadgeProps> = ({\r\n    archetype,\r\n    memberName,\r\n    onAction,\r\n    size = 'sm',\r\n    interactive = true\r\n}) => {\r\n    const [showActionSheet, setShowActionSheet] = useState(false);\r\n    const config = ARCHETYPE_CONFIG[archetype];\r\n\r\n    if (!config) return null;\r\n\r\n    const Icon = config.icon;\r\n\r\n    const handleTap = (e: React.MouseEvent) => {\r\n        if (!interactive) return;\r\n        e.stopPropagation();\r\n        setShowActionSheet(true);\r\n    };\r\n\r\n    const handleAction = (actionType: 'call' | 'message') => {\r\n        onAction?.(actionType, memberName);\r\n        setShowActionSheet(false);\r\n    };\r\n\r\n    return (\r\n        <>\r\n            {/* Badge Button */}\r\n            <button\r\n                onClick={handleTap}\r\n                className={cn(\r\n                    badgeVariants({ size }),\r\n                    config.color,\r\n                    interactive && \"cursor-pointer\"\r\n                )}\r\n                aria-label={`${memberName} - ${config.label}`}\r\n            >\r\n                <Icon className={cn(iconVariants({ size }))} />\r\n            </button>\r\n\r\n            {/* Action Sheet Modal - Portal to escape CSS transform context */}\r\n            {showActionSheet && createPortal(\r\n                <div\r\n                    className=\"fixed inset-0 bg-black/50 z-[100] flex items-center justify-center animate-fade-in\"\r\n                    onClick={() => setShowActionSheet(false)}\r\n                >\r\n                    <div\r\n                        className=\"bg-white w-11/12 max-w-sm rounded-2xl p-6 shadow-2xl\"\r\n                        onClick={e => e.stopPropagation()}\r\n                    >\r\n                        <div className=\"flex items-center justify-between mb-4\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <div className={cn(\"w-12 h-12 rounded-full flex items-center justify-center\", config.color)}>\r\n                                    <Icon className=\"w-6 h-6 text-white\" />\r\n                                </div>\r\n                                <div>\r\n                                    <p className=\"font-bold text-lg text-slate-800\">{memberName}</p>\r\n                                    <p className=\"text-sm text-slate-500\">{config.label}</p>\r\n                                </div>\r\n                            </div>\r\n                            <button\r\n                                onClick={() => setShowActionSheet(false)}\r\n                                className=\"p-2 hover:bg-slate-100 rounded-full\"\r\n                            >\r\n                                <X className=\"w-5 h-5 text-slate-400\" />\r\n                            </button>\r\n                        </div>\r\n\r\n                        <p className=\"text-slate-600 mb-6\">{config.description}</p>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-3\">\r\n                            <button\r\n                                onClick={() => handleAction('call')}\r\n                                className={cn(\r\n                                    \"flex items-center justify-center gap-2 p-4\",\r\n                                    \"bg-green-500 text-white font-bold rounded-2xl\",\r\n                                    \"hover:bg-green-600 transition-colors\"\r\n                                )}\r\n                            >\r\n                                <Phone className=\"w-5 h-5\" />\r\n                                Ring op\r\n                            </button>\r\n                            <button\r\n                                onClick={() => handleAction('message')}\r\n                                className={cn(\r\n                                    \"flex items-center justify-center gap-2 p-4\",\r\n                                    \"bg-indigo-500 text-white font-bold rounded-2xl\",\r\n                                    \"hover:bg-indigo-600 transition-colors\"\r\n                                )}\r\n                            >\r\n                                <MessageCircle className=\"w-5 h-5\" />\r\n                                Send besked\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>,\r\n                document.body\r\n            )}\r\n        </>\r\n    );\r\n};\r\n\r\n// Settings Panel for relatives to choose their archetype\r\ninterface ArchetypeSelectorProps {\r\n    currentArchetype?: Archetype;\r\n    onSelect: (archetype: Archetype) => void;\r\n}\r\n\r\nexport const ArchetypeSelector: React.FC<ArchetypeSelectorProps> = ({\r\n    currentArchetype,\r\n    onSelect\r\n}) => {\r\n    return (\r\n        <div className=\"space-y-3\">\r\n            <h3 className=\"text-sm font-bold text-slate-500 uppercase tracking-wide\">V├ªlg din superkraft</h3>\r\n            <p className=\"text-xs text-slate-400 mb-4\">Hvordan kan du bedst hj├ªlpe familien?</p>\r\n\r\n            <div className=\"grid grid-cols-1 gap-2\">\r\n                {Object.values(ARCHETYPE_CONFIG).map((config) => {\r\n                    const Icon = config.icon;\r\n                    const isSelected = currentArchetype === config.id;\r\n\r\n                    return (\r\n                        <button\r\n                            key={config.id}\r\n                            onClick={() => onSelect(config.id)}\r\n                            className={cn(\r\n                                \"flex items-center gap-3 p-4 rounded-xl border-2 transition-all text-left\",\r\n                                isSelected\r\n                                    ? \"border-indigo-500 bg-indigo-50\"\r\n                                    : \"border-slate-200 hover:border-slate-300 bg-white\"\r\n                            )}\r\n                        >\r\n                            <div className={cn(\"w-10 h-10 rounded-full flex items-center justify-center shrink-0\", config.color)}>\r\n                                <Icon className=\"w-5 h-5 text-white\" />\r\n                            </div>\r\n                            <div className=\"flex-1 min-w-0\">\r\n                                <p className={cn(\"font-bold\", isSelected ? \"text-indigo-700\" : \"text-slate-700\")}>\r\n                                    {config.label}\r\n                                </p>\r\n                                <p className=\"text-xs text-slate-500 truncate\">{config.description}</p>\r\n                            </div>\r\n                            {isSelected && (\r\n                                <div className=\"w-6 h-6 bg-indigo-500 rounded-full flex items-center justify-center\">\r\n                                    <span className=\"text-white text-sm\">Ô£ô</span>\r\n                                </div>\r\n                            )}\r\n                        </button>\r\n                    );\r\n                })}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport { badgeVariants };\r\nexport default SuperpowerBadge;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\familyPresence\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\familyPresence\\useMemberStatus.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[567,570],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[567,570],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[592,595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[592,595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\familyPresence\\useMemberStatus.ts:39:13\n  37 |     useEffect(() => {\n  38 |         if (!circleId) {\n> 39 |             setMemberStatuses([]);\n     |             ^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  40 |             setLoading(false);\n  41 |             return;\n  42 |         }","line":39,"column":13,"nodeType":null,"endLine":39,"endColumn":30},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2292,2295],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2292,2295],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3139,3142],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3139,3142],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n// Member Status hook - per-member status tracking via Firestore\r\n// Allows each family member to have their own status (visible to others in the circle)\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport {\r\n    collection,\r\n    doc,\r\n    setDoc,\r\n    onSnapshot,\r\n    serverTimestamp,\r\n    query\r\n} from 'firebase/firestore';\r\nimport { db } from '../../config/firebase';\r\n\r\nexport interface MemberStatus {\r\n    docId: string; // This is the userId\r\n    status: string;\r\n    displayName: string;\r\n    role: 'senior' | 'relative';\r\n    updatedAt?: any;\r\n    [key: string]: any;\r\n}\r\n\r\nexport function useMemberStatus(\r\n    circleId: string | null,\r\n    userId: string | null,\r\n    displayName: string | null,\r\n    role: 'senior' | 'relative' | null\r\n) {\r\n    const [memberStatuses, setMemberStatuses] = useState<MemberStatus[]>([]);\r\n    const [myStatus, setMyStatusState] = useState<string>('home');\r\n    const [loading, setLoading] = useState<boolean>(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    // Subscribe to all member statuses in the circle\r\n    useEffect(() => {\r\n        if (!circleId) {\r\n            setMemberStatuses([]);\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        const statusesRef = collection(db, 'careCircles', circleId, 'memberStatuses');\r\n        const statusesQuery = query(statusesRef);\r\n\r\n        const unsubscribe = onSnapshot(statusesQuery,\r\n            (snapshot) => {\r\n                const statuses = snapshot.docs.map(docSnap => ({\r\n                    docId: docSnap.id,\r\n                    ...docSnap.data()\r\n                })) as MemberStatus[];\r\n\r\n                // Debug: Log status changes\r\n                // console.log('[useMemberStatus] Received statuses:', statuses.length, statuses.map(s => `${s.displayName}: ${s.status}`));\r\n\r\n                setMemberStatuses(statuses);\r\n\r\n                // Update my own status from the fetched data\r\n                if (userId) {\r\n                    const myStatusDoc = statuses.find(s => s.docId === userId);\r\n                    if (myStatusDoc) {\r\n                        setMyStatusState(myStatusDoc.status);\r\n                    }\r\n                }\r\n\r\n                setLoading(false);\r\n            },\r\n            (err: any) => {\r\n                console.error('Error fetching member statuses:', err);\r\n                setError(err.message);\r\n                setLoading(false);\r\n            }\r\n        );\r\n\r\n        return () => unsubscribe();\r\n    }, [circleId, userId]);\r\n\r\n    // Update current user's status\r\n    const setMyStatus = useCallback(async (status: string) => {\r\n        if (!circleId || !userId) return;\r\n\r\n        const statusRef = doc(db, 'careCircles', circleId, 'memberStatuses', userId);\r\n\r\n        try {\r\n            await setDoc(statusRef, {\r\n                status,\r\n                displayName: displayName || 'Ukendt',\r\n                role: role || 'relative',\r\n                updatedAt: serverTimestamp(),\r\n            }, { merge: true });\r\n\r\n            // Optimistic update\r\n            setMyStatusState(status);\r\n        } catch (err: any) {\r\n            console.error('Error updating member status:', err);\r\n            setError(err.message);\r\n            throw err;\r\n        }\r\n    }, [circleId, userId, displayName, role]);\r\n\r\n    // Get relative statuses only (for senior to see)\r\n    const relativeStatuses = memberStatuses.filter(s => s.role === 'relative');\r\n\r\n    // Get senior status (for relatives to see)\r\n    const seniorStatus = memberStatuses.find(s => s.role === 'senior');\r\n\r\n    return {\r\n        memberStatuses,      // All members' statuses\r\n        relativeStatuses,    // Only relatives (for SeniorView)\r\n        seniorStatus,        // Only senior (for RelativeView)\r\n        myStatus,            // Current user's status\r\n        setMyStatus,         // Update current user's status\r\n        loading,\r\n        error,\r\n    };\r\n}\r\n\r\nexport default useMemberStatus;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\helpExchange\\HelpExchange.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_seniorName' is assigned a value but never used.","line":29,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":28}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { HandHeart, X, Plus } from 'lucide-react';\r\nimport { SENIOR_OFFERS, SENIOR_REQUESTS, ItemTemplate } from './config';\r\nimport { Pictogram } from '../../components/ui/Pictogram';\r\nimport { HelpOffer, HelpRequest } from '../../types';\r\n\r\ninterface HelpExchangeProps {\r\n    onOffer?: (item: ItemTemplate) => void;\r\n    onRequest?: (item: ItemTemplate) => void;\r\n    onRemoveOffer?: (docId: string) => void;\r\n    onRemoveRequest?: (docId: string) => void;\r\n    activeOffers?: HelpOffer[];\r\n    activeRequests?: HelpRequest[];\r\n    relativeOffers?: HelpOffer[];\r\n    relativeRequests?: HelpRequest[];\r\n    seniorName?: string;\r\n}\r\n\r\n// Dashboard-style HelpExchange for Senior (aligned with RelativeView)\r\nexport const HelpExchange: React.FC<HelpExchangeProps> = ({\r\n    onOffer,\r\n    onRequest,\r\n    onRemoveOffer,\r\n    onRemoveRequest,\r\n    activeOffers = [],\r\n    activeRequests = [],\r\n    relativeOffers = [],\r\n    relativeRequests = [],\r\n    seniorName: _seniorName = 'Senior'\r\n}) => {\r\n    // Pure \"Dumb\" Component - relies on props\r\n    const [showOfferPicker, setShowOfferPicker] = useState(false);\r\n    const [showRequestPicker, setShowRequestPicker] = useState(false);\r\n\r\n    // Helpers to render icon or emoji\r\n    const renderIcon = (item: ItemTemplate | HelpOffer | HelpRequest, size: 'md' | 'lg' | 'xl' = 'md') => {\r\n        if ('sprite' in item && item.sprite) {\r\n            const dims = size === 'lg' ? 'w-10 h-10' : size === 'xl' ? 'w-16 h-16' : 'w-8 h-8';\r\n            return <Pictogram sheet={item.sprite.sheet} position={item.sprite.pos} className={`${dims} shrink-0`} />;\r\n        }\r\n        return <span className={size === 'lg' ? 'text-2xl' : 'text-lg'}>{item.emoji}</span>;\r\n    };\r\n\r\n    // Filter out already active items\r\n    const availableOffers = SENIOR_OFFERS.filter(o => !activeOffers.some(active => active.id === o.id));\r\n    const availableRequests = SENIOR_REQUESTS.filter(r => !activeRequests.some(active => active.id === r.id));\r\n\r\n    return (\r\n        <div className=\"theme-card rounded-2xl p-4 space-y-5 shadow-plush\">\r\n            <h3 className=\"theme-text font-bold flex items-center gap-2 tracking-tight\">\r\n                <HandHeart className=\"w-5 h-5 text-teal-600 dark:text-teal-400\" />\r\n                Familie-B├©rsen\r\n            </h3>\r\n\r\n            {/* RELATIVES' ENTRIES - Show what family members have added */}\r\n            {(relativeOffers.length > 0 || relativeRequests.length > 0) && (\r\n                <div className=\"bg-indigo-50/80 dark:bg-indigo-900/40 rounded-xl p-3 border border-indigo-100 dark:border-indigo-800\">\r\n                    <p className=\"text-xs font-extrabold text-indigo-600 dark:text-indigo-300 uppercase tracking-widest mb-2 opacity-80\">Fra familien:</p>\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                        {relativeOffers.map((offer, i) => (\r\n                            <span key={`ro-${i}`} className=\"text-sm bg-indigo-100 dark:bg-indigo-800 text-indigo-700 dark:text-indigo-200 px-3 py-1.5 rounded-full font-bold shadow-sm\" title={`Fra: ${offer.createdByName}`}>\r\n                                ­ƒÆÜ {offer.label} <span className=\"opacity-60 text-xs\">({offer.createdByName})</span>\r\n                            </span>\r\n                        ))}\r\n                        {relativeRequests.map((req, i) => (\r\n                            <span key={`rr-${i}`} className=\"text-sm bg-purple-100 dark:bg-purple-800 text-purple-700 dark:text-purple-200 px-3 py-1.5 rounded-full font-bold shadow-sm\" title={`Fra: ${req.createdByName}`}>\r\n                                ­ƒÆ£ {req.label} <span className=\"opacity-60 text-xs\">({req.createdByName})</span>\r\n                            </span>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* OFFERS SECTION */}\r\n            <div className=\"space-y-3\">\r\n                <div className=\"flex justify-between items-center\">\r\n                    <p className=\"text-sm font-bold text-[var(--theme-text-muted)] uppercase tracking-wide\">Du tilbyder:</p>\r\n                </div>\r\n\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                    {/* Active Offers */}\r\n                    {activeOffers.map((item) => (\r\n                        <span\r\n                            key={item.docId}\r\n                            className=\"bg-teal-500 text-white pl-1.5 pr-3 py-1.5 rounded-xl flex items-center gap-2 shadow-sm animate-in fade-in zoom-in duration-200\"\r\n                        >\r\n                            {renderIcon(item, 'md')}\r\n                            <span className=\"font-medium text-sm\">{item.label}</span>\r\n                            <button\r\n                                onClick={() => onRemoveOffer?.(item.docId)}\r\n                                className=\"ml-1 p-0.5 hover:bg-teal-600 rounded-full transition-colors\"\r\n                            >\r\n                                <X className=\"w-4 h-4\" />\r\n                            </button>\r\n                        </span>\r\n                    ))}\r\n\r\n                    {/* Add Button */}\r\n                    <button\r\n                        onClick={() => setShowOfferPicker(!showOfferPicker)}\r\n                        className={`px-3 py-2 rounded-xl flex items-center gap-2 border-2 border-dashed transition-all font-bold\r\n                            ${showOfferPicker\r\n                                ? 'bg-teal-50 dark:bg-teal-900/40 border-teal-300 dark:border-teal-700 text-teal-700 dark:text-teal-200'\r\n                                : 'border-[var(--theme-card-border)] theme-text-muted hover:border-teal-300 hover:text-teal-600 hover:bg-teal-50 dark:hover:bg-teal-900/20'}\r\n                        `}\r\n                    >\r\n                        <Plus className=\"w-4 h-4\" />\r\n                        <span className=\"font-medium text-sm\">Tilbyd</span>\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Offer Picker */}\r\n                {showOfferPicker && (\r\n                    <div className=\"theme-card rounded-xl p-3 animate-in slide-in-from-top-2\">\r\n                        <p className=\"text-xs text-[var(--theme-text-muted)] mb-2 font-medium\">V├ªlg hvad du vil tilbyde:</p>\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                            {availableOffers.map(item => (\r\n                                <button\r\n                                    key={item.id}\r\n                                    onClick={() => {\r\n                                        onOffer?.(item);\r\n                                        setShowOfferPicker(false);\r\n                                    }}\r\n                                    className=\"theme-card hover:border-teal-400 hover:bg-teal-50 px-3 py-2 rounded-lg \r\n                                        flex items-center gap-2 text-sm transition-colors text-left shadow-sm\"\r\n                                >\r\n                                    {renderIcon(item, 'lg')}\r\n                                    <span className=\"text-[var(--theme-text)]\">{item.label}</span>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* SEPARATOR */}\r\n            <div className=\"border-t border-[var(--theme-card-border)]\"></div>\r\n\r\n            {/* REQUESTS SECTION */}\r\n            <div className=\"space-y-3\">\r\n                <div className=\"flex justify-between items-center\">\r\n                    <p className=\"text-sm font-bold text-[var(--theme-text-muted)] uppercase tracking-wide\">Du ├©nsker:</p>\r\n                </div>\r\n\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                    {/* Active Requests */}\r\n                    {activeRequests.map((item) => (\r\n                        <span\r\n                            key={item.docId}\r\n                            className=\"bg-indigo-500 text-white pl-1.5 pr-3 py-1.5 rounded-xl flex items-center gap-2 shadow-sm animate-in fade-in zoom-in duration-200\"\r\n                        >\r\n                            {renderIcon(item, 'md')}\r\n                            <span className=\"font-medium text-sm\">{item.label}</span>\r\n                            <button\r\n                                onClick={() => onRemoveRequest?.(item.docId)}\r\n                                className=\"ml-1 p-0.5 hover:bg-indigo-600 rounded-full transition-colors\"\r\n                            >\r\n                                <X className=\"w-4 h-4\" />\r\n                            </button>\r\n                        </span>\r\n                    ))}\r\n\r\n                    {/* Add Button */}\r\n                    <button\r\n                        onClick={() => setShowRequestPicker(!showRequestPicker)}\r\n                        className={`px-3 py-2 rounded-xl flex items-center gap-2 border-2 border-dashed transition-all\r\n                            ${showRequestPicker\r\n                                ? 'bg-indigo-50 border-indigo-300 text-indigo-700'\r\n                                : 'border-[var(--theme-card-border)] text-[var(--theme-text-muted)] hover:border-indigo-300 hover:text-indigo-600 hover:bg-indigo-50'}\r\n                        `}\r\n                    >\r\n                        <Plus className=\"w-4 h-4\" />\r\n                        <span className=\"font-medium text-sm\">Bed om</span>\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Request Picker */}\r\n                {showRequestPicker && (\r\n                    <div className=\"theme-card rounded-xl p-3 animate-in slide-in-from-top-2\">\r\n                        <p className=\"text-xs text-[var(--theme-text-muted)] mb-2 font-medium\">Hvad har du brug for?</p>\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                            {availableRequests.map(item => (\r\n                                <button\r\n                                    key={item.id}\r\n                                    onClick={() => {\r\n                                        onRequest?.(item);\r\n                                        setShowRequestPicker(false);\r\n                                    }}\r\n                                    className=\"theme-card hover:border-indigo-400 hover:bg-indigo-50 px-3 py-2 rounded-lg \r\n                                        flex items-center gap-2 text-sm transition-colors text-left shadow-sm\"\r\n                                >\r\n                                    {renderIcon(item, 'lg')}\r\n                                    <span className=\"text-[var(--theme-text)]\">{item.label}</span>\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default HelpExchange;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\helpExchange\\MatchCelebration.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\helpExchange\\config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\helpExchange\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\helpExchange\\useHelpExchange.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\helpExchange\\useHelpExchange.ts:35:13\n  33 |     useEffect(() => {\n  34 |         if (!circleId) {\n> 35 |             setHelpOffers([]);\n     |             ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  36 |             setHelpRequests([]);\n  37 |             setLoading(false);\n  38 |             return;","line":35,"column":13,"nodeType":null,"endLine":35,"endColumn":26},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1728,1731],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1728,1731],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2530,2533],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2530,2533],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3130,3133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3130,3133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":117,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4090,4093],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4090,4093],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'sanitizeHelpData'. Either include it or remove the dependency array.","line":122,"column":8,"nodeType":"ArrayExpression","endLine":122,"endColumn":49,"suggestions":[{"desc":"Update the dependencies array to be: [circleId, sanitizeHelpData, userId, userRole, displayName]","fix":{"range":[4237,4278],"text":"[circleId, sanitizeHelpData, userId, userRole, displayName]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":140,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4924,4927],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4924,4927],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'sanitizeHelpData'. Either include it or remove the dependency array.","line":145,"column":8,"nodeType":"ArrayExpression","endLine":145,"endColumn":49,"suggestions":[{"desc":"Update the dependencies array to be: [circleId, sanitizeHelpData, userId, userRole, displayName]","fix":{"range":[5073,5114],"text":"[circleId, sanitizeHelpData, userId, userRole, displayName]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":153,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":153,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5368,5371],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5368,5371],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":166,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5790,5793],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5790,5793],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n// Help Exchange hook - real-time sync via Firestore\r\n// Syncs help offers and requests across family circle members\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport {\r\n    collection,\r\n    doc,\r\n    setDoc,\r\n    deleteDoc,\r\n    onSnapshot,\r\n    serverTimestamp,\r\n    query,\r\n    orderBy,\r\n    limit\r\n} from 'firebase/firestore';\r\nimport { db } from '../../config/firebase';\r\n\r\nimport { HelpOffer, HelpRequest } from '../../types';\r\n\r\nexport function useHelpExchange(\r\n    circleId: string | null,\r\n    userId: string | null = null,\r\n    userRole: string | null = null,\r\n    displayName: string | null = null\r\n) {\r\n    const [helpOffers, setHelpOffers] = useState<HelpOffer[]>([]);\r\n    const [helpRequests, setHelpRequests] = useState<HelpRequest[]>([]);\r\n    const [loading, setLoading] = useState<boolean>(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    // Subscribe to help offers from Firestore\r\n    useEffect(() => {\r\n        if (!circleId) {\r\n            setHelpOffers([]);\r\n            setHelpRequests([]);\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        // Subscribe to offers\r\n        const offersRef = collection(db, 'careCircles', circleId, 'helpOffers');\r\n        const offersQuery = query(offersRef, orderBy('createdAt', 'desc'), limit(10));\r\n\r\n        const unsubOffers = onSnapshot(offersQuery,\r\n            (snapshot) => {\r\n                const offersList = snapshot.docs.map(docSnap => ({\r\n                    docId: docSnap.id,  // Firestore document ID for delete operations\r\n                    ...docSnap.data()\r\n                })) as HelpOffer[];\r\n                setHelpOffers(offersList);\r\n            },\r\n            (err: any) => {\r\n                console.error('Error fetching help offers:', err);\r\n                setError(err.message);\r\n            }\r\n        );\r\n\r\n        // Subscribe to requests\r\n        const requestsRef = collection(db, 'careCircles', circleId, 'helpRequests');\r\n        const requestsQuery = query(requestsRef, orderBy('createdAt', 'desc'), limit(10));\r\n\r\n        const unsubRequests = onSnapshot(requestsQuery,\r\n            (snapshot) => {\r\n                const requestsList = snapshot.docs.map(docSnap => ({\r\n                    docId: docSnap.id,  // Firestore document ID for delete operations\r\n                    ...docSnap.data()\r\n                })) as HelpRequest[];\r\n                setHelpRequests(requestsList);\r\n                setLoading(false);\r\n            },\r\n            (err: any) => {\r\n                console.error('Error fetching help requests:', err);\r\n                setError(err.message);\r\n                setLoading(false);\r\n            }\r\n        );\r\n\r\n        return () => {\r\n            unsubOffers();\r\n            unsubRequests();\r\n        };\r\n    }, [circleId]);\r\n\r\n    // Whitelist of safe fields to save to Firestore\r\n    // React components (icon) and their Symbol properties are NOT safe\r\n    const SAFE_HELP_FIELDS = ['id', 'label', 'emoji'];\r\n\r\n    const sanitizeHelpData = (data: Partial<HelpOffer | HelpRequest>) => {\r\n        const clean: Record<string, any> = {};\r\n        const safeData = data as Record<string, unknown>;\r\n        SAFE_HELP_FIELDS.forEach(key => {\r\n            const val = safeData[key];\r\n            if (val !== undefined && typeof val !== 'function' && typeof val !== 'symbol') {\r\n                clean[key] = val;\r\n            }\r\n        });\r\n        return clean;\r\n    };\r\n\r\n    // Add a help offer\r\n    const addOffer = useCallback(async (offer: Partial<HelpOffer>) => {\r\n        if (!circleId) return;\r\n\r\n        const offerId = `offer_${Date.now()}`;\r\n        const offerRef = doc(db, 'careCircles', circleId, 'helpOffers', offerId);\r\n\r\n        try {\r\n            await setDoc(offerRef, {\r\n                ...sanitizeHelpData(offer),\r\n                createdByUid: userId,\r\n                createdByRole: userRole,\r\n                createdByName: displayName || 'Ukendt',\r\n                createdAt: serverTimestamp(),\r\n            });\r\n            return offerId;\r\n        } catch (err: any) {\r\n            console.error('Error adding help offer:', err);\r\n            setError(err.message);\r\n            throw err;\r\n        }\r\n    }, [circleId, userId, userRole, displayName]);\r\n\r\n    // Add a help request\r\n    const addRequest = useCallback(async (request: Partial<HelpRequest>) => {\r\n        if (!circleId) return;\r\n\r\n        const requestId = `request_${Date.now()}`;\r\n        const requestRef = doc(db, 'careCircles', circleId, 'helpRequests', requestId);\r\n\r\n        try {\r\n            await setDoc(requestRef, {\r\n                ...sanitizeHelpData(request),\r\n                createdByUid: userId,\r\n                createdByRole: userRole,\r\n                createdByName: displayName || 'Ukendt',\r\n                createdAt: serverTimestamp(),\r\n            });\r\n            return requestId;\r\n        } catch (err: any) {\r\n            console.error('Error adding help request:', err);\r\n            setError(err.message);\r\n            throw err;\r\n        }\r\n    }, [circleId, userId, userRole, displayName]);\r\n\r\n    // Remove an offer\r\n    const removeOffer = useCallback(async (offerId: string) => {\r\n        if (!circleId) return;\r\n\r\n        try {\r\n            await deleteDoc(doc(db, 'careCircles', circleId, 'helpOffers', offerId));\r\n        } catch (err: any) {\r\n            console.error('Error removing help offer:', err);\r\n            setError(err.message);\r\n            throw err;\r\n        }\r\n    }, [circleId]);\r\n\r\n    // Remove a request\r\n    const removeRequest = useCallback(async (requestId: string) => {\r\n        if (!circleId) return;\r\n\r\n        try {\r\n            await deleteDoc(doc(db, 'careCircles', circleId, 'helpRequests', requestId));\r\n        } catch (err: any) {\r\n            console.error('Error removing help request:', err);\r\n            setError(err.message);\r\n            throw err;\r\n        }\r\n    }, [circleId]);\r\n\r\n    return {\r\n        helpOffers,\r\n        helpRequests,\r\n        loading,\r\n        error,\r\n        addOffer,\r\n        addRequest,\r\n        removeOffer,\r\n        removeRequest,\r\n    };\r\n}\r\n\r\nexport default useHelpExchange;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\helpExchange\\useHelpExchangeMatch.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\memories\\AudioRecorder.tsx","messages":[{"ruleId":"no-undef","severity":2,"message":"'NodeJS' is not defined.","line":26,"column":29,"nodeType":"Identifier","messageId":"undef","endLine":26,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2770,2773],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2770,2773],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef, useEffect } from 'react';\r\nimport { Mic, Square, Play, Trash2, Check, AlertCircle } from 'lucide-react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\ninterface AudioRecorderProps {\r\n    onRecordingComplete: (blob: Blob) => void;\r\n    onReset?: () => void;\r\n    placeholder?: string;\r\n    maxLengthSeconds?: number;\r\n}\r\n\r\nexport const AudioRecorder: React.FC<AudioRecorderProps> = ({\r\n    onRecordingComplete,\r\n    onReset,\r\n    placeholder,\r\n    maxLengthSeconds = 300 // Default 5 minutes\r\n}) => {\r\n    const { t } = useTranslation();\r\n    const [isRecording, setIsRecording] = useState(false);\r\n    const [audioUrl, setAudioUrl] = useState<string | null>(null);\r\n    const [duration, setDuration] = useState(0);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    const mediaRecorderRef = useRef<MediaRecorder | null>(null);\r\n    const chunksRef = useRef<Blob[]>([]);\r\n    const timerRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n    useEffect(() => {\r\n        return () => {\r\n            if (timerRef.current) clearInterval(timerRef.current);\r\n            if (audioUrl) URL.revokeObjectURL(audioUrl);\r\n        };\r\n    }, [audioUrl]);\r\n\r\n    const startRecording = async () => {\r\n        try {\r\n            setError(null);\r\n            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n\r\n            // Check if MediaRecorder is supported\r\n            if (!window.MediaRecorder) {\r\n                setError(t('audio_recorder_not_supported'));\r\n                return;\r\n            }\r\n\r\n            mediaRecorderRef.current = new MediaRecorder(stream);\r\n            chunksRef.current = [];\r\n\r\n            mediaRecorderRef.current.ondataavailable = (e) => {\r\n                if (e.data.size > 0) chunksRef.current.push(e.data);\r\n            };\r\n\r\n            mediaRecorderRef.current.onstop = () => {\r\n                const blob = new Blob(chunksRef.current, { type: 'audio/webm' });\r\n                const url = URL.createObjectURL(blob);\r\n                setAudioUrl(url);\r\n                onRecordingComplete(blob);\r\n\r\n                // Stop all tracks to release the microphone\r\n                stream.getTracks().forEach(track => track.stop());\r\n            };\r\n\r\n            mediaRecorderRef.current.start();\r\n            setIsRecording(true);\r\n            setDuration(0);\r\n\r\n            // Timer for duration and max length\r\n            timerRef.current = setInterval(() => {\r\n                setDuration(prev => {\r\n                    if (prev >= maxLengthSeconds) {\r\n                        stopRecording();\r\n                        return prev;\r\n                    }\r\n                    return prev + 1;\r\n                });\r\n            }, 1000);\r\n\r\n        } catch (err: any) {\r\n            console.error('Recording error:', err);\r\n            if (err.name === 'NotAllowedError') {\r\n                setError(t('mic_permission_denied'));\r\n            } else {\r\n                setError(t('mic_access_error'));\r\n            }\r\n        }\r\n    };\r\n\r\n    const stopRecording = () => {\r\n        if (mediaRecorderRef.current && isRecording) {\r\n            mediaRecorderRef.current.stop();\r\n            setIsRecording(false);\r\n            if (timerRef.current) {\r\n                clearInterval(timerRef.current);\r\n                timerRef.current = null;\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleReset = () => {\r\n        setAudioUrl(null);\r\n        setDuration(0);\r\n        setError(null);\r\n        if (onReset) onReset();\r\n    };\r\n\r\n    const formatDuration = (seconds: number) => {\r\n        const mins = Math.floor(seconds / 60);\r\n        const secs = seconds % 60;\r\n        return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex flex-col items-center gap-4 p-6 bg-stone-50 rounded-3xl border-2 border-dashed border-stone-200 transition-all\">\r\n            {error && (\r\n                <div className=\"flex items-center gap-2 text-rose-600 bg-rose-50 px-4 py-2 rounded-xl text-sm font-medium animate-fade-in\">\r\n                    <AlertCircle className=\"w-4 h-4\" />\r\n                    <span>{error}</span>\r\n                </div>\r\n            )}\r\n\r\n            {!audioUrl ? (\r\n                <div className=\"flex flex-col items-center gap-4\">\r\n                    <button\r\n                        onClick={isRecording ? stopRecording : startRecording}\r\n                        className={`\r\n                            w-20 h-20 rounded-full flex items-center justify-center transition-all duration-300\r\n                            ${isRecording\r\n                                ? 'bg-rose-500 scale-110 shadow-[0_0_20px_rgba(244,63,94,0.4)] animate-pulse'\r\n                                : 'bg-teal-500 shadow-[0_10px_20px_rgba(20,184,166,0.3)] hover:scale-105 active:scale-95'\r\n                            }\r\n                        `}\r\n                        aria-label={isRecording ? t('stop_recording') : t('start_recording')}\r\n                    >\r\n                        {isRecording ? <Square className=\"text-white fill-white w-8 h-8\" /> : <Mic className=\"text-white w-8 h-8\" />}\r\n                    </button>\r\n\r\n                    <div className=\"text-center\">\r\n                        <p className={`font-bold transition-colors ${isRecording ? 'text-rose-600' : 'text-stone-600'}`}>\r\n                            {isRecording ? t('recording_active') : placeholder || t('press_to_tell_story')}\r\n                        </p>\r\n                        {isRecording && (\r\n                            <p className=\"text-rose-400 font-mono text-xl mt-1\">{formatDuration(duration)}</p>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            ) : (\r\n                <div className=\"w-full space-y-4 animate-fade-in\">\r\n                    <div className=\"bg-white p-4 rounded-2xl shadow-sm border border-stone-100 flex items-center gap-4\">\r\n                        <button\r\n                            onClick={() => new Audio(audioUrl).play()}\r\n                            className=\"w-12 h-12 bg-teal-100 flex items-center justify-center rounded-full hover:bg-teal-200 transition-colors group\"\r\n                            aria-label={t('play_recording')}\r\n                        >\r\n                            <Play className=\"w-6 h-6 text-teal-700 fill-teal-700 group-hover:scale-110 transition-transform\" />\r\n                        </button>\r\n\r\n                        <div className=\"flex-1 h-2 bg-stone-100 rounded-full overflow-hidden\">\r\n                            <div className=\"h-full bg-teal-500 w-full opacity-30\" />\r\n                        </div>\r\n\r\n                        <span className=\"text-sm font-mono text-stone-400\">{formatDuration(duration)}</span>\r\n                    </div>\r\n\r\n                    <div className=\"flex gap-3\">\r\n                        <button\r\n                            onClick={handleReset}\r\n                            className=\"flex-1 flex items-center justify-center gap-2 p-3 bg-stone-100 text-stone-600 font-bold rounded-2xl hover:bg-stone-200 transition-colors active:scale-95\"\r\n                        >\r\n                            <Trash2 className=\"w-5 h-5\" />\r\n                            {t('delete_and_retry')}\r\n                        </button>\r\n                        <div className=\"flex-[0.3] p-3 bg-teal-50 text-teal-600 flex items-center justify-center rounded-2xl\">\r\n                            <Check className=\"w-6 h-6\" />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\memories\\MemoriesGallery.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[440,443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[440,443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1414,1417],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1414,1417],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { collection, query, orderBy, onSnapshot, limit } from 'firebase/firestore';\r\nimport { db } from '../../config/firebase';\r\nimport { Mic, Play, Calendar, User, History } from 'lucide-react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\ninterface Memory {\r\n    id: string;\r\n    url: string;\r\n    type: 'audio' | 'photo' | 'video';\r\n    createdByName: string;\r\n    createdAt: any;\r\n    questionText?: string;\r\n    duration?: number;\r\n}\r\n\r\ninterface MemoriesGalleryProps {\r\n    circleId: string;\r\n}\r\n\r\nexport const MemoriesGallery: React.FC<MemoriesGalleryProps> = ({ circleId }) => {\r\n    const { t } = useTranslation();\r\n    const [memories, setMemories] = useState<Memory[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        if (!circleId) return;\r\n\r\n        const memoriesRef = collection(db, 'careCircles', circleId, 'memories');\r\n        const q = query(memoriesRef, orderBy('createdAt', 'desc'), limit(50));\r\n\r\n        const unsubscribe = onSnapshot(q, (snapshot) => {\r\n            const memoriesList = snapshot.docs.map(doc => ({\r\n                id: doc.id,\r\n                ...doc.data()\r\n            })) as Memory[];\r\n            setMemories(memoriesList);\r\n            setLoading(false);\r\n        });\r\n\r\n        return () => unsubscribe();\r\n    }, [circleId]);\r\n\r\n    const formatTime = (timestamp: any) => {\r\n        if (!timestamp) return '';\r\n        const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);\r\n        return date.toLocaleDateString(undefined, { day: 'numeric', month: 'short' });\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex justify-center py-10\">\r\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (memories.length === 0) {\r\n        return (\r\n            <div className=\"bg-stone-50 rounded-2xl p-8 text-center border-2 border-dashed border-stone-200\">\r\n                <History className=\"w-12 h-12 text-stone-300 mx-auto mb-3\" />\r\n                <p className=\"text-stone-500 font-medium\">{t('no_memories_yet')}</p>\r\n                <p className=\"text-xs text-stone-400 mt-1\">{t('memories_will_appear_here')}</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            <div className=\"flex items-center justify-between px-1\">\r\n                <h3 className=\"font-bold text-stone-700 flex items-center gap-2\">\r\n                    <History className=\"w-5 h-5 text-indigo-500\" />\r\n                    {t('livsbog_title')}\r\n                </h3>\r\n                <span className=\"text-xs text-stone-400 font-medium bg-stone-100 px-2 py-1 rounded-full\">\r\n                    {memories.length} {t('stories')}\r\n                </span>\r\n            </div>\r\n\r\n            <div className=\"grid gap-4\">\r\n                {memories.map((memory) => (\r\n                    <div key={memory.id} className=\"bg-white rounded-2xl p-4 border border-stone-100 shadow-sm hover:shadow-md transition-shadow\">\r\n                        <div className=\"flex items-start gap-4\">\r\n                            <button\r\n                                onClick={() => new Audio(memory.url).play()}\r\n                                className=\"w-12 h-12 bg-indigo-50 flex items-center justify-center rounded-2xl text-indigo-600 hover:bg-indigo-100 transition-colors shrink-0\"\r\n                            >\r\n                                <Play fill=\"currentColor\" size={24} />\r\n                            </button>\r\n\r\n                            <div className=\"flex-1 min-w-0\">\r\n                                <p className=\"font-bold text-stone-800 truncate\">\r\n                                    {memory.questionText || t('untilted_memory')}\r\n                                </p>\r\n                                <div className=\"flex items-center gap-3 mt-1 text-xs text-stone-400\">\r\n                                    <span className=\"flex items-center gap-1\">\r\n                                        <User size={12} />\r\n                                        {memory.createdByName}\r\n                                    </span>\r\n                                    <span className=\"flex items-center gap-1\">\r\n                                        <Calendar size={12} />\r\n                                        {formatTime(memory.createdAt)}\r\n                                    </span>\r\n                                    <span className=\"flex items-center gap-1\">\r\n                                        <Mic size={12} />\r\n                                        {memory.type === 'audio' ? t('audio') : memory.type}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\memories\\useMemories.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3061,3064],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3061,3064],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3398,3401],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3398,3401],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback } from 'react';\r\nimport { ref, uploadBytesResumable, getDownloadURL } from 'firebase/storage';\r\nimport { collection, addDoc, serverTimestamp } from 'firebase/firestore';\r\nimport { storage, db } from '../../config/firebase';\r\n\r\nexport interface MemoryMetadata {\r\n    title?: string;\r\n    description?: string;\r\n    type: 'audio' | 'photo' | 'video';\r\n    circleId: string;\r\n    createdByUid: string;\r\n    createdByName: string;\r\n    questionId?: string;\r\n    questionText?: string;\r\n    duration?: number;\r\n}\r\n\r\nexport const useMemories = () => {\r\n    const [isUploading, setIsUploading] = useState(false);\r\n    const [uploadProgress, setUploadProgress] = useState(0);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    const uploadMemory = useCallback(async (blob: Blob, metadata: MemoryMetadata) => {\r\n        if (!metadata.circleId || !metadata.createdByUid) {\r\n            setError('Missing required metadata (circleId or uid)');\r\n            return null;\r\n        }\r\n\r\n        setIsUploading(true);\r\n        setUploadProgress(0);\r\n        setError(null);\r\n\r\n        try {\r\n            // 1. Generate unique file name\r\n            const timestamp = Date.now();\r\n            const extension = metadata.type === 'audio' ? 'webm' : 'jpg';\r\n            const fileName = `memories/${metadata.circleId}/${metadata.type}_${timestamp}.${extension}`;\r\n            const storageRef = ref(storage, fileName);\r\n\r\n            // 2. Upload to Firebase Storage\r\n            const uploadTask = uploadBytesResumable(storageRef, blob);\r\n\r\n            return new Promise<string | null>((resolve, reject) => {\r\n                uploadTask.on(\r\n                    'state_changed',\r\n                    (snapshot) => {\r\n                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\r\n                        setUploadProgress(progress);\r\n                    },\r\n                    (err) => {\r\n                        console.error('Upload error:', err);\r\n                        setError(err.message);\r\n                        setIsUploading(false);\r\n                        reject(err);\r\n                    },\r\n                    async () => {\r\n                        try {\r\n                            // 3. Get Download URL\r\n                            const downloadUrl = await getDownloadURL(uploadTask.snapshot.ref);\r\n\r\n                            // 4. Save to Firestore\r\n                            const memoriesRef = collection(db, 'careCircles', metadata.circleId, 'memories');\r\n                            await addDoc(memoriesRef, {\r\n                                ...metadata,\r\n                                url: downloadUrl,\r\n                                storagePath: fileName,\r\n                                createdAt: serverTimestamp(),\r\n                            });\r\n\r\n                            setIsUploading(false);\r\n                            setUploadProgress(100);\r\n                            resolve(downloadUrl);\r\n                        } catch (err: any) {\r\n                            console.error('Firestore save error:', err);\r\n                            setError(err.message);\r\n                            setIsUploading(false);\r\n                            reject(err);\r\n                        }\r\n                    }\r\n                );\r\n            });\r\n        } catch (err: any) {\r\n            console.error('Memory upload error initiation:', err);\r\n            setError(err.message);\r\n            setIsUploading(false);\r\n            return null;\r\n        }\r\n    }, []);\r\n\r\n    return {\r\n        uploadMemory,\r\n        isUploading,\r\n        uploadProgress,\r\n        error\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\onboarding\\AudioContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":20,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":20,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState } from 'react';\r\n\r\ninterface AudioContextType {\r\n    isMuted: boolean;\r\n    setIsMuted: (muted: boolean) => void;\r\n}\r\n\r\nconst AudioContext = createContext<AudioContextType | undefined>(undefined);\r\n\r\nexport const AudioProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n    const [isMuted, setIsMuted] = useState(true);\r\n\r\n    return (\r\n        <AudioContext.Provider value={{ isMuted, setIsMuted }}>\r\n            {children}\r\n        </AudioContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useAudio = () => {\r\n    const context = useContext(AudioContext);\r\n    if (!context) {\r\n        throw new Error('useAudio must be used within an AudioProvider');\r\n    }\r\n    return context;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\onboarding\\Onboarding.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\onboarding\\RelationshipMatrix.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2277,2280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2277,2280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { useState, useEffect } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport type { Member } from '../../types';\r\nimport { RelationsSelect } from '../../components/ui/RelationsSelect';\r\nimport { doc, updateDoc } from 'firebase/firestore';\r\nimport { db } from '../../config/firebase';\r\nimport { Check, X } from 'lucide-react'; // StepIcon, Users, UserPlus removed as unused\r\n\r\ninterface RelationshipMatrixProps {\r\n    currentMember: Member;\r\n    allMembers: Member[];\r\n    onComplete: () => void;\r\n}\r\n\r\nexport function RelationshipMatrix({ currentMember, allMembers, onComplete }: RelationshipMatrixProps) {\r\n    // Filter out self\r\n    const targets = allMembers.filter(m => m.userId !== currentMember.userId);\r\n\r\n    const [step, setStep] = useState<'gender' | 'matrix'>(currentMember.gender ? 'matrix' : 'gender');\r\n    const [myGender, setMyGender] = useState<'male' | 'female' | 'other' | undefined>(currentMember.gender);\r\n\r\n    const [currentIndex, setCurrentIndex] = useState(0);\r\n    const [relations, setRelations] = useState<Record<string, string>>({});\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const currentTarget = targets[currentIndex];\r\n    const isLast = currentIndex === targets.length - 1;\r\n\r\n    const [targetGender, setTargetGender] = useState<'male' | 'female' | 'other' | undefined>(undefined);\r\n\r\n    // Reset target gender when index changes\r\n    useEffect(() => {\r\n        setTargetGender(undefined);\r\n    }, [currentIndex]);\r\n\r\n    const handleGenderSelect = (gender: 'male' | 'female' | 'other') => {\r\n        setMyGender(gender);\r\n        setStep('matrix');\r\n    };\r\n\r\n    const handleSelect = (relation: string) => {\r\n        setRelations(prev => ({\r\n            ...prev,\r\n            [currentTarget.userId || currentTarget.docId]: relation\r\n        }));\r\n    };\r\n\r\n    const handleNext = async () => {\r\n        if (isLast) {\r\n            await saveEdges();\r\n        } else {\r\n            setCurrentIndex(prev => prev + 1);\r\n        }\r\n    };\r\n\r\n    const saveEdges = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const memberRef = doc(db, 'careCircleMemberships', currentMember.docId!);\r\n\r\n            // Prepare update data\r\n            const updateData: Record<string, any> = {\r\n                edges: relations,\r\n                relationsLastUpdated: new Date()\r\n            };\r\n\r\n            // Only update gender if it wasn't set before\r\n            if (!currentMember.gender && myGender) {\r\n                updateData.gender = myGender;\r\n            }\r\n\r\n            await updateDoc(memberRef, updateData);\r\n            onComplete();\r\n        } catch (err) {\r\n            console.error(\"Error saving family edges:\", err);\r\n            alert(\"Der skete en fejl. Pr├©v igen.\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    if (targets.length === 0 && step === 'matrix') return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-[100] flex items-end sm:items-center justify-center bg-black/80 backdrop-blur-sm sm:p-4\">\r\n            <div className=\"w-full max-w-md bg-white sm:rounded-2xl rounded-t-2xl shadow-xl overflow-hidden max-h-[90vh] flex flex-col animate-in slide-in-from-bottom-5 sm:slide-in-from-bottom-0 sm:zoom-in-95 duration-200\">\r\n\r\n                {/* Header (Progress & Close) */}\r\n                <div className=\"relative\">\r\n                    {step === 'matrix' && (\r\n                        <div className=\"h-1 bg-stone-100\">\r\n                            <motion.div\r\n                                className=\"h-full bg-teal-500\"\r\n                                initial={{ width: 0 }}\r\n                                animate={{ width: `${((currentIndex + 1) / targets.length) * 100}%` }}\r\n                            />\r\n                        </div>\r\n                    )}\r\n                    <button\r\n                        onClick={onComplete}\r\n                        className=\"absolute top-3 right-3 p-2 text-stone-400 hover:text-stone-600 rounded-full hover:bg-stone-100 transition-colors z-10\"\r\n                    >\r\n                        <X size={20} />\r\n                    </button>\r\n                    <div className=\"p-6 pb-2 text-center\">\r\n                        <h2 className=\"text-xl font-bold text-stone-800\">\r\n                            {step === 'gender' ? 'Velkommen' : 'Hvem er du?'}\r\n                        </h2>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Content Area - Scrollable */}\r\n                <div className=\"flex-1 overflow-y-auto p-6 pt-2\">\r\n                    {step === 'gender' ? (\r\n                        <div className=\"space-y-6 text-center\">\r\n                            <p className=\"text-stone-500\">\r\n                                For at g├©re det nemmere at v├ªlge relationer, skal vi vide dit k├©n.\r\n                            </p>\r\n                            <div className=\"grid grid-cols-1 gap-3\">\r\n                                <button onClick={() => handleGenderSelect('female')} className=\"p-4 rounded-xl border border-stone-200 hover:border-pink-300 hover:bg-pink-50 transition-all font-medium text-stone-700 hover:text-pink-800 flex items-center justify-center gap-2\">\r\n                                    ­ƒæ® Kvinde\r\n                                </button>\r\n                                <button onClick={() => handleGenderSelect('male')} className=\"p-4 rounded-xl border border-stone-200 hover:border-blue-300 hover:bg-blue-50 transition-all font-medium text-stone-700 hover:text-blue-800 flex items-center justify-center gap-2\">\r\n                                    ­ƒæ¿ Mand\r\n                                </button>\r\n                                <button onClick={() => handleGenderSelect('other')} className=\"p-4 rounded-xl border border-stone-200 hover:bg-stone-50 transition-all font-medium text-stone-600\">\r\n                                    Andet\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <AnimatePresence mode=\"wait\">\r\n                            <motion.div\r\n                                key={currentTarget.userId || currentTarget.docId}\r\n                                initial={{ x: 20, opacity: 0 }}\r\n                                animate={{ x: 0, opacity: 1 }}\r\n                                exit={{ x: -20, opacity: 0 }}\r\n                                className=\"flex flex-col items-center gap-6\"\r\n                            >\r\n                                <div className=\"w-20 h-20 rounded-full bg-stone-100 flex items-center justify-center border-4 border-white shadow-sm\">\r\n                                    <span className=\"text-xl font-bold text-stone-600\">\r\n                                        {currentTarget.displayName?.[0] || '?'}\r\n                                    </span>\r\n                                </div>\r\n\r\n                                <div className=\"w-full space-y-4\">\r\n                                    <p className=\"text-lg font-medium text-stone-800 text-center\">\r\n                                        Hvem er <span className=\"text-teal-600\">{currentTarget.displayName}</span> for dig?\r\n                                    </p>\r\n\r\n                                    {/* Target Gender Toggle for Decluttering */}\r\n                                    <div className=\"flex justify-center gap-2\">\r\n                                        <button\r\n                                            onClick={() => setTargetGender(targetGender === 'female' ? undefined : 'female')}\r\n                                            className={`px-4 py-1.5 rounded-full text-sm font-medium transition-colors ${targetGender === 'female' ? 'bg-pink-100 text-pink-700 border border-pink-200' : 'bg-stone-50 text-stone-500 hover:bg-stone-100'}`}\r\n                                        >\r\n                                            Hun\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => setTargetGender(targetGender === 'male' ? undefined : 'male')}\r\n                                            className={`px-4 py-1.5 rounded-full text-sm font-medium transition-colors ${targetGender === 'male' ? 'bg-blue-100 text-blue-700 border border-blue-200' : 'bg-stone-50 text-stone-500 hover:bg-stone-100'}`}\r\n                                        >\r\n                                            Han\r\n                                        </button>\r\n                                    </div>\r\n\r\n                                    <div className=\"max-w-xs mx-auto text-left\">\r\n                                        <RelationsSelect\r\n                                            value={relations[currentTarget.userId || currentTarget.docId] || ''}\r\n                                            onChange={handleSelect}\r\n                                            seniorName={currentTarget.displayName}\r\n                                            targetGender={targetGender} // Use manual target gender\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            </motion.div>\r\n                        </AnimatePresence>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Sticky Footer */}\r\n                {step === 'matrix' && (\r\n                    <div className=\"p-4 border-t border-stone-100 bg-white flex justify-end shrink-0 safe-area-bottom\">\r\n                        <button\r\n                            onClick={handleNext}\r\n                            disabled={!relations[currentTarget.userId || currentTarget.docId] || loading}\r\n                            className=\"px-8 py-3 bg-stone-900 text-white rounded-full font-bold shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 hover:scale-105 active:scale-95 transition-all w-full sm:w-auto justify-center\"\r\n                        >\r\n                            {loading ? 'Gemmer...' : isLast ? 'F├ªrdig' : 'N├ªste'}\r\n                            {!loading && <Check size={18} />}\r\n                        </button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\onboarding\\RelativeWelcome.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\onboarding\\SeniorWelcome.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\onboarding\\WelcomeLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\onboarding\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\onboarding\\useVideoAutoplay.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\onboarding\\useVideoAutoplay.ts","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'isMuted'. Either include it or remove the dependency array.","line":24,"column":8,"nodeType":"ArrayExpression","endLine":24,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [isMuted, step]","fix":{"range":[1011,1017],"text":"[isMuted, step]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\photos\\PhotoShare.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\photos\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\photos\\usePhotos.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\photos\\usePhotos.ts:38:13\n  36 |     useEffect(() => {\n  37 |         if (!circleId) {\n> 38 |             setPhotos([]);\n     |             ^^^^^^^^^ Avoid calling setState() directly within an effect\n  39 |             setLatestPhoto(null);\n  40 |             setLoading(false);\n  41 |             return;","line":38,"column":13,"nodeType":null,"endLine":38,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2041,2044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2041,2044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3635,3638],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3635,3638],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":138,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4603,4606],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4603,4606],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n// Photos hook - ephemeral daily photo sharing via Firestore + Storage\r\n// Photos are deleted after viewing (client-side delete)\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport {\r\n    collection,\r\n    doc,\r\n    setDoc,\r\n    deleteDoc,\r\n    onSnapshot,\r\n    serverTimestamp,\r\n    query,\r\n    orderBy,\r\n    limit\r\n} from 'firebase/firestore';\r\nimport {\r\n    ref,\r\n    uploadBytes,\r\n    getDownloadURL,\r\n    deleteObject\r\n} from 'firebase/storage';\r\nimport { db, storage } from '../../config/firebase';\r\nimport { resizeImage } from '../../utils/imageUtils';\r\n\r\nimport { Photo } from '../../types';\r\n\r\nexport function usePhotos(circleId: string | null, currentUserId: string | null) {\r\n    const [photos, setPhotos] = useState<Photo[]>([]);\r\n    const [latestPhoto, setLatestPhoto] = useState<Photo | null>(null);\r\n    const [loading, setLoading] = useState<boolean>(true);\r\n    const [uploading, setUploading] = useState<boolean>(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    // Subscribe to photos from Firestore\r\n    useEffect(() => {\r\n        if (!circleId) {\r\n            setPhotos([]);\r\n            setLatestPhoto(null);\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        const photosRef = collection(db, 'careCircles', circleId, 'photos');\r\n        const photosQuery = query(photosRef, orderBy('uploadedAt', 'desc'), limit(5));\r\n\r\n        const unsubscribe = onSnapshot(photosQuery,\r\n            (snapshot) => {\r\n                const photosList = snapshot.docs.map(doc => ({\r\n                    id: doc.id,\r\n                    ...doc.data()\r\n                })) as Photo[];\r\n                setPhotos(photosList);\r\n\r\n                // Find latest unviewed photo from another user\r\n                const unviewedPhoto = photosList.find(p =>\r\n                    p.fromUserId !== currentUserId && !p.viewedAt\r\n                );\r\n                setLatestPhoto(unviewedPhoto || null);\r\n\r\n                setLoading(false);\r\n            },\r\n            (err: any) => {\r\n                console.error('Error fetching photos:', err);\r\n                setError(err.message);\r\n                setLoading(false);\r\n            }\r\n        );\r\n\r\n        return () => unsubscribe();\r\n    }, [circleId, currentUserId]);\r\n\r\n    // Upload a photo\r\n    const uploadPhoto = useCallback(async (file: File, fromName: string) => {\r\n        if (!circleId || !currentUserId) return;\r\n\r\n        setUploading(true);\r\n        setError(null);\r\n\r\n        try {\r\n            // Resize image before upload\r\n            const resizedBlob = await resizeImage(file, 1200, 0.85);\r\n\r\n            // Generate unique filename\r\n            const photoId = `photo_${Date.now()}`;\r\n            const storagePath = `careCircles/${circleId}/photos/${photoId}.jpg`;\r\n            const storageRef = ref(storage, storagePath);\r\n\r\n            // Upload to Storage\r\n            await uploadBytes(storageRef, resizedBlob, {\r\n                contentType: 'image/jpeg',\r\n            });\r\n\r\n            // Get download URL\r\n            const downloadUrl = await getDownloadURL(storageRef);\r\n\r\n            // Create Firestore doc\r\n            const photoRef = doc(db, 'careCircles', circleId, 'photos', photoId);\r\n            await setDoc(photoRef, {\r\n                imageUrl: downloadUrl,\r\n                storagePath,\r\n                fromUserId: currentUserId,\r\n                fromName: fromName || 'Familie',\r\n                uploadedAt: serverTimestamp(),\r\n                viewedAt: null,\r\n            });\r\n\r\n            setUploading(false);\r\n            return photoId;\r\n        } catch (err: any) {\r\n            console.error('Error uploading photo:', err);\r\n            setError(err.message);\r\n            setUploading(false);\r\n            throw err;\r\n        }\r\n    }, [circleId, currentUserId]);\r\n\r\n    // Delete a photo (called when viewer closes it)\r\n    const deletePhoto = useCallback(async (photoId: string, storagePath?: string) => {\r\n        if (!circleId) return;\r\n\r\n        try {\r\n            // Delete from Storage\r\n            if (storagePath) {\r\n                const storageRef = ref(storage, storagePath);\r\n                await deleteObject(storageRef).catch(() => {\r\n                    // Ignore if already deleted\r\n                });\r\n            }\r\n\r\n            // Delete from Firestore\r\n            await deleteDoc(doc(db, 'careCircles', circleId, 'photos', photoId));\r\n\r\n            // Clear from local state\r\n            if (latestPhoto?.id === photoId) {\r\n                setLatestPhoto(null);\r\n            }\r\n        } catch (err: any) {\r\n            console.error('Error deleting photo:', err);\r\n            setError(err.message);\r\n            throw err;\r\n        }\r\n    }, [circleId, latestPhoto]);\r\n\r\n    // Mark photo as viewed (for tracking, before delete)\r\n    const markViewed = useCallback(async (photoId: string) => {\r\n        if (!circleId) return;\r\n\r\n        try {\r\n            await setDoc(doc(db, 'careCircles', circleId, 'photos', photoId), {\r\n                viewedAt: serverTimestamp(),\r\n            }, { merge: true });\r\n        } catch (err) {\r\n            console.error('Error marking photo viewed:', err);\r\n        }\r\n    }, [circleId]);\r\n\r\n    return {\r\n        photos,\r\n        latestPhoto,\r\n        loading,\r\n        uploading,\r\n        error,\r\n        uploadPhoto,\r\n        deletePhoto,\r\n        markViewed,\r\n    };\r\n}\r\n\r\nexport default usePhotos;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\symptoms\\BodyPainSelector.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":21,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":21,"endColumn":28},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":34,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":34,"endColumn":31},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":41,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":41,"endColumn":40},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":53,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":53,"endColumn":46},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":201,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":201,"endColumn":32},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":207,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":207,"endColumn":32},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":213,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":213,"endColumn":29}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { ChevronRight, ChevronLeft } from 'lucide-react';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nexport interface SeverityLevel {\r\n    id: 'mild' | 'moderate' | 'severe';\r\n    label: string;\r\n    emoji: string;\r\n    color: string;\r\n}\r\n\r\nexport interface BodyRegion {\r\n    id: string;\r\n    label: string;\r\n    emoji: string;\r\n    severity?: Omit<SeverityLevel, 'color'>; // When selected, we store severity details\r\n}\r\n\r\n// Body regions for pain mapping - ordered anatomically (top ÔåÆ bottom)\r\n// Returns localized labels using translation function\r\nexport const getBodyRegions = (t: (key: string) => string): BodyRegion[] => [\r\n    { id: 'head', label: t('body_head'), emoji: '­ƒºá' },\r\n    { id: 'neck', label: t('body_neck'), emoji: '­ƒª┤' },\r\n    { id: 'chest', label: t('body_chest'), emoji: 'ÔØñ´©Å' },\r\n    { id: 'back', label: t('body_back'), emoji: '­ƒöÖ' },\r\n    { id: 'stomach', label: t('body_stomach'), emoji: '­ƒñó' },\r\n    { id: 'leftArm', label: t('body_left_arm'), emoji: '­ƒÆ¬' },\r\n    { id: 'rightArm', label: t('body_right_arm'), emoji: '­ƒÆ¬' },\r\n    { id: 'leftLeg', label: t('body_left_leg'), emoji: '­ƒªÁ' },\r\n    { id: 'rightLeg', label: t('body_right_leg'), emoji: '­ƒªÁ' },\r\n];\r\n\r\n// Pain severity levels - simple 3-level scale (localized)\r\nexport const getSeverityLevels = (t: (key: string) => string): SeverityLevel[] => [\r\n    { id: 'mild', label: t('severity_mild'), emoji: '­ƒÖé', color: 'bg-green-100 border-green-400 text-green-700' },\r\n    { id: 'moderate', label: t('severity_moderate'), emoji: '­ƒÿÉ', color: 'bg-amber-100 border-amber-400 text-amber-700' },\r\n    { id: 'severe', label: t('severity_severe'), emoji: '­ƒÿú', color: 'bg-rose-100 border-rose-400 text-rose-700' },\r\n];\r\n\r\n// Keep the old exports for backwards compatibility (Danish fallback)\r\nexport const BODY_REGIONS: BodyRegion[] = [\r\n    { id: 'head', label: 'Hoved', emoji: '­ƒºá' },\r\n    { id: 'neck', label: 'Nakke', emoji: '­ƒª┤' },\r\n    { id: 'chest', label: 'Bryst', emoji: 'ÔØñ´©Å' },\r\n    { id: 'back', label: 'Ryg', emoji: '­ƒöÖ' },\r\n    { id: 'stomach', label: 'Mave', emoji: '­ƒñó' },\r\n    { id: 'leftArm', label: 'Venstre arm', emoji: '­ƒÆ¬' },\r\n    { id: 'rightArm', label: 'H├©jre arm', emoji: '­ƒÆ¬' },\r\n    { id: 'leftLeg', label: 'Venstre ben', emoji: '­ƒªÁ' },\r\n    { id: 'rightLeg', label: 'H├©jre ben', emoji: '­ƒªÁ' },\r\n];\r\n\r\nexport const SEVERITY_LEVELS: SeverityLevel[] = [\r\n    { id: 'mild', label: 'Lidt', emoji: '­ƒÖé', color: 'bg-green-100 border-green-400 text-green-700' },\r\n    { id: 'moderate', label: 'Noget', emoji: '­ƒÿÉ', color: 'bg-amber-100 border-amber-400 text-amber-700' },\r\n    { id: 'severe', label: 'Meget', emoji: '­ƒÿú', color: 'bg-rose-100 border-rose-400 text-rose-700' },\r\n];\r\n\r\ninterface BodyPainSelectorProps {\r\n    onSelectLocation: (location: BodyRegion) => void;\r\n    onBack?: () => void;\r\n}\r\n\r\n// Two-step selector: body location ÔåÆ severity\r\nexport const BodyPainSelector: React.FC<BodyPainSelectorProps> = ({ onSelectLocation, onBack }) => {\r\n    const { t } = useTranslation();\r\n    const [step, setStep] = useState(1); // 1 = location, 2 = severity\r\n    const [selectedLocation, setSelectedLocation] = useState<BodyRegion | null>(null);\r\n    const [selectedSeverity, setSelectedSeverity] = useState<SeverityLevel | null>(null);\r\n\r\n    // Get localized regions and severity levels\r\n    const bodyRegions = getBodyRegions(t);\r\n    const severityLevels = getSeverityLevels(t);\r\n\r\n    const handleLocationSelect = (region: BodyRegion) => {\r\n        setSelectedLocation(region);\r\n        setStep(2); // Move to severity selection\r\n    };\r\n\r\n    const handleSeveritySelect = (severity: SeverityLevel) => {\r\n        setSelectedSeverity(severity);\r\n    };\r\n\r\n    const handleConfirm = () => {\r\n        if (selectedLocation && selectedSeverity) {\r\n            onSelectLocation({\r\n                id: selectedLocation.id,\r\n                label: selectedLocation.label,\r\n                emoji: selectedLocation.emoji,\r\n                severity: {\r\n                    id: selectedSeverity.id,\r\n                    label: selectedSeverity.label,\r\n                    emoji: selectedSeverity.emoji\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    const handleBackToLocation = () => {\r\n        setStep(1);\r\n        setSelectedSeverity(null);\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            {step === 1 ? (\r\n                // Step 1: Body location selection\r\n                <>\r\n                    <p className=\"text-lg text-center text-stone-600 mb-4\">\r\n                        {t('where_does_it_hurt')}\r\n                    </p>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-3 mb-4\">\r\n                        {bodyRegions.map(region => (\r\n                            <button\r\n                                key={region.id}\r\n                                onClick={() => handleLocationSelect(region)}\r\n                                className=\"p-4 rounded-2xl border-2 transition-all duration-200\r\n                                    flex items-center gap-3 text-left\r\n                                    bg-white border-stone-200 hover:border-rose-300 hover:bg-rose-50\r\n                                    focus:outline-none focus:ring-2 focus:ring-rose-400 focus:ring-offset-2\"\r\n                                aria-label={t('select_location', { label: region.label })}\r\n                            >\r\n                                <span className=\"text-2xl\">{region.emoji}</span>\r\n                                <span className=\"font-semibold text-stone-700\">{region.label}</span>\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n\r\n                    <button\r\n                        onClick={onBack}\r\n                        className=\"w-full p-3 text-stone-500 text-sm hover:text-stone-700 focus:outline-none focus:ring-2 focus:ring-stone-300\"\r\n                        aria-label={t('go_back_symptom_selection')}\r\n                    >\r\n                        <ChevronLeft className=\"w-4 h-4 inline mr-1\" />\r\n                        {t('back')}\r\n                    </button>\r\n                </>\r\n            ) : (\r\n                // Step 2: Pain severity selection\r\n                <>\r\n                    <div className=\"text-center mb-4\">\r\n                        <span className=\"text-3xl\">{selectedLocation?.emoji}</span>\r\n                        <p className=\"text-lg text-stone-600 mt-2\">\r\n                            {t('pain_how_much', { location: selectedLocation?.label.toLowerCase() })}\r\n                        </p>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-3 mb-4\">\r\n                        {severityLevels.map(level => (\r\n                            <button\r\n                                key={level.id}\r\n                                onClick={() => handleSeveritySelect(level)}\r\n                                className={`\r\n                                    w-full p-5 rounded-2xl border-2 transition-all duration-200\r\n                                    flex items-center justify-center gap-4 text-xl font-bold\r\n                                    focus:outline-none focus:ring-2 focus:ring-offset-2\r\n                                    ${selectedSeverity?.id === level.id\r\n                                        ? `${level.color} ring-2 ring-offset-1`\r\n                                        : 'bg-white border-stone-200 hover:bg-stone-50'\r\n                                    }\r\n                                `}\r\n                                aria-label={t('pain_level_label', { level: level.label })}\r\n                            >\r\n                                <span className=\"text-4xl\">{level.emoji}</span>\r\n                                <span>{level.label}</span>\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {/* Confirm button */}\r\n                    {selectedSeverity && (\r\n                        <button\r\n                            onClick={handleConfirm}\r\n                            className=\"w-full p-4 bg-rose-500 text-white rounded-2xl font-bold text-lg \r\n                                flex items-center justify-center gap-2 hover:bg-rose-600 \r\n                                transition-colors focus:outline-none focus:ring-2 focus:ring-rose-400 focus:ring-offset-2\"\r\n                            aria-label={t('confirm')}\r\n                        >\r\n                            {t('confirm')}\r\n                            <ChevronRight className=\"w-5 h-5\" />\r\n                        </button>\r\n                    )}\r\n\r\n                    <button\r\n                        onClick={handleBackToLocation}\r\n                        className=\"w-full p-3 text-stone-500 text-sm hover:text-stone-700 \r\n                            focus:outline-none focus:ring-2 focus:ring-stone-300\"\r\n                        aria-label={t('select_another_location')}\r\n                    >\r\n                        <ChevronLeft className=\"w-4 h-4 inline mr-1\" />\r\n                        {t('select_another_location')}\r\n                    </button>\r\n                </>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n// Get label for body region by ID\r\nexport const getBodyRegionLabel = (id: string) => {\r\n    const region = BODY_REGIONS.find(r => r.id === id);\r\n    return region ? region.label : id;\r\n};\r\n\r\n// Get emoji for body region by ID\r\nexport const getBodyRegionEmoji = (id: string) => {\r\n    const region = BODY_REGIONS.find(r => r.id === id);\r\n    return region ? region.emoji : '­ƒôì';\r\n};\r\n\r\n// Get severity info by ID\r\nexport const getSeverityInfo = (id: string) => {\r\n    return SEVERITY_LEVELS.find(s => s.id === id);\r\n};\r\n\r\nexport default BodyPainSelector;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\symptoms\\SymptomSummary.tsx","messages":[{"ruleId":"no-undef","severity":2,"message":"'React' is not defined.","line":12,"column":15,"nodeType":"Identifier","messageId":"undef","endLine":12,"endColumn":20},{"ruleId":"no-undef","severity":2,"message":"'React' is not defined.","line":99,"column":30,"nodeType":"Identifier","messageId":"undef","endLine":99,"endColumn":35}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useMemo } from 'react';\r\nimport { AlertCircle, ChevronDown, ChevronUp, Phone, Calendar } from 'lucide-react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { SymptomLog, FirestoreDate } from '../../types';\r\nimport { toJsDate } from '../../utils/dateUtils';\r\nimport { TFunction } from 'i18next';\r\n\r\ninterface TrendAnalysis {\r\n    trend: 'none' | 'warning' | 'increasing' | 'decreasing' | 'stable';\r\n    message: string | null;\r\n    cta: {\r\n        icon: React.ElementType;\r\n        text: string;\r\n        action: string;\r\n    } | null;\r\n}\r\n\r\n// Check if a date is today\r\nconst isToday = (timestamp: FirestoreDate | undefined) => {\r\n    const date = toJsDate(timestamp);\r\n    if (!date) return false;\r\n    const today = new Date();\r\n    return date.toDateString() === today.toDateString();\r\n};\r\n\r\n// Check if date is within last N days\r\nconst isWithinDays = (timestamp: FirestoreDate | undefined, days: number) => {\r\n    const date = toJsDate(timestamp);\r\n    if (!date) return false;\r\n    const cutoff = new Date();\r\n    cutoff.setDate(cutoff.getDate() - days);\r\n    return date >= cutoff;\r\n};\r\n\r\n// Get trend analysis for symptoms\r\nconst analyzeTrend = (symptoms: SymptomLog[], t: TFunction): TrendAnalysis => {\r\n    if (symptoms.length === 0) return { trend: 'none', message: null, cta: null };\r\n\r\n    // Count symptoms by day for last 7 days\r\n    const last3Days = symptoms.filter(s => isWithinDays(s.loggedAt, 3)).length;\r\n    const prev4Days = symptoms.filter(s =>\r\n        isWithinDays(s.loggedAt, 7) && !isWithinDays(s.loggedAt, 3)\r\n    ).length;\r\n\r\n    // Count severe symptoms\r\n    const severeCount = symptoms.filter(s =>\r\n        s.bodyLocation?.severity?.id === 'severe'\r\n    ).length;\r\n\r\n    // Analyze patterns\r\n    if (severeCount >= 2) {\r\n        return {\r\n            trend: 'warning',\r\n            message: t('severe_symptoms_count', { count: severeCount }),\r\n            cta: { icon: Phone, text: t('contact_doctor_cta'), action: 'call' }\r\n        };\r\n    }\r\n\r\n    if (last3Days > prev4Days * 1.5 && last3Days >= 3) {\r\n        return {\r\n            trend: 'increasing',\r\n            message: t('increasing_symptoms_msg'),\r\n            cta: { icon: Calendar, text: t('book_doctor_cta'), action: 'book' }\r\n        };\r\n    }\r\n\r\n    if (last3Days < prev4Days * 0.5) {\r\n        return {\r\n            trend: 'decreasing',\r\n            message: t('decreasing_symptoms_msg'),\r\n            cta: null\r\n        };\r\n    }\r\n\r\n    return {\r\n        trend: 'stable',\r\n        message: t('stable_symptoms_msg', { count: symptoms.length }),\r\n        cta: null\r\n    };\r\n};\r\n\r\ninterface SymptomSummaryProps {\r\n    symptomLogs?: SymptomLog[];\r\n    onViewReport?: () => void;\r\n    hideTitle?: boolean;\r\n}\r\n\r\n// Helper to get friendly advice based on symptom\r\nconst getSymptomAdvice = (symptomLabel: string, t: TFunction): string => {\r\n    const label = symptomLabel.toLowerCase();\r\n    if (label.includes('kvalme')) return t('symptom_advice_nausea', 'Kvalme kan lindres med ingef├ªr-te og frisk luft.');\r\n    if (label.includes('hovedpine')) return t('symptom_advice_headache', 'Husk at drikke vand og sikre ro omkring dig.');\r\n    if (label.includes('svimmel')) return t('symptom_advice_dizzyness', 'Rejs dig langsomt og st├©t dig til noget fast.');\r\n    if (label.includes('smerte')) return t('symptom_advice_pain', 'Sp├©rg om medicin skal justeres, hvis smerter forts├ªtter.');\r\n    return t('symptom_advice_generic', 'Ring og h├©r hvordan det g├Ñr. En stemme varmer.');\r\n};\r\n\r\n// Symptom Summary Card - shows today's symptoms with 7-day overview\r\nexport const SymptomSummary: React.FC<SymptomSummaryProps> = ({ symptomLogs = [], onViewReport, hideTitle = false }) => {\r\n    const { t } = useTranslation();\r\n    const [showOlder, setShowOlder] = useState(false);\r\n\r\n    // Split symptoms\r\n    const { todaySymptoms, weekSymptoms } = useMemo(() => {\r\n        const today = symptomLogs.filter(s => isToday(s.loggedAt));\r\n        const week = symptomLogs.filter(s => isWithinDays(s.loggedAt, 7) && !isToday(s.loggedAt));\r\n        return { todaySymptoms: today, weekSymptoms: week };\r\n    }, [symptomLogs]);\r\n\r\n    // Get trend analysis\r\n    const weeklySymptoms = symptomLogs.filter(s => isWithinDays(s.loggedAt, 7));\r\n    const trend = useMemo(() => analyzeTrend(weeklySymptoms, t), [weeklySymptoms, t]);\r\n\r\n    // Most frequent symptom for Nudge\r\n    const topSymptom = useMemo(() => {\r\n        if (weekSymptoms.length === 0) return null;\r\n        const counts: Record<string, number> = {};\r\n        weekSymptoms.forEach(s => {\r\n            const type = s.label || s.id;\r\n            counts[type] = (counts[type] || 0) + 1;\r\n        });\r\n        const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);\r\n        return sorted[0] ? sorted[0][0] : null;\r\n    }, [weekSymptoms]);\r\n\r\n    // Hide entire component if NO symptoms at all (Today or Week)\r\n    // \"Remove or hide the entire element, when there are no symptoms that day\" \r\n    // (INTERPRETATION: User likely meant \"If nothing to show, show nothing\". \r\n    // But keeps Week view if relevant.)\r\n    if (todaySymptoms.length === 0 && weekSymptoms.length === 0) return null;\r\n\r\n    return (\r\n        <div className=\"bg-orange-50 border-2 border-orange-100 rounded-2xl p-4 space-y-3 shadow-sm\">\r\n            {/* Today's Symptoms - Only show if present */}\r\n            {todaySymptoms.length > 0 && (\r\n                <div>\r\n                    {!hideTitle && (\r\n                        <h4 className=\"text-orange-800 font-bold flex items-center gap-2 mb-2\">\r\n                            <AlertCircle className=\"w-5 h-5\" />\r\n                            {t('symptoms_today_count', { count: todaySymptoms.length })}\r\n                        </h4>\r\n                    )}\r\n                    <div className=\"space-y-2\">\r\n                        {todaySymptoms.map((log, i) => (\r\n                            <div key={i} className=\"flex items-center justify-between text-sm text-orange-900 bg-white/70 p-3 rounded-xl border border-orange-100\">\r\n                                <div className=\"flex flex-wrap items-center gap-2\">\r\n                                    <span className=\"font-bold\">{log.label}</span>\r\n                                    {log.bodyLocation && (\r\n                                        <span className=\"text-orange-600 text-xs bg-orange-100 px-2 py-0.5 rounded-full\">\r\n                                            {log.bodyLocation.emoji} {log.bodyLocation.label}\r\n                                        </span>\r\n                                    )}\r\n                                </div>\r\n                                <span className=\"text-orange-500 text-xs font-medium whitespace-nowrap\">{log.time}</span>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* 7-Day Summary Nudge - \"Insight\" instead of \"Count\" */}\r\n            {weekSymptoms.length > 0 && (\r\n                <div className={`${todaySymptoms.length > 0 ? 'border-t border-orange-200 pt-3' : ''}`}>\r\n                    <button\r\n                        onClick={() => setShowOlder(!showOlder)}\r\n                        className=\"w-full text-left\"\r\n                    >\r\n                        {/* Insight Nudge Header */}\r\n                        <div className=\"flex items-start gap-3\">\r\n                            <div className=\"bg-orange-100 p-2 rounded-full mt-1\">\r\n                                <Phone className=\"w-4 h-4 text-orange-600\" />\r\n                            </div>\r\n                            <div>\r\n                                <h5 className=\"text-sm font-bold text-orange-900\">\r\n                                    {topSymptom ? t('symptom_insight_title', { symptom: topSymptom }) : t('symptom_insight_general')}\r\n                                </h5>\r\n                                <p className=\"text-xs text-orange-700 mt-1 leading-relaxed\">\r\n                                    {topSymptom ? getSymptomAdvice(topSymptom, t) : t('symptom_insight_generic_body')}\r\n                                </p>\r\n                                <button className=\"mt-2 text-xs font-bold text-orange-800 bg-white/70 px-3 py-1 rounded-full border border-orange-200 hover:bg-white shadow-sm transition-colors\" onClick={(e) => {\r\n                                    e.stopPropagation();\r\n                                    alert('Ringer til familien...');\r\n                                }}>\r\n                                    ­ƒô× Ring nu\r\n                                </button>\r\n                            </div>\r\n                            <div className=\"ml-auto pl-2\">\r\n                                {showOlder ? <ChevronUp className=\"w-4 h-4 text-orange-400\" /> : <ChevronDown className=\"w-4 h-4 text-orange-400\" />}\r\n                            </div>\r\n                        </div>\r\n                    </button>\r\n\r\n                    {/* Expanded History */}\r\n                    {\r\n                        showOlder && (\r\n                            <div className=\"space-y-2 mt-4 animate-fade-in\">\r\n                                <h6 className=\"text-xs font-bold text-orange-400 uppercase tracking-widest mb-2\">{t('history_last_7_days')}</h6>\r\n                                {weekSymptoms.map((log, i) => (\r\n                                    <div key={i} className=\"flex items-center justify-between text-sm text-orange-800 bg-white/50 p-2 rounded-lg\">\r\n                                        <span>{log.label}</span>\r\n                                        <span className=\"text-xs text-orange-400\">{log.date}</span>\r\n                                    </div>\r\n                                ))}\r\n                                {onViewReport && (\r\n                                    <button\r\n                                        onClick={onViewReport}\r\n                                        className=\"w-full text-center text-xs text-orange-500 hover:text-orange-700 transition-colors mt-2 font-medium\"\r\n                                    >\r\n                                        {t('see_full_history')} ÔåÆ\r\n                                    </button>\r\n                                )}\r\n                            </div>\r\n                        )\r\n                    }\r\n                </div >\r\n            )}\r\n\r\n            {/* Trend-based CTA */}\r\n            {\r\n                trend.cta && (\r\n                    <div className=\"border-t border-orange-200 pt-3\">\r\n                        <button\r\n                            onClick={() => {\r\n                                // Future: integrate with phone/calendar\r\n                                if (trend.cta?.action === 'call') {\r\n                                    alert('Ring til l├ªge funktionalitet kommer snart');\r\n                                }\r\n                            }}\r\n                            className=\"w-full flex items-center justify-center gap-2 py-2 px-4 bg-orange-100 hover:bg-orange-200 text-orange-800 rounded-xl text-sm font-medium transition-colors\"\r\n                        >\r\n                            <trend.cta.icon className=\"w-4 h-4\" />\r\n                            {trend.cta.text}\r\n                        </button>\r\n                    </div>\r\n                )\r\n            }\r\n\r\n            {/* Link to full report */}\r\n            {\r\n                onViewReport && !showOlder && ( // Only show if not already shown in expanded view\r\n                    <button\r\n                        onClick={onViewReport}\r\n                        className=\"w-full text-center text-xs text-orange-500 hover:text-orange-700 transition-colors\"\r\n                    >\r\n                        {t('see_full_history')}\r\n                    </button>\r\n                )\r\n            }\r\n        </div >\r\n    );\r\n};\r\n\r\nexport default SymptomSummary;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\symptoms\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\symptoms\\useSymptoms.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\symptoms\\useSymptoms.ts:30:13\n  28 |     useEffect(() => {\n  29 |         if (!circleId) {\n> 30 |             setSymptoms([]);\n     |             ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  31 |             setLoading(false);\n  32 |             return;\n  33 |         }","line":30,"column":13,"nodeType":null,"endLine":30,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1520,1523],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1520,1523],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2060,2063],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2060,2063],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3221,3224],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3221,3224],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'sanitizeSymptomData'. Either include it or remove the dependency array.","line":98,"column":8,"nodeType":"ArrayExpression","endLine":98,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [circleId, sanitizeSymptomData]","fix":{"range":[3365,3375],"text":"[circleId, sanitizeSymptomData]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":106,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3638,3641],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3638,3641],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n// Symptoms hook - real-time symptom log sync via Firestore\r\n// Replaces localStorage for multi-user symptom tracking\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport {\r\n    collection,\r\n    doc,\r\n    setDoc,\r\n    deleteDoc,\r\n    onSnapshot,\r\n    serverTimestamp,\r\n    query,\r\n    orderBy,\r\n    limit\r\n} from 'firebase/firestore';\r\nimport { db } from '../../config/firebase';\r\n\r\nimport { SymptomLog, SymptomStats } from '../../types';\r\nimport { toJsDate } from '../../utils/dateUtils';\r\n\r\nexport function useSymptoms(circleId: string | null) {\r\n    const [symptoms, setSymptoms] = useState<SymptomLog[]>([]);\r\n    const [loading, setLoading] = useState<boolean>(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    // Subscribe to symptoms from Firestore (most recent first, limited)\r\n    useEffect(() => {\r\n        if (!circleId) {\r\n            setSymptoms([]);\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        const symptomsRef = collection(db, 'careCircles', circleId, 'symptoms');\r\n        const symptomsQuery = query(symptomsRef, orderBy('loggedAt', 'desc'), limit(50));\r\n\r\n        const unsubscribe = onSnapshot(symptomsQuery,\r\n            (snapshot) => {\r\n                const symptomsList = snapshot.docs.map(doc => ({\r\n                    id: doc.id,\r\n                    ...doc.data()\r\n                })) as SymptomLog[];\r\n                setSymptoms(symptomsList);\r\n                setLoading(false);\r\n            },\r\n            (err: any) => {\r\n                console.error('Error fetching symptoms:', err);\r\n                setError(err.message);\r\n                setLoading(false);\r\n            }\r\n        );\r\n\r\n        return () => unsubscribe();\r\n    }, [circleId]);\r\n\r\n    // Whitelist of safe fields to save to Firestore\r\n    // React components and their Symbol properties are NOT safe\r\n    const SAFE_SYMPTOM_FIELDS = ['id', 'label', 'color', 'bodyLocation'];\r\n\r\n    const sanitizeSymptomData = (data: Partial<SymptomLog>) => {\r\n        const clean: Record<string, any> = {};\r\n        const safeData = data as Record<string, unknown>;\r\n        SAFE_SYMPTOM_FIELDS.forEach(key => {\r\n            const val = safeData[key];\r\n            if (val !== undefined && typeof val !== 'function' && typeof val !== 'symbol') {\r\n                clean[key] = val;\r\n            }\r\n        });\r\n        return clean;\r\n    };\r\n\r\n    // Add a new symptom log\r\n    const addSymptom = useCallback(async (symptomData: Partial<SymptomLog>) => {\r\n        if (!circleId) return;\r\n\r\n        const now = new Date();\r\n        const timeString = now.getHours().toString().padStart(2, '0') + ':' +\r\n            now.getMinutes().toString().padStart(2, '0');\r\n        const dateString = now.toLocaleDateString('da-DK');\r\n\r\n        const symptomId = `symptom_${Date.now()}`;\r\n        const symptomRef = doc(db, 'careCircles', circleId, 'symptoms', symptomId);\r\n\r\n        try {\r\n            await setDoc(symptomRef, {\r\n                ...sanitizeSymptomData(symptomData),\r\n                time: timeString,\r\n                date: dateString,\r\n                loggedAt: serverTimestamp(),\r\n            });\r\n            return symptomId;\r\n        } catch (err: any) {\r\n            console.error('Error adding symptom:', err);\r\n            setError(err.message);\r\n            throw err;\r\n        }\r\n    }, [circleId]);\r\n\r\n    // Delete a symptom log\r\n    const removeSymptom = useCallback(async (symptomId: string) => {\r\n        if (!circleId) return;\r\n\r\n        try {\r\n            await deleteDoc(doc(db, 'careCircles', circleId, 'symptoms', symptomId));\r\n        } catch (err: any) {\r\n            console.error('Error removing symptom:', err);\r\n            setError(err.message);\r\n            throw err;\r\n        }\r\n    }, [circleId]);\r\n\r\n    // Get symptoms for a specific date range (for reports)\r\n    const getSymptomsByDateRange = useCallback((startDate: Date, endDate: Date) => {\r\n        return symptoms.filter(s => {\r\n            const symptomDate = toJsDate(s.loggedAt);\r\n            if (!symptomDate) return false;\r\n            return symptomDate >= startDate && symptomDate <= endDate;\r\n        });\r\n    }, [symptoms]);\r\n\r\n    // Get symptom stats for doctor report\r\n    const getSymptomStats = useCallback(() => {\r\n        const stats: Record<string, SymptomStats> = {};\r\n        symptoms.forEach(s => {\r\n            const type = s.id || s.label || 'unknown';\r\n            if (!stats[type]) {\r\n                stats[type] = { count: 0, lastOccurrence: null };\r\n            }\r\n            stats[type].count++;\r\n            if (!stats[type].lastOccurrence) {\r\n                stats[type].lastOccurrence = s.date;\r\n            }\r\n        });\r\n        return stats;\r\n    }, [symptoms]);\r\n\r\n    return {\r\n        symptoms,\r\n        loading,\r\n        error,\r\n        addSymptom,\r\n        removeSymptom,\r\n        getSymptomsByDateRange,\r\n        getSymptomStats,\r\n    };\r\n}\r\n\r\nexport default useSymptoms;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\tasks\\ProgressRing.tsx","messages":[{"ruleId":"no-undef","severity":2,"message":"'React' is not defined.","line":100,"column":28,"nodeType":"Identifier","messageId":"undef","endLine":100,"endColumn":33},{"ruleId":"no-undef","severity":2,"message":"'React' is not defined.","line":207,"column":35,"nodeType":"Identifier","messageId":"undef","endLine":207,"endColumn":40},{"ruleId":"no-undef","severity":2,"message":"'React' is not defined.","line":240,"column":36,"nodeType":"Identifier","messageId":"undef","endLine":240,"endColumn":41}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Task } from '../../types';\r\nimport { cn } from '../../lib/utils';\r\n\r\n/**\r\n * ProgressRing - A 3-segment ring showing daily progress with color-coded compliance\r\n * \r\n * Segments: Morgen (Morning), Eftermiddag (Afternoon), Aften (Evening)\r\n * Colors:\r\n *   - Gr├©n (Green): Completed on time (within ┬▒2 hours)\r\n *   - Gul (Yellow): Completed late (outside expected window)\r\n *   - R├©d (Red): Not completed / Overdue\r\n *   - Gray: Future / Not yet due\r\n */\r\n\r\ntype Period = 'morgen' | 'eftermiddag' | 'aften';\r\ntype Status = 'onTime' | 'late' | 'overdue' | 'pending' | 'complete';\r\n\r\ninterface SegmentConfig {\r\n    label: string;\r\n    start: number;\r\n    end: number;\r\n    emoji: string;\r\n}\r\n\r\nconst SEGMENT_CONFIG: Record<Period, SegmentConfig> = {\r\n    morgen: { label: 'Morgen', start: 6, end: 12, emoji: 'ÔÿÇ´©Å' },\r\n    eftermiddag: { label: 'Eftermiddag', start: 12, end: 18, emoji: '­ƒîñ´©Å' },\r\n    aften: { label: 'Aften', start: 18, end: 22, emoji: '­ƒîÖ' }\r\n};\r\n\r\ninterface StatusColor {\r\n    stroke: string;\r\n    fill: string;\r\n    label: string;\r\n}\r\n\r\nconst STATUS_COLORS: Record<Status, StatusColor> = {\r\n    onTime: { stroke: '#10B981', fill: '#D1FAE5', label: 'Til tiden' },     // Green\r\n    late: { stroke: '#F59E0B', fill: '#FEF3C7', label: 'For sent' },        // Yellow\r\n    overdue: { stroke: '#EF4444', fill: '#FEE2E2', label: 'Mangler' },      // Red\r\n    pending: { stroke: '#D1D5DB', fill: '#F3F4F6', label: 'Afventer' },     // Gray\r\n    complete: { stroke: '#10B981', fill: '#D1FAE5', label: 'F├ªrdig' }       // Green (all done)\r\n};\r\n\r\n/**\r\n * Determine segment status based on tasks and current time\r\n * @param {Array} tasks - Tasks for this segment\r\n * @param {string} period - 'morgen' | 'eftermiddag' | 'aften'\r\n * @param {number} currentHour - Current hour (0-23)\r\n */\r\nconst getSegmentStatus = (tasks: Task[], period: Period, currentHour: number): Status => {\r\n    const config = SEGMENT_CONFIG[period];\r\n    // Cast period check because Task.period might be string, but logic implies matching values.\r\n    const periodTasks = tasks.filter(t => t.period === period);\r\n\r\n    if (periodTasks.length === 0) {\r\n        // No tasks for this period\r\n        return currentHour >= config.end ? 'complete' : 'pending';\r\n    }\r\n\r\n    const completedTasks = periodTasks.filter(t => t.completed);\r\n    const allComplete = completedTasks.length === periodTasks.length;\r\n\r\n    // If period hasn't started yet\r\n    if (currentHour < config.start) {\r\n        return 'pending';\r\n    }\r\n\r\n    // If period is in the past\r\n    if (currentHour >= config.end) {\r\n        if (allComplete) {\r\n            // Check if completed on time (simplified: assume on time if completed)\r\n            return 'onTime';\r\n        }\r\n        return 'overdue';\r\n    }\r\n\r\n    // Period is currently active\r\n    if (allComplete) {\r\n        return 'onTime';\r\n    }\r\n\r\n    // Check if we're past the expected time window (+2 hours grace)\r\n    const graceEnd = config.end + 2;\r\n    if (currentHour >= graceEnd) {\r\n        return completedTasks.length > 0 ? 'late' : 'overdue';\r\n    }\r\n\r\n    return 'pending';\r\n};\r\n\r\ninterface ProgressRingProps {\r\n    tasks?: Task[];\r\n    size?: number;\r\n    strokeWidth?: number;\r\n    showLabels?: boolean;\r\n    className?: string;\r\n}\r\n\r\nexport const ProgressRing: React.FC<ProgressRingProps> = ({\r\n    tasks = [],\r\n    size = 120,\r\n    strokeWidth = 12,\r\n    showLabels = true,\r\n    className = ''\r\n}) => {\r\n    const currentHour = new Date().getHours();\r\n    const radius = (size - strokeWidth) / 2;\r\n    const circumference = 2 * Math.PI * radius;\r\n    const segmentLength = circumference / 3;\r\n    const gap = 4; // Gap between segments\r\n\r\n    const segments = (['morgen', 'eftermiddag', 'aften'] as Period[]).map((period, index) => {\r\n        const status = getSegmentStatus(tasks, period, currentHour);\r\n        const colors = STATUS_COLORS[status];\r\n        const config = SEGMENT_CONFIG[period];\r\n\r\n        // Calculate stroke dash offset for each segment\r\n        const offset = index * segmentLength;\r\n\r\n        return {\r\n            period,\r\n            status,\r\n            colors,\r\n            config,\r\n            offset,\r\n            dashArray: `${segmentLength - gap} ${circumference - segmentLength + gap}`\r\n        };\r\n    });\r\n\r\n    // Calculate overall progress\r\n    const totalTasks = tasks.length;\r\n    const completedTasks = tasks.filter(t => t.completed).length;\r\n    const progressPercent = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 100;\r\n\r\n    return (\r\n        <div className={`relative inline-flex flex-col items-center ${className}`}>\r\n            {/* SVG Ring with celebratory glow at 100% */}\r\n            <svg\r\n                width={size}\r\n                height={size}\r\n                className={cn(\r\n                    \"transform -rotate-90 transition-all duration-1000\",\r\n                    progressPercent === 100 && \"drop-shadow-[0_0_8px_rgba(16,185,129,0.5)]\"\r\n                )}\r\n            >\r\n                {/* Background ring */}\r\n                <circle\r\n                    cx={size / 2}\r\n                    cy={size / 2}\r\n                    r={radius}\r\n                    fill=\"none\"\r\n                    stroke=\"#E5E7EB\"\r\n                    strokeWidth={strokeWidth}\r\n                />\r\n\r\n                {/* Colored segments */}\r\n                {segments.map((seg) => (\r\n                    <circle\r\n                        key={seg.period}\r\n                        cx={size / 2}\r\n                        cy={size / 2}\r\n                        r={radius}\r\n                        fill=\"none\"\r\n                        stroke={seg.colors.stroke}\r\n                        strokeWidth={strokeWidth}\r\n                        strokeDasharray={seg.dashArray}\r\n                        strokeDashoffset={-seg.offset}\r\n                        strokeLinecap=\"round\"\r\n                        className=\"transition-all duration-500\"\r\n                    />\r\n                ))}\r\n            </svg>\r\n\r\n            {/* Center content */}\r\n            <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\r\n                <span className=\"text-2xl font-extrabold theme-text tracking-tighter leading-none\">{progressPercent}%</span>\r\n                <span className=\"text-[10px] font-bold theme-text-muted uppercase tracking-widest opacity-80\">f├ªrdig</span>\r\n            </div>\r\n\r\n            {/* Legend */}\r\n            {showLabels && (\r\n                <div className=\"flex gap-3 mt-3\">\r\n                    {segments.map(seg => (\r\n                        <div key={seg.period} className=\"flex items-center gap-1\">\r\n                            <div\r\n                                className=\"w-3 h-3 rounded-full\"\r\n                                style={{ backgroundColor: seg.colors.stroke }}\r\n                            />\r\n                            <span className=\"text-[10px] theme-text-muted font-bold\">{seg.config.emoji}</span>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\ninterface ProgressRingCompactProps {\r\n    tasks?: Task[];\r\n    size?: number;\r\n}\r\n\r\n/**\r\n * Compact version for inline use\r\n */\r\nexport const ProgressRingCompact: React.FC<ProgressRingCompactProps> = ({ tasks = [] }) => {\r\n    const currentHour = new Date().getHours();\r\n    const segments = (['morgen', 'eftermiddag', 'aften'] as Period[]).map(period =>\r\n        getSegmentStatus(tasks, period, currentHour)\r\n    );\r\n\r\n    const hasOverdue = segments.includes('overdue');\r\n    const hasLate = segments.includes('late');\r\n\r\n    const borderColor = hasOverdue ? 'border-red-400' : hasLate ? 'border-yellow-400' : 'border-green-400';\r\n    const bgColor = hasOverdue ? 'bg-red-50' : hasLate ? 'bg-yellow-50' : 'bg-green-50';\r\n    const textColor = hasOverdue ? 'text-red-600' : hasLate ? 'text-yellow-600' : 'text-green-600';\r\n\r\n    const totalTasks = tasks.length;\r\n    const completedTasks = tasks.filter(t => t.completed).length;\r\n    const progressPercent = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 100;\r\n\r\n    return (\r\n        <div className={`w-12 h-12 rounded-full border-4 ${borderColor} ${bgColor} flex items-center justify-center`}>\r\n            <span className={`text-sm font-bold ${textColor}`}>{progressPercent}%</span>\r\n        </div>\r\n    );\r\n};\r\n\r\ninterface InlineGatesIndicatorProps {\r\n    tasks?: Task[];\r\n    className?: string;\r\n}\r\n\r\n/**\r\n * Inline Gates Indicator - compact horizontal view of all 3 periods\r\n * Design: Ô¼ñ Morgen Ô£ô  Ô¼ñ Eftermiddag  Ô¼ñ Aften\r\n */\r\nexport const InlineGatesIndicator: React.FC<InlineGatesIndicatorProps> = ({ tasks = [], className = '' }) => {\r\n    const currentHour = new Date().getHours();\r\n\r\n    const periods = (['morgen', 'eftermiddag', 'aften'] as Period[]).map(period => {\r\n        const status = getSegmentStatus(tasks, period, currentHour);\r\n        const colors = STATUS_COLORS[status];\r\n        const config = SEGMENT_CONFIG[period];\r\n\r\n        // Determine checkmark or status indicator\r\n        const isComplete = status === 'onTime' || status === 'complete';\r\n        const isPending = status === 'pending';\r\n        const isOverdue = status === 'overdue';\r\n        const isLate = status === 'late';\r\n\r\n        return {\r\n            period,\r\n            label: config.label,\r\n            isComplete,\r\n            isPending,\r\n            isOverdue,\r\n            isLate,\r\n            color: colors.stroke\r\n        };\r\n    });\r\n\r\n    return (\r\n        <div className={`flex items-center justify-center gap-2 text-xs ${className}`}>\r\n            {periods.map(p => (\r\n                <div\r\n                    key={p.period}\r\n                    className=\"flex items-center gap-1\"\r\n                    title={`${p.label}: ${p.isComplete ? 'F├ªrdig' : p.isPending ? 'Afventer' : p.isOverdue ? 'Mangler' : 'For sent'}`}\r\n                >\r\n                    <span\r\n                        className=\"w-2.5 h-2.5 rounded-full\"\r\n                        style={{ backgroundColor: p.color }}\r\n                    />\r\n                    <span className={`font-bold tracking-tight ${p.isComplete ? 'text-green-700' : p.isOverdue ? 'text-red-600' : 'theme-text-muted'}`}>\r\n                        {p.label.slice(0, 3)}\r\n                        {p.isComplete && ' Ô£ô'}\r\n                    </span>\r\n                </div>\r\n            ))}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ProgressRing;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\tasks\\TaskCard.tsx","messages":[{"ruleId":"no-undef","severity":2,"message":"'React' is not defined.","line":60,"column":34,"nodeType":"Identifier","messageId":"undef","endLine":60,"endColumn":39},{"ruleId":"no-undef","severity":2,"message":"'React' is not defined.","line":67,"column":24,"nodeType":"Identifier","messageId":"undef","endLine":67,"endColumn":29},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":119,"column":10,"nodeType":"Identifier","messageId":"namedExport","endLine":119,"endColumn":22},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":119,"column":24,"nodeType":"Identifier","messageId":"namedExport","endLine":119,"endColumn":45},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":119,"column":47,"nodeType":"Identifier","messageId":"namedExport","endLine":119,"endColumn":63}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { cva } from 'class-variance-authority';\r\nimport { CheckCircle, Pill, Activity, Sun, Clock, Heart } from 'lucide-react';\r\nimport { cn } from '../../lib/utils';\r\nimport { Task } from '../../types';\r\n\r\n/**\r\n * Task card container variants\r\n * Premium styling with glass effect and plush shadows\r\n */\r\nconst cardVariants = cva(\r\n    \"relative p-4 rounded-2xl border transition-all cursor-pointer\",\r\n    {\r\n        variants: {\r\n            state: {\r\n                completed: \"bg-gradient-to-br from-stone-50/90 to-stone-100/80 border-stone-200/50 shadow-sm\",\r\n                pending: \"glass-premium shadow-plush hover:shadow-plush-lg hover:border-teal-200/60\",\r\n            },\r\n        },\r\n        defaultVariants: {\r\n            state: \"pending\",\r\n        },\r\n    }\r\n);\r\n\r\nconst iconContainerVariants = cva(\r\n    \"w-16 h-16 rounded-2xl flex items-center justify-center shadow-inner\",\r\n    {\r\n        variants: {\r\n            state: {\r\n                completed: \"bg-stone-200 text-stone-400\",\r\n                pending: \"bg-blue-50 text-blue-600\",\r\n            },\r\n        },\r\n        defaultVariants: {\r\n            state: \"pending\",\r\n        },\r\n    }\r\n);\r\n\r\nconst checkboxVariants = cva(\r\n    \"w-12 h-12 rounded-full border-4 flex items-center justify-center transition-all\",\r\n    {\r\n        variants: {\r\n            state: {\r\n                completed: \"bg-teal-500 border-teal-500 shadow-[0_0_16px_4px_hsl(174_55%_38%/0.3)]\",\r\n                pending: \"border-stone-200 bg-white shadow-sm hover:border-teal-300 hover:shadow-plush\",\r\n            },\r\n        },\r\n        defaultVariants: {\r\n            state: \"pending\",\r\n        },\r\n    }\r\n);\r\n\r\ninterface TaskCardProps {\r\n    task: Task;\r\n    onToggle: () => void;\r\n}\r\n\r\nconst TASK_ICONS: Record<string, React.ElementType> = {\r\n    medication: Pill,\r\n    hydration: Activity,\r\n    activity: Sun,\r\n    appointment: Clock,\r\n};\r\n\r\nexport const TaskCard: React.FC<TaskCardProps> = ({ task, onToggle }) => {\r\n    const state = task.completed ? 'completed' : 'pending';\r\n    const Icon = TASK_ICONS[task.type || 'activity'] || Sun;\r\n\r\n    return (\r\n        <div\r\n            onClick={onToggle}\r\n            className={cn(cardVariants({ state }))}\r\n        >\r\n            <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    {/* Pictogram Container */}\r\n                    <div className={cn(iconContainerVariants({ state }), \"shrink-0\")}>\r\n                        <Icon className=\"w-8 h-8\" />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <div className=\"flex items-center gap-2 flex-wrap\">\r\n                            <h3 className={cn(\r\n                                \"text-xl font-bold tracking-tight\",\r\n                                task.completed ? \"theme-text-muted opacity-60 line-through\" : \"theme-text\"\r\n                            )}>\r\n                                {task.title}\r\n                            </h3>\r\n                            {/* Social Attribution Stamp */}\r\n                            {task.createdByRole === 'relative' && task.createdByName && (\r\n                                <span className=\"inline-flex items-center gap-1 bg-indigo-50 px-2 py-0.5 rounded-lg\">\r\n                                    <Heart className=\"w-3 h-3 text-indigo-500 fill-indigo-200\" />\r\n                                    <span className=\"text-[10px] text-indigo-700 font-medium\">Fra {task.createdByName}</span>\r\n                                </span>\r\n                            )}\r\n                        </div>\r\n                        <p className=\"theme-text-muted font-medium opacity-80\">{task.time}</p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Checkbox with celebration animation */}\r\n                <div className={cn(\r\n                    checkboxVariants({ state }),\r\n                    task.completed && 'animate-celebrate relative'\r\n                )}>\r\n                    {task.completed && <CheckCircle className=\"text-white w-8 h-8\" />}\r\n                    {/* Celebration ring burst */}\r\n                    {task.completed && (\r\n                        <span className=\"absolute inset-0 rounded-full border-2 border-teal-400 animate-ping opacity-75\" />\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport { cardVariants, iconContainerVariants, checkboxVariants };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\tasks\\TimePickerModal.tsx","messages":[{"ruleId":"no-undef","severity":2,"message":"'React' is not defined.","line":23,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":23,"endColumn":36}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { X, Clock, Phone } from 'lucide-react';\r\nimport { Button } from '../../components/ui/Button';\r\n\r\ninterface TimeConfirmData {\r\n    period: string;\r\n    time: string;\r\n    label: string;\r\n}\r\n\r\ninterface TimePickerModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onConfirm: (data: TimeConfirmData) => void;\r\n    title?: string;\r\n    actionLabel?: string;\r\n    seniorName?: string;\r\n}\r\n\r\n/**\r\n * Time Picker Modal for scheduling tasks from match actions\r\n */\r\nexport const TimePickerModal: React.FC<TimePickerModalProps> = ({\r\n    isOpen,\r\n    onClose,\r\n    onConfirm,\r\n    title = 'Hvorn├Ñr vil du ringe?',\r\n    actionLabel = 'Ring til',\r\n    seniorName = 'Senior'\r\n}) => {\r\n    const [selectedPeriod, setSelectedPeriod] = useState<string>('morgen');\r\n\r\n    const PERIODS = [\r\n        { id: 'morgen', label: 'Morgen', time: '09:00', emoji: '­ƒîà' },\r\n        { id: 'formiddag', label: 'Formiddag', time: '11:00', emoji: 'ÔÿÇ´©Å' },\r\n        { id: 'eftermiddag', label: 'Eftermiddag', time: '14:00', emoji: '­ƒîñ´©Å' },\r\n        { id: 'aften', label: 'Aften', time: '18:00', emoji: '­ƒîÖ' }\r\n    ];\r\n\r\n    if (!isOpen) return null;\r\n\r\n    const handleConfirm = () => {\r\n        const period = PERIODS.find(p => p.id === selectedPeriod);\r\n        onConfirm({\r\n            period: selectedPeriod,\r\n            time: period?.time || '10:00',\r\n            label: period?.label || 'Morgen'\r\n        });\r\n    };\r\n\r\n    return (\r\n        <div\r\n            className=\"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/40\"\r\n            onClick={onClose}\r\n        >\r\n            <div\r\n                className=\"bg-white rounded-2xl shadow-2xl p-6 max-w-sm w-full relative\"\r\n                onClick={e => e.stopPropagation()}\r\n            >\r\n                {/* Close button */}\r\n                <button\r\n                    onClick={onClose}\r\n                    className=\"absolute top-4 right-4 p-2 rounded-full hover:bg-stone-100 transition-colors\"\r\n                >\r\n                    <X className=\"w-5 h-5 text-stone-400\" />\r\n                </button>\r\n\r\n                {/* Header */}\r\n                <div className=\"text-center mb-6\">\r\n                    <div className=\"w-16 h-16 bg-teal-100 rounded-full flex items-center justify-center mx-auto mb-3\">\r\n                        <Phone className=\"w-8 h-8 text-teal-600\" />\r\n                    </div>\r\n                    <h2 className=\"text-xl font-bold text-stone-800\">{title}</h2>\r\n                    <p className=\"text-stone-500 text-sm mt-1\">\r\n                        {actionLabel} {seniorName}\r\n                    </p>\r\n                </div>\r\n\r\n                {/* Time Period Selection */}\r\n                <div className=\"grid grid-cols-2 gap-3 mb-6\">\r\n                    {PERIODS.map(period => (\r\n                        <button\r\n                            key={period.id}\r\n                            onClick={() => setSelectedPeriod(period.id)}\r\n                            className={`\r\n                                p-4 rounded-xl border-2 transition-all text-left\r\n                                ${selectedPeriod === period.id\r\n                                    ? 'border-teal-500 bg-teal-50 ring-2 ring-teal-200'\r\n                                    : 'border-stone-200 hover:border-stone-300 hover:bg-stone-50'\r\n                                }\r\n                            `}\r\n                        >\r\n                            <div className=\"text-2xl mb-1\">{period.emoji}</div>\r\n                            <div className=\"font-bold text-stone-800\">{period.label}</div>\r\n                            <div className=\"text-xs text-stone-500 flex items-center gap-1\">\r\n                                <Clock className=\"w-3 h-3\" />\r\n                                {period.time}\r\n                            </div>\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Confirm Button */}\r\n                <Button\r\n                    className=\"w-full\"\r\n                    onClick={handleConfirm}\r\n                >\r\n                    ­ƒô× Opret opgave\r\n                </Button>\r\n\r\n                <button\r\n                    onClick={onClose}\r\n                    className=\"w-full text-sm text-stone-500 hover:text-stone-700 py-3 mt-2\"\r\n                >\r\n                    Annuller\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default TimePickerModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\tasks\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\tasks\\useTasks.ts","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`initializeDefaultTasks` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\tasks\\useTasks.ts:43:21\n  41 |                 if (snapshot.empty) {\n  42 |                     // Initialize with default tasks if none exist\n> 43 |                     initializeDefaultTasks(circleId);\n     |                     ^^^^^^^^^^^^^^^^^^^^^^ `initializeDefaultTasks` accessed before it is declared\n  44 |                 } else {\n  45 |                     const tasksList = snapshot.docs.map(doc => ({\n  46 |                         id: doc.id,\n\nC:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\tasks\\useTasks.ts:119:5\n  117 |\n  118 |     // Initialize default tasks for new circles\n> 119 |     const initializeDefaultTasks = async (cId: string) => {\n      |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 120 |         try {\n      | ^^^^^^^^^^^^^\n> 121 |             for (const task of INITIAL_TASKS) {\n      ÔÇª\n      | ^^^^^^^^^^^^^\n> 130 |         }\n      | ^^^^^^^^^^^^^\n> 131 |     };\n      | ^^^^^^^ `initializeDefaultTasks` is declared here\n  132 |\n  133 |     // Toggle task completion\n  134 |     const toggleTask = useCallback(async (taskId: string) => {","line":43,"column":21,"nodeType":null,"endLine":43,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1698,1701],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1698,1701],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`checkDailyReset` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\tasks\\useTasks.ts:66:13\n  64 |     useEffect(() => {\n  65 |         if (circleId && tasks.length > 0) {\n> 66 |             checkDailyReset(circleId, tasks);\n     |             ^^^^^^^^^^^^^^^ `checkDailyReset` accessed before it is declared\n  67 |         }\n  68 |     }, [circleId, tasks.length > 0]);\n  69 |\n\nC:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\tasks\\useTasks.ts:70:5\n  68 |     }, [circleId, tasks.length > 0]);\n  69 |\n> 70 |     const checkDailyReset = async (cId: string, currentTasks: Task[]) => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 71 |         try {\n     | ^^^^^^^^^^^^^\n> 72 |             const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD\n     ÔÇª\n     | ^^^^^^^^^^^^^\n> 85 |         }\n     | ^^^^^^^^^^^^^\n> 86 |     };\n     | ^^^^^^^ `checkDailyReset` is declared here\n  87 |\n  88 |     const performDailyReset = async (cId: string, currentTasks: Task[], dateStr: string) => {\n  89 |         try {","line":66,"column":13,"nodeType":null,"endLine":66,"endColumn":28},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'checkDailyReset' and 'tasks'. Either include them or remove the dependency array.","line":68,"column":8,"nodeType":"ArrayExpression","endLine":68,"endColumn":36,"suggestions":[{"desc":"Update the dependencies array to be: [checkDailyReset, circleId, tasks]","fix":{"range":[2107,2135],"text":"[checkDailyReset, circleId, tasks]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a complex expression in the dependency array. Extract it to a separate variable so it can be statically checked.","line":68,"column":19,"nodeType":"BinaryExpression","endLine":68,"endColumn":35},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":148,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5387,5390],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5387,5390],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":180,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":180,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6505,6508],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6505,6508],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":196,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7014,7017],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7014,7017],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":215,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7681,7684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7681,7684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n// Tasks hook - real-time task sync via Firestore\r\n// Replaces localStorage for multi-user task management\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport {\r\n    collection,\r\n    doc,\r\n    getDoc,\r\n    setDoc,\r\n    updateDoc,\r\n    deleteDoc,\r\n    onSnapshot,\r\n    serverTimestamp,\r\n    query,\r\n    orderBy\r\n} from 'firebase/firestore';\r\nimport { db } from '../../config/firebase';\r\nimport { INITIAL_TASKS } from '../../data/constants';\r\n\r\nimport { Task } from '../../types';\r\n\r\nexport function useTasks(circleId: string | null) {\r\n    const [tasks, setTasks] = useState<Task[]>([]);\r\n    const [loading, setLoading] = useState<boolean>(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    // Subscribe to tasks from Firestore\r\n    useEffect(() => {\r\n        if (!circleId) {\r\n            setTasks(INITIAL_TASKS as Task[]); // Fallback to defaults\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        const tasksRef = collection(db, 'careCircles', circleId, 'tasks');\r\n        const tasksQuery = query(tasksRef, orderBy('period'), orderBy('time'));\r\n\r\n        const unsubscribe = onSnapshot(tasksQuery,\r\n            (snapshot) => {\r\n                if (snapshot.empty) {\r\n                    // Initialize with default tasks if none exist\r\n                    initializeDefaultTasks(circleId);\r\n                } else {\r\n                    const tasksList = snapshot.docs.map(doc => ({\r\n                        id: doc.id,\r\n                        ...doc.data()\r\n                    })) as Task[];\r\n                    setTasks(tasksList);\r\n                }\r\n                setLoading(false);\r\n            },\r\n            (err: any) => {\r\n                console.error('Error fetching tasks:', err);\r\n                setError(err.message);\r\n                setLoading(false);\r\n            }\r\n        );\r\n\r\n        return () => unsubscribe();\r\n    }, [circleId]);\r\n\r\n    // Check for daily reset on load\r\n    useEffect(() => {\r\n        if (circleId && tasks.length > 0) {\r\n            checkDailyReset(circleId, tasks);\r\n        }\r\n    }, [circleId, tasks.length > 0]);\r\n\r\n    const checkDailyReset = async (cId: string, currentTasks: Task[]) => {\r\n        try {\r\n            const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD\r\n            const circleRef = doc(db, 'careCircles', cId);\r\n            const circleDoc = await getDoc(circleRef);\r\n\r\n            if (circleDoc.exists()) {\r\n                const data = circleDoc.data();\r\n                if (data.lastResetDate !== today) {\r\n                    console.log('­ƒîà New day detected! Resetting daily tasks...');\r\n                    await performDailyReset(cId, currentTasks, today);\r\n                }\r\n            }\r\n        } catch (err) {\r\n            console.error('Error checking daily reset:', err);\r\n        }\r\n    };\r\n\r\n    const performDailyReset = async (cId: string, currentTasks: Task[], dateStr: string) => {\r\n        try {\r\n            // 1. Reset all recurring tasks\r\n            for (const task of currentTasks) {\r\n                // Medication tasks are recurring by default\r\n                const isMedication = task.type === 'medication' || task.title?.toLowerCase().includes('medicin');\r\n                const isRecurring = task.recurring || isMedication;\r\n\r\n                if (isRecurring) {\r\n                    const docId = task.id.startsWith('task_') ? task.id : `task_${task.id}`;\r\n                    await updateDoc(doc(db, 'careCircles', cId, 'tasks', docId), {\r\n                        completed: false,\r\n                        completedAt: null\r\n                    });\r\n                } else if (task.completed) {\r\n                    // Optional: Archive or delete old non-recurring tasks\r\n                    // For now, we'll just leave them or you could delete them if they are older than 24h\r\n                }\r\n            }\r\n\r\n            // 2. Update the reset date\r\n            await updateDoc(doc(db, 'careCircles', cId), {\r\n                lastResetDate: dateStr\r\n            });\r\n            console.log('Ô£à Daily reset complete for', dateStr);\r\n        } catch (err) {\r\n            console.error('Error performing daily reset:', err);\r\n        }\r\n    };\r\n\r\n    // Initialize default tasks for new circles\r\n    const initializeDefaultTasks = async (cId: string) => {\r\n        try {\r\n            for (const task of INITIAL_TASKS) {\r\n                await setDoc(doc(db, 'careCircles', cId, 'tasks', `task_${task.id}`), {\r\n                    ...task,\r\n                    createdAt: serverTimestamp(),\r\n                    completedAt: null,\r\n                });\r\n            }\r\n        } catch (err) {\r\n            console.error('Error initializing tasks:', err);\r\n        }\r\n    };\r\n\r\n    // Toggle task completion\r\n    const toggleTask = useCallback(async (taskId: string) => {\r\n        if (!circleId) return;\r\n\r\n        const task = tasks.find(t => t.id === taskId || t.id === `task_${taskId}`);\r\n        if (!task) return;\r\n\r\n        const taskRef = doc(db, 'careCircles', circleId, 'tasks',\r\n            task.id.startsWith('task_') ? task.id : `task_${task.id}`);\r\n\r\n        try {\r\n            await setDoc(taskRef, {\r\n                completed: !task.completed,\r\n                completedAt: !task.completed ? serverTimestamp() : null,\r\n            }, { merge: true });\r\n        } catch (err: any) {\r\n            console.error('Error toggling task:', err);\r\n            setError(err.message);\r\n        }\r\n    }, [circleId, tasks]);\r\n\r\n    // Add a new task (from relative or senior)\r\n    const addTask = useCallback(async (newTask: Partial<Task>) => {\r\n        if (!circleId) return;\r\n\r\n        const taskId = `task_${Date.now()}`;\r\n        const taskRef = doc(db, 'careCircles', circleId, 'tasks', taskId);\r\n\r\n        // Default time based on period if not provided\r\n        const defaultTimes: Record<string, string> = {\r\n            morgen: '09:00',\r\n            frokost: '12:00',\r\n            eftermiddag: '15:00',\r\n            aften: '19:00'\r\n        };\r\n\r\n        try {\r\n            await setDoc(taskRef, {\r\n                id: taskId,\r\n                ...newTask,\r\n                time: newTask.time || (newTask.period ? defaultTimes[newTask.period] : '12:00'),\r\n                completed: false,\r\n                recurring: newTask.recurring || false,\r\n                createdAt: serverTimestamp(),\r\n                completedAt: null,\r\n            });\r\n            return taskId;\r\n        } catch (err: any) {\r\n            console.error('Error adding task:', err);\r\n            setError(err.message);\r\n            throw err;\r\n        }\r\n    }, [circleId]);\r\n\r\n    // Remove a task\r\n    const removeTask = useCallback(async (taskId: string) => {\r\n        if (!circleId) return;\r\n\r\n        const docId = taskId.startsWith('task_') ? taskId : `task_${taskId}`;\r\n        const taskRef = doc(db, 'careCircles', circleId, 'tasks', docId);\r\n\r\n        try {\r\n            await deleteDoc(taskRef);\r\n        } catch (err: any) {\r\n            console.error('Error removing task:', err);\r\n            setError(err.message);\r\n            throw err;\r\n        }\r\n    }, [circleId]);\r\n\r\n    // Reset all tasks (mark incomplete)\r\n    const resetTasks = useCallback(async () => {\r\n        if (!circleId) return;\r\n\r\n        try {\r\n            for (const task of tasks) {\r\n                const docId = task.id.startsWith('task_') ? task.id : `task_${task.id}`;\r\n                await setDoc(doc(db, 'careCircles', circleId, 'tasks', docId), {\r\n                    completed: false,\r\n                    completedAt: null,\r\n                }, { merge: true });\r\n            }\r\n        } catch (err: any) {\r\n            console.error('Error resetting tasks:', err);\r\n            setError(err.message);\r\n        }\r\n    }, [circleId, tasks]);\r\n\r\n    return {\r\n        tasks,\r\n        loading,\r\n        error,\r\n        toggleTask,\r\n        addTask,\r\n        removeTask,\r\n        resetTasks,\r\n    };\r\n}\r\n\r\nexport default useTasks;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\thinkingOfYou\\ThinkingOfYou.tsx","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":4,"column":1,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":4,"endColumn":46,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[160,205],"text":"// @ts-expect-error - sounds util not converted yet"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\thinkingOfYou\\ThinkingOfYou.tsx:138:13\n  136 |     useEffect(() => {\n  137 |         if (ping) {\n> 138 |             setIsVisible(true);\n      |             ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  139 |             playPingSound();\n  140 |\n  141 |             // Auto-dismiss after 5 seconds","line":138,"column":13,"nodeType":null,"endLine":138,"endColumn":25}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Heart, Sparkles } from 'lucide-react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\n// @ts-ignore - sounds util not converted yet\r\nimport { playPingSound } from '../../utils/sounds';\r\nimport { Avatar } from '../../components/ui/Avatar';\r\nimport { Ping } from '../../types';\r\n\r\ninterface FloatingHeart {\r\n    id: number;\r\n    x: number;\r\n    size: number;\r\n    duration: number;\r\n}\r\n\r\n// \"Thinking of you\" ping button - one-tap warmth without obligation\r\nexport const ThinkingOfYouButton: React.FC<{ onSendPing?: () => void, fromName?: string }> = ({ onSendPing }) => {\r\n    const [isSending, setIsSending] = useState(false);\r\n    const [floatingHearts, setFloatingHearts] = useState<FloatingHeart[]>([]);\r\n\r\n    const handleSend = () => {\r\n        setIsSending(true);\r\n        playPingSound();\r\n        onSendPing?.();\r\n\r\n        // Create 5 random floating hearts\r\n        const newHearts = Array.from({ length: 5 }).map((_, i) => ({\r\n            id: Date.now() + i,\r\n            x: Math.random() * 200 - 100, // Range -100 to 100\r\n            size: 15 + Math.random() * 15,\r\n            duration: 1.5 + Math.random() * 1.5\r\n        }));\r\n        setFloatingHearts(newHearts);\r\n\r\n        // Reset animation states\r\n        setTimeout(() => setIsSending(false), 2000);\r\n        setTimeout(() => setFloatingHearts([]), 3000);\r\n    };\r\n\r\n    return (\r\n        <div className=\"relative w-full\">\r\n            <AnimatePresence>\r\n                {floatingHearts.map(heart => (\r\n                    <motion.div\r\n                        key={heart.id}\r\n                        initial={{ opacity: 0, y: 0, x: 0 }}\r\n                        animate={{ opacity: 1, y: -200, x: heart.x }}\r\n                        exit={{ opacity: 0 }}\r\n                        transition={{ duration: heart.duration, ease: \"easeOut\" }}\r\n                        className=\"absolute left-1/2 top-0 pointer-events-none z-50\"\r\n                        style={{ marginLeft: -15 }}\r\n                    >\r\n                        <Heart\r\n                            className=\"text-pink-400 fill-pink-400\"\r\n                            size={heart.size}\r\n                        />\r\n                    </motion.div>\r\n                ))}\r\n            </AnimatePresence>\r\n\r\n            <button\r\n                onClick={handleSend}\r\n                disabled={isSending}\r\n                className={`\r\n                    w-full p-4 rounded-2xl border-2 transition-all duration-300\r\n                    flex items-center justify-center gap-3\r\n                    ${isSending\r\n                        ? 'bg-pink-100 border-pink-300 scale-95 shadow-inner'\r\n                        : 'bg-white border-pink-200 hover:border-pink-400 hover:bg-pink-50 active:scale-95 shadow-sm'\r\n                    }\r\n                `}\r\n            >\r\n                <div className={`relative ${isSending ? 'animate-celebrate' : ''}`}>\r\n                    <Heart\r\n                        className={`w-8 h-8 transition-all duration-300 ${isSending ? 'text-pink-500 fill-pink-500' : 'text-pink-400'}`}\r\n                    />\r\n                    {isSending && (\r\n                        <Sparkles className=\"absolute -top-1 -right-1 w-4 h-4 text-pink-400 animate-glow\" />\r\n                    )}\r\n                </div>\r\n                <span className={`font-semibold text-xl ${isSending ? 'text-pink-600' : 'text-pink-500'}`}>\r\n                    {isSending ? 'Sendt! ÔØñ´©Å' : 'T├ªnker p├Ñ dig'}\r\n                </span>\r\n            </button>\r\n        </div>\r\n    );\r\n};\r\n\r\ninterface ThinkingOfYouIconButtonProps {\r\n    onSendPing?: () => void;\r\n}\r\n\r\n// Compact icon-only version for header placement\r\nexport const ThinkingOfYouIconButton: React.FC<ThinkingOfYouIconButtonProps> = ({ onSendPing }) => {\r\n    const [isSending, setIsSending] = useState(false);\r\n\r\n    const handleSend = () => {\r\n        setIsSending(true);\r\n        playPingSound();\r\n        onSendPing?.();\r\n        setTimeout(() => setIsSending(false), 1500);\r\n    };\r\n\r\n    return (\r\n        <button\r\n            onClick={handleSend}\r\n            disabled={isSending}\r\n            aria-label=\"Send k├ªrlighed\"\r\n            className={`\r\n                p-2 rounded-full transition-all duration-300 relative\r\n                ${isSending\r\n                    ? 'bg-pink-200 scale-110'\r\n                    : 'bg-pink-50 hover:bg-pink-100 active:scale-95'\r\n                }\r\n            `}\r\n        >\r\n            <Heart\r\n                className={`w-5 h-5 transition-all duration-300 ${isSending ? 'text-pink-500 fill-pink-500' : 'text-pink-400'}`}\r\n            />\r\n            {isSending && (\r\n                <Sparkles className=\"absolute -top-1 -right-1 w-3 h-3 text-pink-400 animate-ping\" />\r\n            )}\r\n        </button>\r\n    );\r\n};\r\n\r\ninterface PingNotificationProps {\r\n    ping: Ping | null;\r\n    onDismiss?: () => void;\r\n}\r\n\r\n// Ping notification that appears in recipient's view\r\nexport const PingNotification: React.FC<PingNotificationProps> = ({ ping, onDismiss }) => {\r\n    const [isVisible, setIsVisible] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (ping) {\r\n            setIsVisible(true);\r\n            playPingSound();\r\n\r\n            // Auto-dismiss after 5 seconds\r\n            const timer = setTimeout(() => {\r\n                setIsVisible(false);\r\n                setTimeout(() => onDismiss?.(), 500); // Wait for fade-out\r\n            }, 5000);\r\n\r\n            return () => clearTimeout(timer);\r\n        }\r\n    }, [ping, onDismiss]);\r\n\r\n    if (!ping) return null;\r\n\r\n    return (\r\n        <div className={`\r\n            fixed top-20 left-4 right-4 z-50 transition-all duration-500\r\n            ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-4'}\r\n        `}>\r\n            <div\r\n                onClick={() => { setIsVisible(false); setTimeout(() => onDismiss?.(), 300); }}\r\n                className=\"bg-gradient-to-r from-pink-500 to-rose-500 p-4 rounded-2xl shadow-xl text-white cursor-pointer\"\r\n            >\r\n                <div className=\"flex items-center gap-3\">\r\n                    <div className=\"bg-white/20 p-1 rounded-full\">\r\n                        <Avatar id={ping.fromName?.toLowerCase() || 'louise'} size=\"md\" className=\"border-2 border-white/50\" />\r\n                    </div>\r\n                    <div>\r\n                        <p className=\"font-bold\">\r\n                            {ping.message || `${ping.fromName} t├ªnker p├Ñ dig ÔØñ´©Å`}\r\n                        </p>\r\n                        <p className=\"text-pink-100 text-sm\">\r\n                            {ping.sentAt?.toLocaleTimeString?.('da-DK', { hour: '2-digit', minute: '2-digit' })}\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ThinkingOfYouButton;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\thinkingOfYou\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\thinkingOfYou\\usePings.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\thinkingOfYou\\usePings.ts:29:13\n  27 |     useEffect(() => {\n  28 |         if (!circleId) {\n> 29 |             setPings([]);\n     |             ^^^^^^^^ Avoid calling setState() directly within an effect\n  30 |             setLoading(false);\n  31 |             return;\n  32 |         }","line":29,"column":13,"nodeType":null,"endLine":29,"endColumn":21},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'latestPing'. Either include it or remove the dependency array.","line":87,"column":8,"nodeType":"ArrayExpression","endLine":87,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [circleId, currentUserId, latestPing]","fix":{"range":[3031,3056],"text":"[circleId, currentUserId, latestPing]"}}]},{"ruleId":"react-hooks/preserve-manual-memoization","severity":2,"message":"Compilation Skipped: Existing memoization could not be preserved\n\nReact Compiler has skipped optimizing this component because the existing manual memoization could not be preserved. The inferred dependencies did not match the manually specified dependencies, which could cause the value to change more or less frequently than expected. The inferred dependency was `currentUserId`, but the source dependencies were [circleId]. Inferred different dependency than source.\n\nC:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\thinkingOfYou\\usePings.ts:90:34\n   88 |\n   89 |     // Send a ping\n>  90 |     const sendPing = useCallback(async (toView: 'senior' | 'relative', type: string = 'thinking_of_you', message: string = '') => {\n      |                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  91 |         if (!circleId || !currentUserId) return;\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n>  92 |\n      ÔÇª\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 109 |         }\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 110 |     }, [circleId]);\n      | ^^^^^^ Could not preserve existing manual memoization\n  111 |\n  112 |     // Dismiss latest ping\n  113 |     const dismissPing = useCallback(() => {","line":90,"column":34,"nodeType":null,"endLine":110,"endColumn":6},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":105,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3679,3682],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3679,3682],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'currentUserId'. Either include it or remove the dependency array.","line":110,"column":8,"nodeType":"ArrayExpression","endLine":110,"endColumn":18,"suggestions":[{"desc":"Update the dependencies array to be: [circleId, currentUserId]","fix":{"range":[3821,3831],"text":"[circleId, currentUserId]"}}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n// Pings hook - real-time \"thinking of you\" sync via Firestore\r\n// Syncs ping notifications across family circle members\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport {\r\n    collection,\r\n    doc,\r\n    setDoc,\r\n    onSnapshot,\r\n    serverTimestamp,\r\n    query,\r\n    orderBy,\r\n    limit\r\n} from 'firebase/firestore';\r\nimport { db } from '../../config/firebase';\r\n\r\nimport { Ping } from '../../types';\r\n\r\nexport function usePings(circleId: string | null, currentUserId: string | null) {\r\n    const [pings, setPings] = useState<Ping[]>([]);\r\n    const [latestPing, setLatestPing] = useState<Ping | null>(null);\r\n    const [loading, setLoading] = useState<boolean>(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    // Subscribe to recent pings from Firestore\r\n    useEffect(() => {\r\n        if (!circleId) {\r\n            setPings([]);\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        const pingsRef = collection(db, 'careCircles', circleId, 'pings');\r\n\r\n        const pingsQuery = query(\r\n            pingsRef,\r\n            orderBy('sentAt', 'desc'),\r\n            limit(10)\r\n        );\r\n\r\n        const unsubscribe = onSnapshot(pingsQuery,\r\n            (snapshot) => {\r\n                const pingsList: Ping[] = snapshot.docs.map(doc => {\r\n                    const data = doc.data();\r\n                    // Convert Firestore timestamp to Date\r\n                    const sentAt = data.sentAt?.toDate?.() || new Date();\r\n\r\n                    return {\r\n                        id: doc.id,\r\n                        fromName: data.fromName,\r\n                        fromUserId: data.fromUserId,\r\n                        toRole: data.toRole as 'senior' | 'relative',\r\n                        sentAt,\r\n                        toUserId: data.toUserId,\r\n                        type: data.type,\r\n                        message: data.message\r\n                    };\r\n                });\r\n\r\n                setPings(pingsList);\r\n\r\n                // Set latest ping if it's for this user and recent (within last minute)\r\n                const now = new Date();\r\n                const recentPing = pingsList.find(p => {\r\n                    const pingAge = now.getTime() - p.sentAt.getTime();\r\n                    const isRecent = pingAge < 60000; // Within last minute\r\n                    // const isForMe = p.toUserId !== currentUserId && p.fromUserId !== currentUserId;\r\n                    const isFromOther = p.fromUserId !== currentUserId;\r\n                    return isRecent && isFromOther;\r\n                });\r\n\r\n                if (recentPing && (!latestPing || recentPing.id !== latestPing.id)) {\r\n                    setLatestPing(recentPing);\r\n                }\r\n\r\n                setLoading(false);\r\n            },\r\n            (err) => {\r\n                console.error('Error fetching pings:', err);\r\n                setError(err.message);\r\n                setLoading(false);\r\n            }\r\n        );\r\n\r\n        return () => unsubscribe();\r\n    }, [circleId, currentUserId]);\r\n\r\n    // Send a ping\r\n    const sendPing = useCallback(async (toView: 'senior' | 'relative', type: string = 'thinking_of_you', message: string = '') => {\r\n        if (!circleId || !currentUserId) return;\r\n\r\n        const pingId = `ping_${Date.now()}`;\r\n        const pingRef = doc(db, 'careCircles', circleId, 'pings', pingId);\r\n\r\n        try {\r\n            await setDoc(pingRef, {\r\n                fromUserId: currentUserId,\r\n                toRole: toView,\r\n                sentAt: serverTimestamp(),\r\n                type,\r\n                message\r\n            });\r\n            return pingId;\r\n        } catch (err: any) {\r\n            console.error('Error sending ping:', err);\r\n            setError(err.message);\r\n            throw err;\r\n        }\r\n    }, [circleId]);\r\n\r\n    // Dismiss latest ping\r\n    const dismissPing = useCallback(() => {\r\n        setLatestPing(null);\r\n    }, []);\r\n\r\n    return {\r\n        pings,\r\n        latestPing,\r\n        loading,\r\n        error,\r\n        sendPing,\r\n        dismissPing,\r\n    };\r\n}\r\n\r\nexport default usePings;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\visualizations\\FamilyTree.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3383,3386],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3383,3386],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { Edit2 } from 'lucide-react';\r\nimport { Member } from '../../types';\r\nimport { Avatar } from '../../components/ui/Avatar';\r\nimport { MemberActionMenu } from '../../components/ui/MemberActionMenu';\r\n\r\ninterface FamilyTreeProps {\r\n    members: Member[];\r\n    seniorId: string;\r\n    onUpdateMember: (memberId: string, data: Partial<Member>) => Promise<void>;\r\n    currentUserId?: string;\r\n}\r\n\r\n/* --- THE FAMILY TREE (Livstr├ªet - Vertical Layout) --- */\r\nexport const FamilyTree = React.forwardRef<HTMLDivElement, FamilyTreeProps>(({ members, seniorId, onUpdateMember, currentUserId }, ref) => {\r\n    // 1. Identify Senior (Trunk) - Brad Pitt\r\n    const senior = members.find(m => (m.userId || m.docId) === seniorId) || members.find(m => m.role === 'senior') || members[0];\r\n\r\n    // 2. Identify Others\r\n    const allRelatives = members.filter(m => (m.userId || m.docId) !== (senior?.userId || senior?.docId));\r\n\r\n    // 3. Group by Generation\r\n    // For POC: \"Juzu\" is Grandchild (Child of Fatima). Everyone else is Child.\r\n    const children = allRelatives.filter(m => !m.displayName?.toLowerCase().includes('juzu'));\r\n\r\n    /**\r\n     * NOTE FOR AGENTS:\r\n     * This hierarchy and identity mapping is intentionally heuristic for the POC.\r\n     * We use process-of-elimination and positional logic to identify characters\r\n     * to avoid complex schema changes in Firestore during this phase.\r\n     * DO NOT REFACTOR to a fully dynamic data model without explicit USER approval.\r\n     */\r\n\r\n    // Identify current user's permission level\r\n    const currentUserMember = members.find(m => m.userId === currentUserId || m.docId === currentUserId);\r\n\r\n    const isSenior = currentUserMember?.role === 'senior' || (currentUserMember?.userId === seniorId || currentUserMember?.docId === seniorId);\r\n    const isAdmin = isSenior || currentUserMember?.accessLevel === 'admin' || (currentUserMember as unknown as { role: string })?.role === 'admin';\r\n\r\n    // Group grand-children (Juzu)\r\n    const grandChildren = allRelatives.filter(m => m.displayName?.toLowerCase().includes('juzu'));\r\n\r\n    // Stable Sorting: Ensure character slots (Slot 0, Slot 1) remain consistent\r\n    const sortedChildren = [...children].sort((a, b) => {\r\n        const idA = a.userId || a.docId || '';\r\n        const idB = b.userId || b.docId || '';\r\n        return idA.localeCompare(idB);\r\n    });\r\n\r\n    // Build hierarchy logic based on SLOTS (0 = Louise/Jacob, 1 = Fatima/Juzu)\r\n    const hierarchy = sortedChildren.map((child, index) => {\r\n        // Slot 0 is the 'Louise' archetype (Married to Jacob, no children in this view)\r\n        const isLouiseSlot = index === 0;\r\n        // Slot 1 is the 'Fatima' archetype (Parent of Juzu)\r\n        const isFatimaSlot = index === 1;\r\n\r\n        return {\r\n            ...child,\r\n            isLouise: isLouiseSlot,\r\n            // Slot 0 has a partner \"Jacob\" (Dummy node for symmetry)\r\n            partner: isLouiseSlot ? { displayName: 'Jacob', userId: 'jacob', role: 'partner' } : null,\r\n            offspring: isFatimaSlot ? grandChildren : []\r\n        };\r\n    });\r\n\r\n    // --- ADMIN ACTIONS ---\r\n    const [selectedMember, setSelectedMember] = React.useState<Member | null>(null);\r\n    const [isMenuOpen, setIsMenuOpen] = React.useState(false);\r\n\r\n    const handleNodeClick = (member: any) => {\r\n        if (!isAdmin) return; // SECURITY: Restrict editing to admins\r\n        if (!member || member.userId === 'jacob') return; // Cannot edit dummy node\r\n        setSelectedMember(member);\r\n        setIsMenuOpen(true);\r\n    };\r\n\r\n    return (\r\n        <div ref={ref} className=\"relative w-full bg-gradient-to-b from-slate-50 to-white rounded-xl flex flex-col items-center py-2 shadow-sm border border-slate-100 overflow-visible\">\r\n            {/* Title */}\r\n            <div className=\"absolute top-1 left-4 text-[9px] font-bold text-slate-300 tracking-wider uppercase opacity-50\">\r\n                Livstr├ªet\r\n            </div>\r\n\r\n            {/* Level 1: Senior (Brad) */}\r\n            <div className=\"z-10 relative flex flex-col items-center mb-4\">\r\n                <div\r\n                    onClick={() => handleNodeClick(senior)}\r\n                    className={`relative transition-transform duration-300 ${isAdmin ? 'hover:scale-105 cursor-pointer group' : 'cursor-default'}`}\r\n                >\r\n                    <div className={`p-1 bg-white rounded-full shadow-md relative z-10 transition-all ${isAdmin ? 'group-hover:ring-4 ring-indigo-100' : ''}`}>\r\n                        <Avatar\r\n                            id=\"brad\"\r\n                            // fallback=\"S\"\r\n                            size=\"lg\"\r\n                            className=\"border-2 border-white shadow-sm\"\r\n                        />\r\n                        {/* Edit Badge for Admin Only */}\r\n                        {isAdmin && (\r\n                            <div className=\"absolute -top-1 -right-1 bg-white rounded-full p-1 shadow-sm opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                <Edit2 className=\"w-3 h-3 text-stone-400\" />\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n                <span className=\"bg-slate-800 text-white text-[9px] px-2 py-0 rounded-full font-bold whitespace-nowrap shadow-sm z-20 -mt-1 relative\">\r\n                    {senior?.displayName}\r\n                </span>\r\n                {/* Trunk Line */}\r\n                <div className=\"absolute top-full left-1/2 -translate-x-1/2 w-0.5 h-6 bg-slate-300 opacity-60\" />\r\n            </div>\r\n\r\n            {/* Level 2: Children (Fatima, Louise) */}\r\n            <div className=\"relative w-full flex justify-center gap-4 sm:gap-8 px-2 mt-2\">\r\n                {/* Horizontal Branch Connector */}\r\n                {hierarchy.length > 1 && (\r\n                    <div className=\"absolute -top-4 left-0 w-full flex justify-center items-center\">\r\n                        <div className=\"h-px bg-slate-200 opacity-80\"\r\n                            style={{\r\n                                width: `calc(100% - ${100 / hierarchy.length}%)`,\r\n                                maxWidth: `${(hierarchy.length - 1) * 80}px`\r\n                            }}\r\n                        />\r\n                        {/* Sibling Relation Label */}\r\n                        <div className=\"absolute top-1/2 -translate-y-1/2 px-2 bg-white/95 rounded-full border border-slate-100 shadow-sm\">\r\n                            <span className=\"text-[7px] font-bold text-slate-400 uppercase tracking-[0.1em] whitespace-nowrap\">\r\n                                S├©skende\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Sibling Connection (Direct line between nodes) */}\r\n                <div className=\"absolute top-8 left-1/2 -translate-x-1/2 w-[120px] h-[1px] border-t border-dashed border-slate-200 z-0\" />\r\n\r\n                {hierarchy.map((child, i) => {\r\n                    // ID Mapping for Avatar (Identity based: Louise vs Others)\r\n                    const avatarId = child.isLouise ? 'louise' : 'fatima';\r\n\r\n                    return (\r\n                        <div key={child.userId} className=\"flex flex-col items-center relative pt-2\">\r\n                            {/* Vertical Line from Branch */}\r\n                            <div className=\"absolute -top-3 w-0.5 h-6 bg-slate-300 opacity-60\" />\r\n\r\n                            <div className=\"flex items-start gap-3\">\r\n                                <motion.div\r\n                                    initial={{ opacity: 0, y: 10 }}\r\n                                    animate={{ opacity: 1, y: 0 }}\r\n                                    transition={{ delay: 0.1 + (i * 0.1) }}\r\n                                    onClick={() => handleNodeClick(child)}\r\n                                    className={`group relative flex flex-col items-center ${isAdmin ? 'cursor-pointer' : 'cursor-default'}`}\r\n                                >\r\n                                    <div className={`p-0.5 bg-white rounded-full shadow-sm z-10 transition-transform duration-200 ${isAdmin ? 'hover:scale-110 hover:ring-2 ring-indigo-100' : ''}`}>\r\n                                        <Avatar\r\n                                            id={avatarId}\r\n                                            className=\"border border-white\"\r\n                                            size=\"md\"\r\n                                        />\r\n                                        {isAdmin && (\r\n                                            <div className=\"absolute -top-1 -right-1 bg-white rounded-full p-1 shadow-sm opacity-0 group-hover:opacity-100 transition-opacity z-20\">\r\n                                                <Edit2 className=\"w-3 h-3 text-stone-400\" />\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                    <span className=\"text-[9px] font-bold text-slate-600 -mt-2 bg-slate-50 px-2 py-0 rounded-full border border-slate-100 max-w-[80px] truncate text-center relative z-20\">\r\n                                        {child.displayName}\r\n                                    </span>\r\n                                </motion.div>\r\n\r\n                                {/* PARTNER NODE: Jacob (Dummy) or Partner Slot */}\r\n                                {child.partner && (\r\n                                    <motion.div\r\n                                        initial={{ opacity: 0, scale: 0.8 }}\r\n                                        animate={{ opacity: 1, scale: 1 }}\r\n                                        transition={{ delay: 0.2 + (i * 0.1) }}\r\n                                        className=\"flex flex-col items-center relative\"\r\n                                    >\r\n                                        {/* Marriage/Partner Line */}\r\n                                        <div className=\"absolute top-6 -left-4 w-4 h-px bg-slate-200\" />\r\n\r\n                                        <div className=\"p-0.5 bg-white rounded-full shadow-sm z-10 opacity-70 scale-90\">\r\n                                            <Avatar\r\n                                                id=\"brad\" // Partner placeholder avatar\r\n                                                className=\"border border-white\"\r\n                                                size=\"md\"\r\n                                            />\r\n                                        </div>\r\n                                        <span className=\"text-[8px] font-medium text-slate-400 -mt-1\">\r\n                                            {child.partner.displayName}\r\n                                        </span>\r\n                                    </motion.div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Level 3: Grandchildren (Juzu) */}\r\n                            {child.offspring.length > 0 && (\r\n                                <div className=\"mt-2 relative flex flex-col items-center\">\r\n                                    {/* Line to Offspring */}\r\n                                    <div className=\"absolute -top-2 w-0.5 h-3 bg-slate-300 opacity-60\" />\r\n\r\n                                    {child.offspring.map((grandchild, j) => (\r\n                                        <motion.div\r\n                                            key={grandchild.userId}\r\n                                            initial={{ opacity: 0, scale: 0.8 }}\r\n                                            animate={{ opacity: 1, scale: 1 }}\r\n                                            transition={{ delay: 0.3 + (j * 0.1) }}\r\n                                            onClick={(e) => {\r\n                                                if (!isAdmin) return;\r\n                                                e.stopPropagation();\r\n                                                handleNodeClick(grandchild);\r\n                                            }}\r\n                                            className=\"flex flex-col items-center cursor-pointer group\"\r\n                                        >\r\n                                            <div className=\"p-0.5 bg-white rounded-full shadow-sm z-10 hover:scale-110 transition-transform duration-200 hover:ring-2 ring-teal-100\">\r\n                                                <Avatar\r\n                                                    id=\"juzu\"\r\n                                                    className=\"border border-white\"\r\n                                                    size=\"sm\"\r\n                                                />\r\n                                                <div className=\"absolute -top-1 -right-1 bg-white rounded-full p-0.5 shadow-sm opacity-0 group-hover:opacity-100 transition-opacity z-20\">\r\n                                                    <Edit2 className=\"w-2 h-2 text-stone-400\" />\r\n                                                </div>\r\n                                            </div>\r\n                                            <span className=\"text-[9px] font-medium text-slate-500 mt-1\">\r\n                                                {grandchild.displayName}\r\n                                            </span>\r\n                                        </motion.div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* Member Action Menu */}\r\n            {selectedMember && (\r\n                <MemberActionMenu\r\n                    member={selectedMember}\r\n                    isOpen={isMenuOpen}\r\n                    onClose={() => setIsMenuOpen(false)}\r\n                    onUpdate={onUpdateMember}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\weeklyQuestion\\WeeklyQuestion.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":6,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":6,"endColumn":30},{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":12,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":12,"endColumn":27}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { MessageCircle, ChevronRight, Sparkles } from 'lucide-react';\r\nimport { WeeklyAnswer } from '../../types';\r\n\r\n// Weekly questions to rotate through\r\nexport const WEEKLY_QUESTIONS = [\r\n    \"weekly_question_1\",\r\n    \"weekly_question_2\"\r\n];\r\n\r\n// Get week number of the year\r\nexport const getWeekNumber = () => {\r\n    const now = new Date();\r\n    const start = new Date(now.getFullYear(), 0, 1);\r\n    const diff = now.getTime() - start.getTime();\r\n    const oneWeek = 604800000; // ms in a week\r\n    return Math.floor(diff / oneWeek);\r\n};\r\n\r\ninterface WeeklyQuestionCardProps {\r\n    onAnswer?: (answer: Omit<WeeklyAnswer, 'id'>) => void;\r\n    answers?: WeeklyAnswer[];\r\n    userName?: string;\r\n}\r\n\r\n// Component for displaying the weekly question\r\nexport const WeeklyQuestionCard: React.FC<WeeklyQuestionCardProps> = ({ onAnswer, answers = [], userName = 'dig' }) => {\r\n    const [isExpanded, setIsExpanded] = useState(false);\r\n    const [myAnswer, setMyAnswer] = useState('');\r\n\r\n    // Get this week's question based on week number\r\n    const weekNumber = getWeekNumber();\r\n    const question = WEEKLY_QUESTIONS[weekNumber % WEEKLY_QUESTIONS.length];\r\n\r\n    const handleSubmit = () => {\r\n        if (myAnswer.trim()) {\r\n            onAnswer?.({\r\n                questionId: question,\r\n                text: myAnswer.trim(),\r\n                userId: '', // Will be filled by handler\r\n                userName\r\n            });\r\n            setMyAnswer('');\r\n            setIsExpanded(false);\r\n        }\r\n    };\r\n\r\n    const hasAnsweredThisWeek = answers.some(a =>\r\n        a.questionId === question &&\r\n        a.userName === userName\r\n    );\r\n\r\n    return (\r\n        <div className=\"bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl p-4 text-white shadow-lg\">\r\n            <div className=\"flex items-start gap-3 mb-3\">\r\n                <div className=\"p-2 bg-white/20 rounded-full\">\r\n                    <MessageCircle className=\"w-5 h-5\" />\r\n                </div>\r\n                <div className=\"flex-1\">\r\n                    <p className=\"text-sm text-indigo-200 font-medium\">Ugens sp├©rgsm├Ñl</p>\r\n                    <p className=\"text-lg font-bold\">{question}</p>\r\n                </div>\r\n            </div>\r\n\r\n            {!isExpanded ? (\r\n                <>\r\n                    {/* Show existing answers */}\r\n                    {answers.filter(a => a.questionId === question).length > 0 && (\r\n                        <div className=\"space-y-2 mb-3\">\r\n                            {answers\r\n                                .filter(a => a.questionId === question)\r\n                                .slice(0, 3)\r\n                                .map((answer, i) => (\r\n                                    <div key={i} className=\"bg-white/10 rounded-xl p-3\">\r\n                                        <p className=\"font-medium text-indigo-100\">{answer.userName}:</p>\r\n                                        <p className=\"text-white/90 text-sm\">{answer.text}</p>\r\n                                    </div>\r\n                                ))}\r\n                        </div>\r\n                    )}\r\n\r\n                    {!hasAnsweredThisWeek && (\r\n                        <button\r\n                            onClick={() => setIsExpanded(true)}\r\n                            className=\"w-full p-3 bg-white/20 rounded-xl text-white font-semibold \r\n                                hover:bg-white/30 transition-colors flex items-center justify-center gap-2\r\n                                focus:outline-none focus:ring-2 focus:ring-white/50\"\r\n                            aria-label=\"Svar p├Ñ ugens sp├©rgsm├Ñl\"\r\n                        >\r\n                            <Sparkles className=\"w-4 h-4\" />\r\n                            Del dit svar\r\n                        </button>\r\n                    )}\r\n                </>\r\n            ) : (\r\n                <div className=\"space-y-3\">\r\n                    <textarea\r\n                        value={myAnswer}\r\n                        onChange={(e) => setMyAnswer(e.target.value)}\r\n                        placeholder=\"Skriv dit svar her...\"\r\n                        className=\"w-full p-3 rounded-xl bg-white/10 text-white placeholder-white/50 \r\n                            border-2 border-white/20 focus:border-white/50 focus:outline-none\r\n                            resize-none h-24\"\r\n                        aria-label=\"Dit svar\"\r\n                    />\r\n                    <div className=\"flex gap-2\">\r\n                        <button\r\n                            onClick={() => setIsExpanded(false)}\r\n                            className=\"flex-1 p-3 bg-white/10 rounded-xl text-white \r\n                                hover:bg-white/20 transition-colors\"\r\n                        >\r\n                            Annuller\r\n                        </button>\r\n                        <button\r\n                            onClick={handleSubmit}\r\n                            disabled={!myAnswer.trim()}\r\n                            className=\"flex-1 p-3 bg-white rounded-xl text-indigo-600 font-bold \r\n                                hover:bg-indigo-50 transition-colors flex items-center justify-center gap-2\r\n                                disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                            aria-label=\"Send dit svar\"\r\n                        >\r\n                            Send\r\n                            <ChevronRight className=\"w-4 h-4\" />\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\ninterface Memory {\r\n    date: string;\r\n    text: string;\r\n    emoji: string;\r\n}\r\n\r\ninterface MemoryTriggerProps {\r\n    memories?: Memory[];\r\n}\r\n\r\n// Memory trigger component - \"Husker du da...?\"\r\nexport const MemoryTrigger: React.FC<MemoryTriggerProps> = ({ memories = [] }) => {\r\n    const [currentIndex, setCurrentIndex] = useState(0);\r\n\r\n    // Default memories if none provided\r\n    const defaultMemories: Memory[] = [\r\n        { date: '3 ├Ñr siden', text: 'Familietur til Skagen', emoji: '­ƒÅû´©Å' },\r\n        { date: '5 ├Ñr siden', text: 'Emmas f├©dselsdag', emoji: '­ƒÄé' },\r\n        { date: '2 ├Ñr siden', text: 'Jul hos farmor', emoji: '­ƒÄä' },\r\n    ];\r\n\r\n    const allMemories = memories.length > 0 ? memories : defaultMemories;\r\n    const memory = allMemories[currentIndex % allMemories.length];\r\n\r\n    useEffect(() => {\r\n        // Rotate memories every 10 seconds\r\n        const timer = setInterval(() => {\r\n            setCurrentIndex(prev => (prev + 1) % allMemories.length);\r\n        }, 10000);\r\n        return () => clearInterval(timer);\r\n    }, [allMemories.length]);\r\n\r\n    return (\r\n        <div className=\"bg-amber-50 border border-amber-200 rounded-2xl p-4\">\r\n            <div className=\"flex items-center gap-3\">\r\n                <span className=\"text-3xl\">{memory.emoji}</span>\r\n                <div className=\"flex-1\">\r\n                    <p className=\"text-amber-800 font-medium\">Husker du da...?</p>\r\n                    <p className=\"text-amber-600 text-sm\">{memory.date}: {memory.text}</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default WeeklyQuestionCard;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\weeklyQuestion\\WeeklyQuestionWidget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":24,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":24,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { MessageCircle, X, Check, Heart, MessageSquare, Send, Sparkles, Loader2, Mic, Play as PlayIcon } from 'lucide-react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { WEEKLY_QUESTIONS, getWeekNumber } from './WeeklyQuestion';\r\nimport { WeeklyAnswer, WeeklyReply, Member, FirestoreDate } from '../../types';\r\nimport { AudioRecorder } from '../memories/AudioRecorder';\r\nimport { toJsDate } from '../../utils/dateUtils';\r\nimport { TFunction } from 'i18next';\r\n\r\n// Simple time ago formatter (no external deps)\r\nconst formatTimeAgo = (isoString: FirestoreDate | undefined, t: TFunction) => {\r\n    if (!isoString) return '';\r\n    try {\r\n        const date = toJsDate(isoString);\r\n        if (!date) return '';\r\n\r\n        const now = new Date();\r\n        const diffInSeconds = Math.floor((now.getTime() - date.getTime()) / 1000);\r\n\r\n        if (diffInSeconds < 60) return t('just_now');\r\n        if (diffInSeconds < 3600) return t('minutes_ago', { count: Math.floor(diffInSeconds / 60) });\r\n        if (diffInSeconds < 86400) return t('hours_ago', { count: Math.floor(diffInSeconds / 3600) });\r\n        return t('days_ago_relative', { count: Math.floor(diffInSeconds / 86400) });\r\n    } catch (e) {\r\n        return '';\r\n    }\r\n};\r\n\r\ninterface WeeklyQuestionWidgetProps {\r\n    answers?: WeeklyAnswer[];\r\n    userName: string;\r\n    hasUnread?: boolean;\r\n    onClick: () => void;\r\n}\r\n\r\n// Compact widget for header\r\nexport const WeeklyQuestionWidget: React.FC<WeeklyQuestionWidgetProps> = ({ answers = [], userName, hasUnread = false, onClick }) => {\r\n    const { t } = useTranslation();\r\n    const weekNumber = getWeekNumber();\r\n    const questionKey = WEEKLY_QUESTIONS[weekNumber % WEEKLY_QUESTIONS.length];\r\n    const answersThisWeek = answers.filter(a => a.questionId === questionKey);\r\n    const unreadCount = hasUnread ? answersThisWeek.filter(a => a.userName !== userName).length : 0;\r\n\r\n    return (\r\n        <button\r\n            onClick={onClick}\r\n            className=\"relative bg-indigo-100 p-1.5 rounded-full hover:bg-indigo-200 transition-colors flex items-center justify-center shrink-0\"\r\n            aria-label={t('open_weekly_question')}\r\n            style={{ width: '36px', height: '36px' }}\r\n        >\r\n            <MessageCircle className=\"w-5 h-5 text-indigo-600\" />\r\n            {unreadCount > 0 && (\r\n                <span className=\"absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center border border-white\">\r\n                    {unreadCount}\r\n                </span>\r\n            )}\r\n        </button>\r\n    );\r\n};\r\n\r\ninterface WeeklyQuestionModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    answers?: WeeklyAnswer[];\r\n    onAnswer?: (answer: Omit<WeeklyAnswer, 'id'>) => void;\r\n    userName: string;\r\n    currentUserId?: string;\r\n    onToggleLike?: (answerId: string, userId: string, isLiked: boolean) => void;\r\n    onReply?: (answerId: string, reply: Omit<WeeklyReply, 'id'>) => void;\r\n    members?: Member[];\r\n}\r\n\r\n// Full modal for answering and viewing\r\nexport const WeeklyQuestionModal: React.FC<WeeklyQuestionModalProps> = ({\r\n    isOpen,\r\n    onClose,\r\n    answers = [],\r\n    onAnswer,\r\n    userName,\r\n    currentUserId,\r\n    onToggleLike,\r\n    onReply,\r\n    members = []\r\n}) => {\r\n    const [myAnswer, setMyAnswer] = useState('');\r\n    const [replyText, setReplyText] = useState('');\r\n    const [replyingToId, setReplyingToId] = useState<string | null>(null);\r\n    const [answerType, setAnswerType] = useState<'text' | 'audio'>('text');\r\n    const [audioBlob, setAudioBlob] = useState<Blob | null>(null);\r\n    const { t } = useTranslation();\r\n    const [isUploading] = useState(false); // Local state since audio upload isn't implemented yet\r\n\r\n    const weekNumber = getWeekNumber();\r\n    const questionKey = WEEKLY_QUESTIONS[weekNumber % WEEKLY_QUESTIONS.length];\r\n    const question = t(questionKey);\r\n\r\n    // Filter answers for this week's question\r\n    const answersThisWeek = answers.filter(a => a.questionId === questionKey);\r\n    const hasAnsweredThisWeek = answersThisWeek.some(a => a.userName === userName);\r\n\r\n    // Logic for Strict Barrier\r\n    // Count ALL members (Senior + Relatives) as participants\r\n    const participants = members;\r\n    const totalParticipants = participants.length;\r\n\r\n    // Count unique users who answered\r\n    const uniqueAnswerers = new Set(answersThisWeek.map(a => a.userId)).size;\r\n\r\n    // If we have members data, enforce the barrier.\r\n    const allAnswered = totalParticipants > 0 ? uniqueAnswerers >= totalParticipants : true;\r\n\r\n\r\n    // Sorting: Popularity (likes) -> Newest\r\n    const sortedAnswers = [...answersThisWeek].sort((a, b) => {\r\n        const likesA = a.likes?.length || 0;\r\n        const likesB = b.likes?.length || 0;\r\n        if (likesA !== likesB) return likesB - likesA; // Most likes first\r\n        // Fallback to time if available (newest first)\r\n        const timeA = toJsDate(a.answeredAt)?.getTime() || 0;\r\n        const timeB = toJsDate(b.answeredAt)?.getTime() || 0;\r\n        return timeB - timeA;\r\n    });\r\n\r\n    const handleSubmit = async () => {\r\n        if (answerType === 'text' && myAnswer.trim()) {\r\n            onAnswer?.({\r\n                questionId: questionKey,\r\n                text: myAnswer.trim(),\r\n                answeredAt: new Date(),\r\n                userName\r\n            });\r\n            setMyAnswer('');\r\n        } else if (answerType === 'audio' && audioBlob) {\r\n            // Audio submission logic will be handled here\r\n            onAnswer?.({\r\n                questionId: questionKey,\r\n                text: t('audio_answer_placeholder'),\r\n                answeredAt: new Date(),\r\n                userName\r\n            });\r\n            setAudioBlob(null);\r\n        }\r\n    };\r\n\r\n    const handleReplySubmit = (answerId: string) => {\r\n        if (!replyText.trim() || !currentUserId) return;\r\n\r\n        onReply?.(answerId, {\r\n            userId: currentUserId,\r\n            userName: userName,\r\n            text: replyText.trim(),\r\n            createdAt: new Date().toISOString()\r\n        });\r\n        setReplyText('');\r\n        setReplyingToId(null);\r\n    };\r\n\r\n    const toggleReplyInput = (answerId: string) => {\r\n        if (replyingToId === answerId) {\r\n            setReplyingToId(null);\r\n        } else {\r\n            setReplyingToId(answerId);\r\n            setReplyText('');\r\n        }\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex items-end justify-center animate-fade-in pb-0 sm:pb-0\">\r\n            <div className=\"bg-white w-full max-w-md rounded-t-[2.5rem] h-[85vh] flex flex-col animate-slide-up shadow-[0_-10px_40px_-15px_rgba(0,0,0,0.3)] safe-area-bottom\">\r\n                {/* Drag Handle Indicator */}\r\n                <div className=\"w-full flex justify-center pt-3 pb-1\" onTouchStart={onClose}>\r\n                    <div className=\"w-12 h-1.5 bg-stone-200 rounded-full\" />\r\n                </div>\r\n                <div className=\"flex items-center justify-between p-4 border-b border-stone-200\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <div className=\"bg-indigo-100 p-2 rounded-full\">\r\n                            <MessageCircle className=\"w-5 h-5 text-indigo-600\" />\r\n                        </div>\r\n                        <span className=\"font-bold text-stone-800\">{t('weekly_question_title')}</span>\r\n                    </div>\r\n                    <button onClick={onClose} className=\"p-2 hover:bg-stone-100 rounded-full\">\r\n                        <X className=\"w-6 h-6 text-stone-500\" />\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"flex-1 overflow-y-auto p-4 space-y-4 pb-20\">\r\n                    {/* Question */}\r\n                    <div className=\"bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl p-6 text-white shadow-lg\">\r\n                        <p className=\"text-indigo-200 text-sm mb-2 uppercase tracking-wide font-bold\">{t('weekly_question_header')}</p>\r\n                        <p className=\"text-xl font-bold leading-relaxed\">{question}</p>\r\n                    </div>\r\n\r\n                    {/* Answer input (only if not answered) */}\r\n                    {!hasAnsweredThisWeek ? (\r\n                        <div className=\"space-y-4 animate-fade-in\">\r\n                            {/* Toggle between text and audio */}\r\n                            <div className=\"flex bg-stone-100 p-1 rounded-2xl\">\r\n                                <button\r\n                                    onClick={() => setAnswerType('text')}\r\n                                    className={`flex-1 py-3 rounded-xl font-bold transition-all ${answerType === 'text' ? 'bg-white shadow-sm text-indigo-600' : 'text-stone-500'}`}\r\n                                >\r\n                                    <div className=\"flex items-center justify-center gap-2\">\r\n                                        <MessageSquare className=\"w-4 h-4\" />\r\n                                        {t('text_answer')}\r\n                                    </div>\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => setAnswerType('audio')}\r\n                                    className={`flex-1 py-3 rounded-xl font-bold transition-all ${answerType === 'audio' ? 'bg-white shadow-sm text-indigo-600' : 'text-stone-500'}`}\r\n                                >\r\n                                    <div className=\"flex items-center justify-center gap-2\">\r\n                                        <Mic className=\"w-4 h-4\" />\r\n                                        {t('audio_answer')}\r\n                                    </div>\r\n                                </button>\r\n                            </div>\r\n\r\n                            <div className=\"relative\">\r\n                                {answerType === 'text' ? (\r\n                                    <textarea\r\n                                        value={myAnswer}\r\n                                        onChange={(e) => setMyAnswer(e.target.value)}\r\n                                        placeholder={t('write_answer_placeholder')}\r\n                                        className=\"w-full p-4 rounded-2xl border-2 border-stone-200 focus:border-indigo-400 focus:outline-none resize-none h-32 text-lg shadow-sm\"\r\n                                    />\r\n                                ) : (\r\n                                    <AudioRecorder\r\n                                        onRecordingComplete={(blob) => setAudioBlob(blob)}\r\n                                        onReset={() => setAudioBlob(null)}\r\n                                        placeholder={t('tell_your_story_placeholder')}\r\n                                    />\r\n                                )}\r\n                            </div>\r\n                            <button\r\n                                onClick={handleSubmit}\r\n                                disabled={answerType === 'text' ? !myAnswer.trim() : (!audioBlob || isUploading)}\r\n                                className=\"w-full p-4 bg-indigo-600 text-white font-bold rounded-2xl hover:bg-indigo-700 transition-colors flex items-center justify-center gap-2 disabled:opacity-50 shadow-md active:scale-95 transform transition-transform\"\r\n                            >\r\n                                {isUploading ? (\r\n                                    <Loader2 className=\"w-5 h-5 animate-spin\" />\r\n                                ) : (\r\n                                    <Sparkles className=\"w-5 h-5\" />\r\n                                )}\r\n                                {isUploading ? t('uploading') : t('share_your_answer')}\r\n                            </button>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"bg-green-50 border border-green-200 rounded-xl p-3 text-center mb-4 flex items-center justify-center gap-2\">\r\n                            <div className=\"bg-green-100 p-1 rounded-full\">\r\n                                <Check className=\"w-4 h-4 text-green-700\" />\r\n                            </div>\r\n                            <p className=\"text-green-700 font-medium\">{t('thanks_for_answer')}</p>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* All Answers Feed - STRICT BARRIER */}\r\n                    <div className=\"space-y-4\">\r\n                        {!allAnswered && hasAnsweredThisWeek ? (\r\n                            <div className=\"bg-stone-50 rounded-2xl p-6 text-center border-2 border-stone-100 border-dashed animate-fade-in\">\r\n                                <div className=\"bg-indigo-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3\">\r\n                                    <Sparkles className=\"w-6 h-6 text-indigo-500\" />\r\n                                </div>\r\n                                <h3 className=\"text-lg font-bold text-stone-700 mb-1\">{t('waiting_for_family')}</h3>\r\n                                <p className=\"text-stone-500 mb-4\">{t('waiting_for_family_desc', { count: totalParticipants - uniqueAnswerers })}</p>\r\n                                <div className=\"w-full bg-stone-200 rounded-full h-2 overflow-hidden\">\r\n                                    <div\r\n                                        className=\"bg-indigo-500 h-full transition-all duration-1000\"\r\n                                        style={{ width: `${(uniqueAnswerers / totalParticipants) * 100}%` }}\r\n                                    />\r\n                                </div>\r\n                                <p className=\"text-xs font-bold text-indigo-600 mt-2 text-right\">\r\n                                    {uniqueAnswerers} / {totalParticipants} {t('answers')}\r\n                                </p>\r\n                            </div>\r\n                        ) : sortedAnswers.length > 0 ? (\r\n                            <>\r\n                                <p className=\"text-stone-500 text-sm font-bold ml-1 uppercase tracking-wide\">{t('family_answers_count', { count: sortedAnswers.length })}</p>\r\n                                {sortedAnswers.map((answer) => {\r\n                                    const isLiked = currentUserId && answer.likes?.includes(currentUserId);\r\n                                    const likeCount = answer.likes?.length || 0;\r\n                                    const isReplying = replyingToId === answer.id;\r\n\r\n                                    return (\r\n                                        <div key={answer.id} className=\"bg-white rounded-2xl p-4 border border-stone-200 shadow-sm transition-all hover:shadow-md\">\r\n                                            {/* Answer Header */}\r\n                                            <div className=\"flex justify-between items-start mb-2\">\r\n                                                <div>\r\n                                                    <p className=\"font-bold text-stone-800 text-lg\">{answer.userName}</p>\r\n                                                    {answer.answeredAt && (\r\n                                                        <p className=\"text-xs text-stone-400\">\r\n                                                            {formatTimeAgo(answer.answeredAt, t)}\r\n                                                        </p>\r\n                                                    )}\r\n                                                </div>\r\n                                                {/* Like Button */}\r\n                                                <button\r\n                                                    onClick={() => currentUserId && onToggleLike?.(answer.id, currentUserId, !!isLiked)}\r\n                                                    className={`flex items-center gap-1 px-3 py-1.5 rounded-full transition-colors ${isLiked\r\n                                                        ? 'bg-rose-50 text-rose-600'\r\n                                                        : 'bg-stone-50 text-stone-500 hover:bg-stone-100'\r\n                                                        }`}\r\n                                                >\r\n                                                    <Heart className={`w-4 h-4 ${isLiked ? 'fill-rose-500' : ''}`} />\r\n                                                    <span className=\"text-sm font-bold\">{likeCount > 0 ? likeCount : ''}</span>\r\n                                                </button>\r\n                                            </div>\r\n\r\n                                            {/* Answer Text */}\r\n                                            {answer.audioUrl ? (\r\n                                                <div className=\"mb-4 bg-stone-50 p-3 rounded-xl border border-stone-100 flex items-center gap-3\">\r\n                                                    <button\r\n                                                        onClick={() => new Audio(answer.audioUrl).play()}\r\n                                                        className=\"w-10 h-10 bg-indigo-100 flex items-center justify-center rounded-full text-indigo-600 hover:bg-indigo-200\"\r\n                                                    >\r\n                                                        <PlayIcon size={20} fill=\"currentColor\" />\r\n                                                    </button>\r\n                                                    <div className=\"flex-1 h-1 bg-stone-200 rounded-full\" />\r\n                                                    <Mic size={16} className=\"text-stone-300\" />\r\n                                                </div>\r\n                                            ) : (\r\n                                                <p className=\"text-stone-700 text-lg leading-relaxed mb-4\">{answer.text}</p>\r\n                                            )}\r\n\r\n                                            {/* Action Bar */}\r\n                                            <div className=\"flex items-center gap-4 border-t border-stone-100 pt-3\">\r\n                                                <button\r\n                                                    onClick={() => toggleReplyInput(answer.id)}\r\n                                                    className=\"flex items-center gap-2 text-stone-500 hover:text-indigo-600 transition-colors text-sm font-medium\"\r\n                                                >\r\n                                                    <MessageSquare className=\"w-4 h-4\" />\r\n                                                    {answer.replies?.length ? t('replies_count', { count: answer.replies.length }) : t('reply_verb')}\r\n                                                </button>\r\n                                            </div>\r\n\r\n                                            {/* Replies Section */}\r\n                                            {(isReplying || (answer.replies && answer.replies.length > 0)) && (\r\n                                                <div className=\"mt-3 pl-4 border-l-2 border-stone-100 space-y-3\">\r\n                                                    {/* Existing Replies */}\r\n                                                    {answer.replies?.map((reply) => (\r\n                                                        <div key={reply.id} className=\"bg-stone-50 rounded-lg p-3 text-sm\">\r\n                                                            <div className=\"flex justify-between items-baseline mb-1\">\r\n                                                                <span className=\"font-bold text-stone-700\">{reply.userName}</span>\r\n                                                                {/* <span className=\"text-xs text-stone-400\">tid siden</span> */}\r\n                                                            </div>\r\n                                                            <p className=\"text-stone-600\">{reply.text}</p>\r\n                                                        </div>\r\n                                                    ))}\r\n\r\n                                                    {/* Reply Input */}\r\n                                                    {isReplying && (\r\n                                                        <div className=\"flex gap-2 items-end animate-fade-in mt-2\">\r\n                                                            <textarea\r\n                                                                value={replyText}\r\n                                                                onChange={(e) => setReplyText(e.target.value)}\r\n                                                                placeholder={t('write_reply_placeholder')}\r\n                                                                className=\"flex-1 bg-stone-50 border border-stone-200 rounded-xl p-2 text-sm focus:border-indigo-400 focus:outline-none resize-none h-20\"\r\n                                                                autoFocus\r\n                                                            />\r\n                                                            <button\r\n                                                                onClick={() => handleReplySubmit(answer.id)}\r\n                                                                disabled={!replyText.trim()}\r\n                                                                className=\"p-2 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 disabled:opacity-50 shadow-sm\"\r\n                                                            >\r\n                                                                <Send className=\"w-4 h-4\" />\r\n                                                            </button>\r\n                                                        </div>\r\n                                                    )}\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </>\r\n                        ) : (\r\n                            <div className=\"text-center py-8 text-stone-400\">\r\n                                <p>{t('no_answers_yet')}</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default WeeklyQuestionModal;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\weeklyQuestion\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\weeklyQuestion\\useWeeklyQuestions.ts","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\weeklyQuestion\\useWeeklyQuestions.ts:31:13\n  29 |     useEffect(() => {\n  30 |         if (!circleId) {\n> 31 |             setAnswers([]);\n     |             ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  32 |             setLoading(false);\n  33 |             return;\n  34 |         }","line":31,"column":13,"nodeType":null,"endLine":31,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1491,1494],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1491,1494],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2220,2223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2220,2223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n// Weekly Questions hook - real-time sync via Firestore\r\n// Syncs weekly question answers across family circle members\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport {\r\n    collection,\r\n    doc,\r\n    setDoc,\r\n    onSnapshot,\r\n    serverTimestamp,\r\n    query,\r\n    orderBy,\r\n    limit,\r\n    updateDoc,\r\n    arrayUnion,\r\n    arrayRemove\r\n} from 'firebase/firestore';\r\nimport { db } from '../../config/firebase';\r\n\r\nimport { WeeklyAnswer, WeeklyReply } from '../../types';\r\n\r\nexport function useWeeklyQuestions(circleId: string | null) {\r\n    const [answers, setAnswers] = useState<WeeklyAnswer[]>([]);\r\n    const [loading, setLoading] = useState<boolean>(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    // Subscribe to weekly answers from Firestore\r\n    useEffect(() => {\r\n        if (!circleId) {\r\n            setAnswers([]);\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        const answersRef = collection(db, 'careCircles', circleId, 'weeklyAnswers');\r\n        const answersQuery = query(answersRef, orderBy('answeredAt', 'desc'), limit(20));\r\n\r\n        const unsubscribe = onSnapshot(answersQuery,\r\n            (snapshot) => {\r\n                const answersList = snapshot.docs.map(doc => ({\r\n                    id: doc.id,\r\n                    ...doc.data()\r\n                })) as WeeklyAnswer[];\r\n                setAnswers(answersList);\r\n                setLoading(false);\r\n            },\r\n            (err: any) => {\r\n                console.error('Error fetching weekly answers:', err);\r\n                setError(err.message);\r\n                setLoading(false);\r\n            }\r\n        );\r\n\r\n        return () => unsubscribe();\r\n    }, [circleId]);\r\n\r\n    // Add new answer\r\n    const addAnswer = useCallback(async (answerData: Partial<WeeklyAnswer>) => {\r\n        if (!circleId) return;\r\n\r\n        const answerId = `answer_${Date.now()}`;\r\n        const answerRef = doc(db, 'careCircles', circleId, 'weeklyAnswers', answerId);\r\n\r\n        try {\r\n            await setDoc(answerRef, {\r\n                ...answerData,\r\n                answeredAt: serverTimestamp(),\r\n            });\r\n            return answerId;\r\n        } catch (err: any) {\r\n            console.error('Error adding weekly answer:', err);\r\n            setError(err.message);\r\n            throw err;\r\n        }\r\n    }, [circleId]);\r\n\r\n    // Toggle Like\r\n    const toggleLike = useCallback(async (answerId: string, userId: string, isLiked: boolean) => {\r\n        if (!circleId) return;\r\n        const answerRef = doc(db, 'careCircles', circleId, 'weeklyAnswers', answerId);\r\n        try {\r\n            await updateDoc(answerRef, {\r\n                likes: isLiked ? arrayRemove(userId) : arrayUnion(userId)\r\n            });\r\n        } catch (err) {\r\n            console.error('Error toggling like:', err);\r\n        }\r\n    }, [circleId]);\r\n\r\n    // Add Reply\r\n    const addReply = useCallback(async (answerId: string, reply: Omit<WeeklyReply, 'id'>) => {\r\n        if (!circleId) return;\r\n        const answerRef = doc(db, 'careCircles', circleId, 'weeklyAnswers', answerId);\r\n        const newReply: WeeklyReply = {\r\n            id: `reply_${Date.now()}`,\r\n            ...reply\r\n        };\r\n\r\n        try {\r\n            await updateDoc(answerRef, {\r\n                replies: arrayUnion(newReply)\r\n            });\r\n        } catch (err) {\r\n            console.error('Error adding reply:', err);\r\n        }\r\n    }, [circleId]);\r\n\r\n    return {\r\n        answers,\r\n        loading,\r\n        error,\r\n        addAnswer,\r\n        toggleLike,\r\n        addReply\r\n    };\r\n}\r\n\r\nexport default useWeeklyQuestions;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\wordGame\\Leaderboard.tsx","messages":[{"ruleId":"no-undef","severity":2,"message":"'React' is not defined.","line":11,"column":27,"nodeType":"Identifier","messageId":"undef","endLine":11,"endColumn":32}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Crown, Medal, Award, Users } from 'lucide-react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { LeaderboardEntry } from './useWordGame';\r\n\r\ninterface LeaderboardProps {\r\n    scores: LeaderboardEntry[];\r\n    currentUserId: string;\r\n}\r\n\r\n// Leaderboard Component - Family rankings for word game\r\nexport const Leaderboard: React.FC<LeaderboardProps> = ({ scores, currentUserId }) => {\r\n    const { t } = useTranslation();\r\n    if (!scores || scores.length === 0) {\r\n        return (\r\n            <div className=\"glass-panel text-center\">\r\n                <Users className=\"w-8 h-8 text-stone-300 mx-auto mb-2\" />\r\n                <p className=\"text-stone-400 text-sm\">{t('no_one_played_today')}</p>\r\n                <p className=\"text-stone-300 text-xs\">{t('be_the_first')}</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Get medal/rank icon\r\n    const getRankIcon = (rank: number) => {\r\n        switch (rank) {\r\n            case 0: return <Crown className=\"w-5 h-5 text-amber-500\" />;\r\n            case 1: return <Medal className=\"w-5 h-5 text-stone-400\" />;\r\n            case 2: return <Award className=\"w-5 h-5 text-amber-700\" />;\r\n            default: return <span className=\"w-5 h-5 flex items-center justify-center text-sm font-bold text-stone-400\">{rank + 1}</span>;\r\n        }\r\n    };\r\n\r\n    // Get rank colors\r\n    const getRankStyle = (rank: number, isMe: boolean) => {\r\n        const base = 'flex items-center gap-3 p-3 rounded-xl transition-all';\r\n\r\n        if (isMe) {\r\n            return `${base} bg-indigo-50/60 border-2 border-indigo-200/50 backdrop-blur-sm`;\r\n        }\r\n\r\n        switch (rank) {\r\n            case 0: return `${base} bg-gradient-to-r from-amber-50/70 to-yellow-50/70 border-2 border-amber-200/50 backdrop-blur-sm`;\r\n            case 1: return `${base} bg-stone-50/50 border border-stone-200/50 backdrop-blur-sm`;\r\n            case 2: return `${base} bg-orange-50/40 border border-orange-100/50 backdrop-blur-sm`;\r\n            default: return `${base} bg-white/20 border border-stone-100/30 backdrop-blur-sm`;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"glass-panel p-4\">\r\n            <h3 className=\"text-sm font-bold text-stone-500 uppercase tracking-wider mb-3 flex items-center gap-2\">\r\n                <Crown className=\"w-4 h-4 text-amber-500\" />\r\n                {t('todays_leaderboard')}\r\n            </h3>\r\n\r\n            <div className=\"space-y-2\">\r\n                {scores.map((entry, i) => {\r\n                    const isMe = entry.userId === currentUserId;\r\n                    const percentage = Math.round((entry.score / entry.total) * 100);\r\n\r\n                    return (\r\n                        <div key={entry.id} className={getRankStyle(i, isMe)}>\r\n                            {/* Rank icon */}\r\n                            <div className=\"shrink-0\">\r\n                                {getRankIcon(i)}\r\n                            </div>\r\n\r\n                            {/* Name and score */}\r\n                            <div className=\"flex-1 min-w-0\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <span className={`font-bold text-sm truncate ${isMe ? 'text-indigo-700' : 'text-stone-800'}`}>\r\n                                        {entry.displayName}\r\n                                    </span>\r\n                                    {isMe && (\r\n                                        <span className=\"text-[10px] bg-indigo-200 text-indigo-700 px-1.5 py-0.5 rounded-full font-bold\">\r\n                                            {t('you_caps')}\r\n                                        </span>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Score */}\r\n                            <div className=\"text-right shrink-0\">\r\n                                <span className={`text-lg font-bold ${percentage >= 80 ? 'text-green-600' :\r\n                                    percentage >= 60 ? 'text-amber-600' : 'text-stone-600'\r\n                                    }`}>\r\n                                    {entry.score}/{entry.total}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Leaderboard;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\wordGame\\Spillehjoernet.tsx","messages":[{"ruleId":"no-undef","severity":2,"message":"'React' is not defined.","line":22,"column":30,"nodeType":"Identifier","messageId":"undef","endLine":22,"endColumn":35}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Gamepad2 } from 'lucide-react';\r\nimport { WordGame } from './WordGame';\r\nimport { Leaderboard } from './Leaderboard';\r\nimport { useWordGame } from './useWordGame';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\ninterface SpillehjoernetProps {\r\n    circleId?: string;\r\n    userId?: string;\r\n    displayName: string;\r\n}\r\n\r\n/**\r\n * Spillehj├©rnet - Gaming Corner with Word of the Day.\r\n * Interactive word game with family leaderboard for daily engagement.\r\n * @param {SpillehjoernetProps} props - Component props\r\n * @param {string} props.circleId - Care circle identifier\r\n * @param {string} props.userId - Current user's ID\r\n * @param {string} props.displayName - User's display name for leaderboard\r\n * @returns {JSX.Element} Gaming corner component\r\n */\r\nexport const Spillehjoernet: React.FC<SpillehjoernetProps> = ({ circleId, userId, displayName }) => {\r\n    const { t } = useTranslation();\r\n    const {\r\n        currentWord,\r\n        currentWordIndex,\r\n        totalWords,\r\n        score,\r\n        isComplete,\r\n        loading,\r\n        submitAnswer,\r\n        leaderboard\r\n    } = useWordGame(circleId ?? null, userId ?? null, displayName);\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center gap-2 mb-2\">\r\n                <div className=\"bg-gradient-to-br from-purple-500 to-indigo-600 p-2 rounded-xl\">\r\n                    <Gamepad2 className=\"w-5 h-5 text-white\" />\r\n                </div>\r\n                <div>\r\n                    <h2 className=\"font-bold theme-text text-lg\">{t('spillehjoernet_title')}</h2>\r\n                    <p className=\"text-xs theme-text-muted\">{t('spillehjoernet_subtitle')}</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Word Game */}\r\n            <WordGame\r\n                currentWord={currentWord}\r\n                currentWordIndex={currentWordIndex}\r\n                totalWords={totalWords}\r\n                score={score}\r\n                isComplete={isComplete}\r\n                onAnswer={submitAnswer}\r\n                loading={loading}\r\n            />\r\n\r\n            {/* Leaderboard */}\r\n            <Leaderboard\r\n                scores={leaderboard}\r\n                currentUserId={userId ?? ''}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Spillehjoernet;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\wordGame\\WordGame.tsx","messages":[{"ruleId":"no-undef","severity":2,"message":"'React' is not defined.","line":23,"column":24,"nodeType":"Identifier","messageId":"undef","endLine":23,"endColumn":29},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":36,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":36,"endColumn":46,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[1059,1100],"text":"// @ts-expect-error - Check for import.meta.env"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { CheckCircle, XCircle, Trophy, Sparkles, ArrowRight } from 'lucide-react';\r\nimport { Word } from './useWordGame';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\ninterface WordGameProps {\r\n    currentWord: Word | null;\r\n    currentWordIndex: number;\r\n    totalWords: number;\r\n    score: number;\r\n    isComplete: boolean;\r\n    onAnswer: (wordId: string, isCorrect: boolean) => Promise<void | { isCorrect: boolean; newScore: number; isComplete: boolean }>;\r\n    loading: boolean;\r\n}\r\n\r\ninterface FeedbackState {\r\n    isCorrect: boolean;\r\n    correctAnswer: string;\r\n    word: string;\r\n}\r\n\r\n// Word Game Component - Daily word guessing game\r\nexport const WordGame: React.FC<WordGameProps> = ({\r\n    currentWord,\r\n    currentWordIndex,\r\n    totalWords,\r\n    score,\r\n    isComplete,\r\n    onAnswer,\r\n    loading\r\n}) => {\r\n    const { t } = useTranslation();\r\n    const [feedback, setFeedback] = useState<FeedbackState | null>(null);\r\n    const [selectedIndex, setSelectedIndex] = useState<number | null>(null);\r\n\r\n    // @ts-ignore - Check for import.meta.env\r\n    const baseUrl = import.meta.env.BASE_URL;\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"glass-panel p-6 text-center\">\r\n                <div className=\"animate-pulse\">\r\n                    <div className=\"h-6 bg-stone-200 rounded w-1/2 mx-auto mb-4\"></div>\r\n                    <div className=\"h-10 bg-stone-200 rounded w-3/4 mx-auto\"></div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Game complete screen\r\n    if (isComplete) {\r\n        const percentage = Math.round((score / totalWords) * 100);\r\n\r\n        return (\r\n            <div className=\"bg-gradient-to-br from-amber-400/90 to-orange-500/90 backdrop-blur-xl rounded-2xl p-6 text-white text-center shadow-lg overflow-hidden relative border border-white/20\">\r\n                {/* Success Trophy Image */}\r\n                <div className=\"mb-4 -mt-2\">\r\n                    <img\r\n                        src={`${baseUrl}assets/success_trophy.png`}\r\n                        alt=\"Success Trophy\"\r\n                        className=\"w-full max-w-[200px] mx-auto object-contain animate-in zoom-in duration-500 drop-shadow-xl\"\r\n                    />\r\n                </div>\r\n\r\n                <h3 className=\"text-2xl font-bold mb-2 relative z-10\">{t('word_game_complete')}</h3>\r\n                <div className=\"bg-white/20 rounded-xl p-4 mb-4 backdrop-blur-sm relative z-10 border border-white/30\">\r\n                    <p className=\"text-4xl font-bold\">{score}/{totalWords}</p>\r\n                    <p className=\"text-amber-100\">{t('correct_answers')}</p>\r\n                </div>\r\n                <p className=\"text-amber-100 text-sm relative z-10\">\r\n                    {percentage >= 80\r\n                        ? t('word_game_80_percent')\r\n                        : percentage >= 60\r\n                            ? t('word_game_60_percent')\r\n                            : t('word_game_below_60')}\r\n                </p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Show feedback after answer\r\n    if (feedback) {\r\n        return (\r\n            <div className={`rounded-2xl p-6 text-center shadow-lg backdrop-blur-xl border border-white/20 ${feedback.isCorrect\r\n                ? 'bg-gradient-to-br from-green-400/90 to-teal-500/90'\r\n                : 'bg-gradient-to-br from-orange-400/90 to-red-400/90'\r\n                } text-white`}>\r\n                <div className=\"text-4xl mb-3\">\r\n                    {feedback.isCorrect ? <CheckCircle className=\"w-12 h-12 mx-auto\" /> : <XCircle className=\"w-12 h-12 mx-auto\" />}\r\n                </div>\r\n                <h3 className=\"text-xl font-bold mb-2\">\r\n                    {feedback.isCorrect ? t('answer_correct') : t('answer_wrong')}\r\n                </h3>\r\n                <p className=\"text-white/80 mb-4 text-sm\">\r\n                    <span className=\"font-bold\">{feedback.word}</span> {t('word_means')}\r\n                    <br />\r\n                    \"{feedback.correctAnswer}\"\r\n                </p>\r\n                <button\r\n                    onClick={() => {\r\n                        setFeedback(null);\r\n                        setSelectedIndex(null);\r\n                    }}\r\n                    className=\"bg-white/20 hover:bg-white/30 px-6 py-3 rounded-xl font-bold flex items-center gap-2 mx-auto transition-colors border border-white/30\"\r\n                >\r\n                    {t('next_word')} <ArrowRight className=\"w-4 h-4\" />\r\n                </button>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Main game UI\r\n    const handleAnswer = async (option: { text: string, isCorrect: boolean }, index: number) => {\r\n        if (!currentWord) return;\r\n\r\n        setSelectedIndex(index);\r\n\r\n        // Store the current word in feedback BEFORE calling onAnswer (which advances)\r\n        const feedbackData = {\r\n            isCorrect: option.isCorrect,\r\n            correctAnswer: currentWord.correctAnswer,\r\n            word: currentWord.word  // Capture the word before it advances\r\n        };\r\n\r\n        await onAnswer(currentWord.id, option.isCorrect);\r\n\r\n        // Show feedback with the captured word\r\n        setFeedback(feedbackData);\r\n    };\r\n\r\n    return (\r\n        <div className=\"glass-panel p-5\">\r\n            {/* Progress */}\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n                <span className=\"text-xs font-bold theme-text-muted uppercase tracking-wide\">\r\n                    {t('word_of', { current: currentWordIndex + 1, total: totalWords })}\r\n                </span>\r\n                <span className=\"text-xs font-bold text-teal-600 dark:text-teal-400 flex items-center gap-1\">\r\n                    <Trophy className=\"w-3 h-3\" /> {score} {score === 1 ? 'point' : t('points')}\r\n                </span>\r\n            </div>\r\n\r\n            {/* Progress bar */}\r\n            <div className=\"h-1.5 bg-stone-100 rounded-full mb-5 overflow-hidden\">\r\n                <div\r\n                    className=\"h-full bg-gradient-to-r from-amber-400 to-orange-500 rounded-full transition-all duration-500\"\r\n                    style={{ width: `${(currentWordIndex / totalWords) * 100}%` }}\r\n                />\r\n            </div>\r\n\r\n            {/* Word */}\r\n            <div className=\"text-center mb-5\">\r\n                <div className=\"flex items-center justify-center gap-2 mb-1\">\r\n                    <Sparkles className=\"w-4 h-4 text-amber-500\" />\r\n                    <span className=\"text-xs theme-text-muted uppercase tracking-wider\">{t('what_does_mean')}</span>\r\n                    <Sparkles className=\"w-4 h-4 text-amber-500\" />\r\n                </div>\r\n                <h2 className=\"text-2xl font-bold theme-text\">{currentWord?.word}</h2>\r\n            </div>\r\n\r\n            {/* Options */}\r\n            <div className=\"space-y-3\">\r\n                {currentWord?.options?.map((option, i) => (\r\n                    <button\r\n                        key={i}\r\n                        onClick={() => handleAnswer(option, i)}\r\n                        disabled={selectedIndex !== null}\r\n                        className={`w-full p-4 rounded-xl text-left transition-all duration-200 border-2\r\n                            ${selectedIndex === i\r\n                                ? 'border-amber-400 bg-amber-50 dark:bg-amber-900/30'\r\n                                : 'border-stone-200 theme-card opacity-90 hover:border-stone-300 hover:bg-white dark:hover:bg-slate-800'\r\n                            }\r\n                            ${selectedIndex !== null ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer active:scale-[0.98]'}\r\n                        `}\r\n                    >\r\n                        <span className=\"font-medium theme-text text-sm leading-snug\">\r\n                            {option.text}\r\n                        </span>\r\n                    </button>\r\n                ))}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default WordGame;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\wordGame\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\wordGame\\useWordGame.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[909,912],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[909,912],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1098,1101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1098,1101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1123,1126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1123,1126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\dinko\\Projects\\PNWS\\tryg-app\\src\\features\\wordGame\\useWordGame.ts:86:17\n  84 |             try {\n  85 |                 const { answers: savedAnswers, score: savedScore, complete } = JSON.parse(saved);\n> 86 |                 setAnswers(savedAnswers || {});\n     |                 ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  87 |                 setScore(savedScore || 0);\n  88 |                 setIsComplete(complete || false);\n  89 |","line":86,"column":17,"nodeType":null,"endLine":86,"endColumn":27}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n// Word Game Hook - manages game state and Firestore sync\r\nimport { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport {\r\n    collection,\r\n    doc,\r\n    setDoc,\r\n    onSnapshot,\r\n    query,\r\n    orderBy,\r\n    serverTimestamp\r\n} from 'firebase/firestore';\r\nimport { db } from '../../config/firebase';\r\nimport { getTodaysWords, shuffleAnswers } from '../../data/wordGameData';\r\nimport { getTodaysWordsBS, shuffleAnswersBS } from '../../data/wordGameData_bs';\r\nimport { getTodaysWordsTR, shuffleAnswersTR } from '../../data/wordGameData_tr';\r\n\r\n// Get today's date key for localStorage\r\nconst getTodayKey = () => new Date().toISOString().split('T')[0];\r\n\r\nexport interface Word {\r\n    id: string;\r\n    word: string;\r\n    correctAnswer: string;\r\n    wrongAnswer?: string;\r\n    options?: { text: string; isCorrect: boolean }[];\r\n    [key: string]: any;\r\n}\r\n\r\nexport interface LeaderboardEntry {\r\n    id: string;\r\n    userId: string;\r\n    displayName: string;\r\n    score: number;\r\n    total: number;\r\n    date: string;\r\n    completedAt?: any;\r\n    [key: string]: any;\r\n}\r\n\r\nexport function useWordGame(circleId: string | null, userId: string | null, displayName: string | null) {\r\n    const { i18n } = useTranslation();\r\n    const [currentWordIndex, setCurrentWordIndex] = useState<number>(0);\r\n    const [score, setScore] = useState<number>(0);\r\n    const [answers, setAnswers] = useState<Record<string, boolean>>({}); // { wordId: isCorrect }\r\n    const [isComplete, setIsComplete] = useState<boolean>(false);\r\n    const [leaderboard, setLeaderboard] = useState<LeaderboardEntry[]>([]);\r\n    const [loading, setLoading] = useState<boolean>(true);\r\n\r\n    // Get locale-specific word functions\r\n    const { getWords, shuffle } = useMemo(() => {\r\n        switch (i18n.language) {\r\n            case 'bs':\r\n                return { getWords: getTodaysWordsBS, shuffle: shuffleAnswersBS };\r\n            case 'tr':\r\n                return { getWords: getTodaysWordsTR, shuffle: shuffleAnswersTR };\r\n            default:\r\n                return { getWords: getTodaysWords, shuffle: shuffleAnswers };\r\n        }\r\n    }, [i18n.language]);\r\n\r\n    // Get today's words (memoized, same for all family, locale-specific)\r\n    const todaysWords = useMemo(() => getWords(), [getWords]);\r\n\r\n    // Current word with shuffled answers\r\n    const currentWord = useMemo(() => {\r\n        if (currentWordIndex >= todaysWords.length) return null;\r\n        const word = todaysWords[currentWordIndex];\r\n        return {\r\n            ...word,\r\n            options: shuffle(word, currentWordIndex)\r\n        };\r\n    }, [todaysWords, currentWordIndex, shuffle]);\r\n\r\n    // Load saved progress from localStorage on mount\r\n    useEffect(() => {\r\n        if (!userId) return;\r\n\r\n        const savedKey = `wordGame_${getTodayKey()}_${userId}`;\r\n        const saved = localStorage.getItem(savedKey);\r\n\r\n        if (saved) {\r\n            try {\r\n                const { answers: savedAnswers, score: savedScore, complete } = JSON.parse(saved);\r\n                setAnswers(savedAnswers || {});\r\n                setScore(savedScore || 0);\r\n                setIsComplete(complete || false);\r\n\r\n                // Calculate current word index from saved answers\r\n                const answeredCount = Object.keys(savedAnswers || {}).length;\r\n                setCurrentWordIndex(answeredCount);\r\n            } catch (e) {\r\n                console.error('Error loading saved game:', e);\r\n            }\r\n        }\r\n        setLoading(false);\r\n    }, [userId]);\r\n\r\n    // Subscribe to leaderboard from Firestore\r\n    useEffect(() => {\r\n        if (!circleId) return;\r\n\r\n        const todayKey = getTodayKey();\r\n        const scoresRef = collection(db, 'careCircles', circleId, 'wordGameScores');\r\n        const scoresQuery = query(scoresRef, orderBy('score', 'desc'));\r\n\r\n        const unsub = onSnapshot(scoresQuery, (snapshot) => {\r\n            const scores = snapshot.docs\r\n                .filter(doc => doc.data().date === todayKey)\r\n                .map(doc => ({\r\n                    id: doc.id,\r\n                    ...doc.data()\r\n                })) as LeaderboardEntry[];\r\n            setLeaderboard(scores);\r\n        }, (err) => {\r\n            console.error('Error fetching leaderboard:', err);\r\n        });\r\n\r\n        return () => unsub();\r\n    }, [circleId]);\r\n\r\n    // Save progress to localStorage and Firestore\r\n    const saveProgress = useCallback(async (newAnswers: Record<string, boolean>, newScore: number, complete: boolean) => {\r\n        if (!userId) return;\r\n\r\n        const todayKey = getTodayKey();\r\n        const savedKey = `wordGame_${todayKey}_${userId}`;\r\n\r\n        // Save to localStorage\r\n        localStorage.setItem(savedKey, JSON.stringify({\r\n            answers: newAnswers,\r\n            score: newScore,\r\n            complete\r\n        }));\r\n\r\n        // Save to Firestore if game is complete\r\n        if (complete && circleId) {\r\n            const scoreRef = doc(db, 'careCircles', circleId, 'wordGameScores', `${userId}_${todayKey}`);\r\n            await setDoc(scoreRef, {\r\n                userId,\r\n                displayName: displayName || 'Ukendt',\r\n                score: newScore,\r\n                total: todaysWords.length,\r\n                date: todayKey,\r\n                completedAt: serverTimestamp()\r\n            });\r\n\r\n            // ­ƒÄ« Social Spark: Post game completion to activity feed\r\n            const pingRef = doc(db, 'careCircles', circleId, 'pings', `game_${userId}_${todayKey}`);\r\n            await setDoc(pingRef, {\r\n                type: 'game_complete',\r\n                fromName: displayName || 'Ukendt',\r\n                fromUserId: userId,\r\n                score: newScore,\r\n                total: todaysWords.length,\r\n                sentAt: serverTimestamp()\r\n            });\r\n        }\r\n    }, [circleId, userId, displayName, todaysWords.length]);\r\n\r\n    // Submit an answer\r\n    const submitAnswer = useCallback(async (wordId: string, isCorrect: boolean) => {\r\n        // Already answered this word?\r\n        if (answers[wordId] !== undefined) return;\r\n\r\n        const newAnswers = { ...answers, [wordId]: isCorrect };\r\n        const newScore = isCorrect ? score + 1 : score;\r\n        const nextIndex = currentWordIndex + 1;\r\n        const isNowComplete = nextIndex >= todaysWords.length;\r\n\r\n        setAnswers(newAnswers);\r\n        setScore(newScore);\r\n        setCurrentWordIndex(nextIndex);\r\n        setIsComplete(isNowComplete);\r\n\r\n        await saveProgress(newAnswers, newScore, isNowComplete);\r\n\r\n        return { isCorrect, newScore, isComplete: isNowComplete };\r\n    }, [answers, score, currentWordIndex, todaysWords.length, saveProgress]);\r\n\r\n    // Reset game (for testing only)\r\n    const resetGame = useCallback(() => {\r\n        if (!userId) return;\r\n\r\n        const todayKey = getTodayKey();\r\n        const savedKey = `wordGame_${todayKey}_${userId}`;\r\n        localStorage.removeItem(savedKey);\r\n        setAnswers({});\r\n        setScore(0);\r\n        setCurrentWordIndex(0);\r\n        setIsComplete(false);\r\n    }, [userId]);\r\n\r\n    return {\r\n        // Game state\r\n        currentWord,\r\n        currentWordIndex,\r\n        totalWords: todaysWords.length,\r\n        score,\r\n        isComplete,\r\n        loading,\r\n\r\n        // Actions\r\n        submitAnswer,\r\n        resetGame,\r\n\r\n        // Leaderboard\r\n        leaderboard,\r\n\r\n        // For debugging\r\n        todaysWords\r\n    };\r\n}\r\n\r\nexport default useWordGame;\r\n","usedDeprecatedRules":[]}]
